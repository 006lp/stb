import{_ as b,l as f,o as B,c as $,a as p,w as o,b as y,d as k,g as c,t as i,B as S,Z as A,A as m,j as l,$ as N,a0 as R,k as r}from"./index-BJZIGMPf.js";const U={class:"users"},V={__name:"Users",setup(L){const v=f([]),u=f(!1),g=[{title:"用户名",dataIndex:"username",key:"username"},{title:"IP地址",dataIndex:"ip",key:"ip",customRender:({text:a})=>a.ipv4?a.ipv4:a.ipv6},{title:"注册邮箱",dataIndex:"email",key:"email"},{title:"角色",dataIndex:"role",key:"role"},{title:"状态",dataIndex:"status",key:"status"},{title:"注册时间",dataIndex:"createdAt",key:"createdAt"},{title:"最后登录",dataIndex:"lastLogin",key:"lastLogin"},{title:"操作",key:"action"}],d=async()=>{u.value=!0;try{const a=await m.get("/api/admin/users");v.value=a.data}catch{l.error("获取用户列表失败")}finally{u.value=!1}},h=async a=>{var n,t;try{const e=a.status==="active"?"disabled":"active";await m.patch(`/api/admin/users/${a._id}/status`,{status:e}),l.success("状态更新成功"),d()}catch(e){l.error((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.error)}},x=async a=>{var n,t;try{const e=a.role==="admin"?"user":"admin";await m.patch(`/api/admin/users/${a._id}/role`,{role:e}),l.success("角色更新成功"),d()}catch(e){l.error((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.error)}};return B(d),(a,n)=>{const t=N,e=S,C=R,I=A;return r(),$("div",U,[p(I,{columns:g,"data-source":v.value,loading:u.value,"row-key":"_id"},{bodyCell:o(({column:_,record:s})=>[_.key==="status"?(r(),y(t,{key:0,color:s.status==="active"?"green":"red"},{default:o(()=>[c(i(s.status==="active"?"活跃":"禁用"),1)]),_:2},1032,["color"])):k("",!0),_.key==="role"?(r(),y(t,{key:1,color:s.role==="admin"?"blue":"default"},{default:o(()=>[c(i(s.role==="admin"?"管理员":"用户"),1)]),_:2},1032,["color"])):k("",!0),_.key==="action"?(r(),y(C,{key:2},{default:o(()=>[p(e,{type:"link",onClick:w=>h(s)},{default:o(()=>[c(i(s.status==="active"?"禁用":"启用"),1)]),_:2},1032,["onClick"]),p(e,{type:"link",onClick:w=>x(s)},{default:o(()=>[c(i(s.role==="admin"?"设为用户":"设为管理员"),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:1},8,["data-source","loading"])])}}},j=b(V,[["__scopeId","data-v-6f462279"]]);export{j as default};
