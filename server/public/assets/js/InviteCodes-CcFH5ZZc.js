import{r as e,o as a,f as t,h as l,i as o,m as r,a3 as s,J as n,E as u,aq as d,as as i,au as c,g as v,q as p,aI as m,aJ as f,a6 as _,x as g,j as b,ai as y,aj as w,aN as h}from"./vendor-Ct0GE2cv.js";import{_ as k,i as C}from"./index-D-heiWuO.js";import{a as x}from"./formatDate-_UAqMSvc.js";const j={class:"invite-codes"},A={class:"header"},U=k({__name:"InviteCodes",setup(k){const U=e([]),z=e(!1),B=e(1),q=e(10),I=e(0),O=e(!1),R=e(null),E=e({count:1}),J={count:[{required:!0,message:"请输入生成数量",trigger:"blur"},{type:"number",min:1,max:100,message:"数量应在1-100之间",trigger:"blur"}]},L=async()=>{var e;z.value=!0;try{const{data:e}=await C.post("/api/admin/invite-codes",s.stringify({page:B.value,limit:q.value}));I.value=e.total,U.value=e.codes}catch({response:a}){n.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{z.value=!1}},$=()=>{E.value={count:1},O.value=!0},D=async()=>{var e;try{await R.value.validate(),await C.post("/api/admin/invite-codes/generate",E.value),n.success("邀请码生成成功"),O.value=!1,L()}catch({response:a}){n.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}},F=async()=>{var e;try{const e=await C.get("/api/admin/invite-codes/export",{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),t=document.createElement("a");t.href=a,t.setAttribute("download","invite-codes.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch({response:a}){n.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}};return a(L),(e,a)=>{const s=u,k=f,N=_,S=m,T=d,G=i,H=h,K=w,M=y,P=c;return v(),t("div",j,[l("div",A,[o(s,{type:"primary",onClick:$},{default:r((()=>a[5]||(a[5]=[p("生成邀请码")]))),_:1,__:[5]}),o(s,{onClick:F,disabled:!U.value.length},{default:r((()=>a[6]||(a[6]=[p("导出邀请码")]))),_:1,__:[6]},8,["disabled"])]),o(T,{spinning:z.value},{default:r((()=>[o(S,{data:U.value,"scrollbar-always-on":!0,fit:""},{default:r((()=>[o(k,{prop:"code",label:"邀请码"}),o(k,{prop:"status",label:"状态"},{default:r((({row:e})=>[o(N,{color:"unused"===e.status?"green":"blue"},{default:r((()=>[p(g("unused"===e.status?"未使用":"已使用"),1)])),_:2},1032,["color"])])),_:1}),o(k,{prop:"usedBy",label:"使用人"},{default:r((({row:e})=>[p(g(e.usedBy?e.usedBy.username:"-"),1)])),_:1}),o(k,{prop:"usedAt",label:"使用时间"},{default:r((({row:e})=>[p(g(e.usedAt?b(x)(e.usedAt):"-"),1)])),_:1}),o(k,{prop:"createdAt",label:"生成时间"},{default:r((({row:e})=>[p(g(b(x)(e.createdAt)),1)])),_:1}),o(k,{label:"操作",fixed:"right",width:"100"},{default:r((({row:e})=>[o(s,{type:"link",danger:"",onClick:a=>{return t=e,void c.confirm({title:"确认删除",content:`确定要删除邀请码 "${t.code}" 吗？`,async onOk(){var e;try{await C.delete(`/api/admin/invite-codes/${t._id}`),n.success("邀请码已删除"),L()}catch({response:a}){n.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}}});var t}},{default:r((()=>a[7]||(a[7]=[p("删除")]))),_:2,__:[7]},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["spinning"]),o(G,{class:"pagination",current:B.value,"onUpdate:current":a[0]||(a[0]=e=>B.value=e),"page-size":q.value,"onUpdate:pageSize":a[1]||(a[1]=e=>q.value=e),total:I.value,"show-size-changer":"",onChange:L},null,8,["current","page-size","total"]),o(P,{open:O.value,"onUpdate:open":a[3]||(a[3]=e=>O.value=e),title:"生成邀请码",onOk:D,onCancel:a[4]||(a[4]=e=>O.value=!1)},{default:r((()=>[o(M,{model:E.value,rules:J,ref_key:"generateFormRef",ref:R},{default:r((()=>[o(K,{label:"生成数量",name:"count"},{default:r((()=>[o(H,{value:E.value.count,"onUpdate:value":a[2]||(a[2]=e=>E.value.count=e),min:1,max:100,placeholder:"请输入生成数量"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"])])}}},[["__scopeId","data-v-983a3b77"]]);export{U as default};
