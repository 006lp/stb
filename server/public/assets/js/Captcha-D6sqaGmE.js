import{_ as a,i as e}from"./index-D-heiWuO.js";import{r as t,f as s,g as n,h as c,k as r,j as o,aD as u,aE as l,i as d,q as i,aF as v,x as p,an as m,v as h,J as y}from"./vendor-Ct0GE2cv.js";const f={class:"drag-verify"},g={key:0,class:"text"},x={key:1,class:"text"},k=a(Object.assign({name:"Captcha"},{__name:"Captcha",props:{value:{type:Boolean,default:!1},successText:{type:String,default:"验证成功"},startText:{type:String,default:"请按住滑块，拖动到最右边"}},emits:["update:value","verify-success","update:captchaId"],setup(a,{emit:k}){const I=k,E=t(!1),T=t(null),_="ontouchstart"in document.documentElement,j=_?"touchmove":"mousemove",w=_?"touchend":"mouseup",L=async()=>{var a;T.value||await(async()=>{var a;try{const{data:a}=await e.post("/api/auth/captcha/generate");T.value=a.captchaId,I("update:captchaId",a.captchaId)}catch({response:t}){y.error(null==(a=null==t?void 0:t.data)?void 0:a.error)}})();try{const{data:a}=await e.post("/api/auth/captcha/verify",{captchaId:T.value,verifyResult:!0});a.isValid?(E.value=!0,I("update:value",!0),I("verify-success")):(y.error("验证失败"),X())}catch({response:t}){y.error(null==(a=null==t?void 0:t.data)?void 0:a.error),X()}},X=()=>{E.value=!1,I("update:value",!1),T.value=null,I("update:captchaId",null)},b=a=>{let e=0;const t=document.querySelector(".drag-verify .block"),s=a.clientX||a.touches[0].pageX,n=t.offsetWidth-40;if(E.value)return!1;const c=a=>{const c=a.clientX||a.touches[0].pageX;e=c-s,e<=0&&(e=0),e>=n-40&&(e=n),t.style.transition=".1s all",t.style.transform=`translate3d(${e}px, 0, 0)`},r=()=>{e!==n?(t.style.transition=".5s all",t.style.transform="translate3d(0, 0, 0)"):L(),document.removeEventListener(j,c),document.removeEventListener(w,r)};document.addEventListener(j,c),document.addEventListener(w,r)};return(e,t)=>(n(),s("div",f,[c("div",{class:h(["range",E.value?"success":""])},[c("div",{class:"block",onMousedown:b,onTouchstartPassive:b},[c("span",null,[E.value?(n(),r(o(u),{key:0})):(n(),r(o(l),{key:1}))])],32),E.value?(n(),s("span",g,[d(o(v)),i(" "+p(a.successText),1)])):(n(),s("span",x,[d(o(m)),i(" "+p(a.startText),1)]))],2)]))}}),[["__scopeId","data-v-e090de80"]]);export{k as C};
