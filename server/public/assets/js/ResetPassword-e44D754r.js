import{r as a,ah as e,f as l,g as s,i as d,m as i,l as r,ai as o,aj as n,ak as u,j as t,E as v,q as p,al as m,$ as c,J as f,a3 as _,b as y,aB as w,aC as g,an as h}from"./vendor-Ct0GE2cv.js";import{_ as b,u as P,i as k}from"./index-D-heiWuO.js";const x={class:"reset-password"},q={key:0},j={key:1},U={key:2},F=b({__name:"ResetPassword",setup(b){const F=y(),M=P(),S=a(0),T=a(!1),E=a(""),B=e({email:""}),C=e({code:""}),I=e({password:"",confirmPassword:""}),J=async(a,e)=>{if(e!==I.password)throw new Error("两次输入的密码不一致")},R=async()=>{var a,e,l;if(null==(e=null==(a=null==M?void 0:M.config)?void 0:a.smtp)?void 0:e.enabled)try{T.value=!0,await k.post("/api/auth/send-code",_.stringify({email:B.email,type:"reset"})),f.success("验证码已发送到您的邮箱"),S.value=1}catch({response:s}){f.error((null==(l=null==s?void 0:s.data)?void 0:l.error)||"发送验证码失败")}finally{T.value=!1}else f.warning("SMTP功能未开启, 请联系管理员")},$=async()=>{var a,e,l;if(null==(e=null==(a=null==M?void 0:M.config)?void 0:a.smtp)?void 0:e.enabled)if(1===S.value)try{T.value=!0;const{data:a}=await k.post("/api/auth/verify-code",_.stringify({email:B.email,code:C.code}));E.value=a.token,S.value=2}catch({response:s}){f.error((null==(l=null==s?void 0:s.data)?void 0:l.error)||"验证码验证失败")}finally{T.value=!1}else f.warning("请先完成邮箱验证");else f.warning("SMTP功能未开启, 请联系管理员")},z=async()=>{var a,e,l;if(null==(e=null==(a=null==M?void 0:M.config)?void 0:a.smtp)?void 0:e.enabled)if(2===S.value)try{T.value=!0,await k.post("/api/auth/reset-password",_.stringify({token:E.value,password:I.password})),f.success("您的密码已经重置成功，请使用新密码登录"),F.push("/login")}catch({response:s}){f.error((null==(l=null==s?void 0:s.data)?void 0:l.error)||"重置密码失败")}finally{T.value=!1}else f.warning("请先完成验证码验证");else f.warning("SMTP功能未开启, 请联系管理员")};return(a,e)=>{const f=u,_=n,y=v,b=o,P=m,k=c;return s(),l("div",x,[d(k,{class:"reset-card",title:"找回密码"},{default:i((()=>[0===S.value?(s(),l("div",q,[d(b,{model:B,onFinish:R},{default:i((()=>[d(_,{name:"email",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱地址"}]},{default:i((()=>[d(f,{value:B.email,"onUpdate:value":e[0]||(e[0]=a=>B.email=a),placeholder:"请输入注册邮箱"},{prefix:i((()=>[d(t(w))])),_:1},8,["value"])])),_:1}),d(_,null,{default:i((()=>[d(y,{type:"primary",disabled:!B.email,"html-type":"submit",loading:T.value},{default:i((()=>e[4]||(e[4]=[p(" 发送验证码 ")]))),_:1,__:[4]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):r("",!0),1===S.value?(s(),l("div",j,[d(b,{model:C,onFinish:$},{default:i((()=>[d(_,{name:"code",rules:[{required:!0,message:"请输入验证码"}]},{default:i((()=>[d(f,{value:C.code,"onUpdate:value":e[1]||(e[1]=a=>C.code=a),placeholder:"请输入验证码"},{prefix:i((()=>[d(t(g))])),_:1},8,["value"])])),_:1}),d(_,null,{default:i((()=>[d(y,{type:"primary",disabled:!C.code,"html-type":"submit",loading:T.value},{default:i((()=>e[5]||(e[5]=[p("验证")]))),_:1,__:[5]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):r("",!0),2===S.value?(s(),l("div",U,[d(b,{model:I,onFinish:z},{default:i((()=>[d(_,{name:"password",rules:[{required:!0,message:"请输入新密码"},{min:6,message:"密码长度不能小于6位"}]},{default:i((()=>[d(P,{value:I.password,"onUpdate:value":e[2]||(e[2]=a=>I.password=a),placeholder:"请输入新密码"},{prefix:i((()=>[d(t(h))])),_:1},8,["value"])])),_:1}),d(_,{name:"confirmPassword",rules:[{required:!0,message:"请确认密码"},{validator:J}]},{default:i((()=>[d(P,{value:I.confirmPassword,"onUpdate:value":e[3]||(e[3]=a=>I.confirmPassword=a),placeholder:"请确认新密码"},{prefix:i((()=>[d(t(h))])),_:1},8,["value"])])),_:1},8,["rules"]),d(_,null,{default:i((()=>[d(y,{type:"primary","html-type":"submit",disabled:!I.password||!I.confirmPassword,loading:T.value},{default:i((()=>e[6]||(e[6]=[p(" 重置密码 ")]))),_:1,__:[6]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):r("",!0)])),_:1})])}}},[["__scopeId","data-v-12391a8b"]]);export{F as default};
