import{c as a,ah as l,f as e,g as o,i as n,m as u,ai as s,k as d,l as i,aj as t,ak as r,j as c,al as v,E as p,q as h,y as f,h as g,$ as _,b as m,J as b,am as k,U as y,an as x,ao as I,ap as w}from"./vendor-Ct0GE2cv.js";import{_ as C,u as U,i as j}from"./index-D-heiWuO.js";import{C as $}from"./Captcha-D6sqaGmE.js";const q={class:"login-container"},G={class:"anticon"},H=["src"],L=C({__name:"Login",setup(C){const L=m(),Q=U(),A=a((()=>{var a,l;return null==(l=null==(a=null==Q?void 0:Q.config)?void 0:a.site)?void 0:l.captcha})),D=l({username:"",password:"",captcha:!1,captchaId:""}),E=a((()=>{let a=!D.username||!D.password;return A.value&&(a=a||!D.captcha||!D.captchaId),a})),F=async()=>{var a;try{const{data:a}=await j.post("/api/auth/login",{username:D.username,password:D.password,captchaId:D.captchaId});Q.token=a.token,Q.user=a.user,L.push("/"),b.success("登录成功")}catch({response:l}){b.error((null==(a=null==l?void 0:l.data)?void 0:a.error)||"登录失败")}},J=a=>{var l;const{oauth:e,site:o}=null==Q?void 0:Q.config;e.enabled?(null==(l=e[a])?void 0:l.enabled)?location.href=`${o.url}/oauth/${a}?redirectUrl=${encodeURIComponent(location.href)}`:b.error(`${a}登录功能未启用`):b.error("社会化登录功能未启用")};return(a,l)=>{const m=r,b=t,C=v,U=p,j=k,P=s,R=_;return o(),e("div",q,[n(R,{title:"登录",class:"login-box"},{default:u((()=>[n(P,{model:D,onFinish:F,layout:"vertical"},{default:u((()=>{var a,s,t,r,v,p,_,k,q,F,P,R,V,z,B,K,M,N,O,S,T,W,X,Y,Z,aa,la;return[n(b,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"}]},{default:u((()=>[n(m,{value:D.username,"onUpdate:value":l[0]||(l[0]=a=>D.username=a),placeholder:"请输入用户名"},{prefix:u((()=>[n(c(y))])),_:1},8,["value"])])),_:1}),n(b,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}]},{default:u((()=>[n(C,{value:D.password,"onUpdate:value":l[1]||(l[1]=a=>D.password=a),placeholder:"请输入密码"},{prefix:u((()=>[n(c(x))])),_:1},8,["value"])])),_:1}),A.value?(o(),d(b,{key:0,label:"验证码",required:"",name:"captcha"},{default:u((()=>[n($,{value:D.captcha,"onUpdate:value":l[2]||(l[2]=a=>D.captcha=a),captchaId:D.captchaId,"onUpdate:captchaId":l[3]||(l[3]=a=>D.captchaId=a)},null,8,["value","captchaId"])])),_:1})):i("",!0),n(b,{class:"sin"},{default:u((()=>{var a,e,s,t;return[n(U,{type:"primary","html-type":"submit",block:!(null==(e=null==(a=c(Q).config)?void 0:a.site)?void 0:e.register),disabled:E.value},{default:u((()=>l[9]||(l[9]=[h(" 登录账号 ")]))),_:1,__:[9]},8,["block","disabled"]),(null==(t=null==(s=c(Q).config)?void 0:s.site)?void 0:t.register)?(o(),d(U,{key:0,onClick:l[4]||(l[4]=a=>c(L).push("/register"))},{default:u((()=>l[10]||(l[10]=[h("注册账号")]))),_:1,__:[10]})):i("",!0),n(U,{onClick:l[5]||(l[5]=a=>c(L).push("/reset-password"))},{default:u((()=>l[11]||(l[11]=[h("找回密码")]))),_:1,__:[11]})]})),_:1}),(null==(t=null==(s=null==(a=c(Q))?void 0:a.config)?void 0:s.oauth)?void 0:t.enabled)?(o(),e(f,{key:1},[(null==(_=null==(p=null==(v=null==(r=c(Q))?void 0:r.config)?void 0:v.oauth)?void 0:p.github)?void 0:_.enabled)||(null==(P=null==(F=null==(q=null==(k=c(Q))?void 0:k.config)?void 0:q.oauth)?void 0:F.google)?void 0:P.enabled)||(null==(B=null==(z=null==(V=null==(R=c(Q))?void 0:R.config)?void 0:V.oauth)?void 0:z.linuxdo)?void 0:B.enabled)?(o(),d(j,{key:0},{default:u((()=>l[12]||(l[12]=[h(" 或 ")]))),_:1,__:[12]})):i("",!0),(null==(O=null==(N=null==(M=null==(K=c(Q))?void 0:K.config)?void 0:M.oauth)?void 0:N.github)?void 0:O.enabled)?(o(),d(U,{key:1,onClick:l[6]||(l[6]=a=>J("github"))},{default:u((()=>[n(c(I)),l[13]||(l[13]=h(" GitHub "))])),_:1,__:[13]})):i("",!0),(null==(X=null==(W=null==(T=null==(S=c(Q))?void 0:S.config)?void 0:T.oauth)?void 0:W.google)?void 0:X.enabled)?(o(),d(U,{key:2,onClick:l[7]||(l[7]=a=>J("google"))},{default:u((()=>[n(c(w)),l[14]||(l[14]=h(" Google "))])),_:1,__:[14]})):i("",!0),(null==(la=null==(aa=null==(Z=null==(Y=c(Q))?void 0:Y.config)?void 0:Z.oauth)?void 0:aa.linuxdo)?void 0:la.enabled)?(o(),d(U,{key:3,onClick:l[8]||(l[8]=a=>J("linuxdo"))},{default:u((()=>[g("span",G,[g("img",{class:"linuxdo",src:c("/assets/svg/linuxdo-CAlHVQQP.svg")},null,8,H)]),l[15]||(l[15]=h(" Linux Do "))])),_:1,__:[15]})):i("",!0)],64)):i("",!0)]})),_:1},8,["model"])])),_:1})])}}},[["__scopeId","data-v-f800b6a0"]]);export{L as default};
