import{r as a,o as e,f as l,h as u,i as r,m as s,a3 as t,J as n,aH as o,E as i,aq as v,au as d,g as p,a0 as c,at as m,q as _,aI as f,aJ as b,x as h,j as y,as as g,ai as w,k,l as C,aj as I,ak as U}from"./vendor-Ct0GE2cv.js";import{_ as S,i as j}from"./index-D-heiWuO.js";import{a as q}from"./formatDate-_UAqMSvc.js";const x={class:"admin-albums"},z={class:"search-area"},A=S({__name:"Albums",setup(S){const A=a([]),J=a(!1),O=a(!1),$=a("create"),B=a(null),D=a(!1),E=a([]),H=a(""),R=a(""),F=a(""),G=a(1),K=a(0),L=a(10),M=a({userId:void 0,name:"",permission:"private"}),N={userId:[{required:!0,message:"请选择用户"}],name:[{required:!0,message:"请输入相册名称"}],permission:[{required:!0,message:"请选择权限"}]},P=async()=>{var a;J.value=!0;try{const{data:a}=await j.post("/api/admin/albums",t.stringify({page:G.value,limit:L.value,name:R.value,username:H.value,permission:F.value}));A.value=a.albums,K.value=a.total}catch({response:e}){n.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}finally{J.value=!1}},Q=async a=>{var e;if(a){D.value=!0;try{const{data:e}=await j.post("/api/admin/users/search",t.stringify({username:a}));E.value=e.users}catch({response:l}){n.error(null==(e=null==l?void 0:l.data)?void 0:e.error)}finally{D.value=!1}}},T=()=>{$.value="create",M.value={userId:void 0,name:"",permission:"private"},O.value=!0},V=async()=>{var a;try{"create"===$.value?(await j.post("/api/admin/albums/new",M.value),n.success("创建相册成功")):(await j.put(`/api/admin/albums/${M.value._id}`,M.value),n.success("更新相册成功")),O.value=!1,P()}catch({response:e}){n.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}};return e(P),(a,e)=>{const t=o,S=m,W=c,X=i,Y=b,Z=f,aa=g,ea=v,la=I,ua=U,ra=w,sa=d;return p(),l("div",x,[u("div",z,[r(t,{value:H.value,"onUpdate:value":e[0]||(e[0]=a=>H.value=a),allowClear:"",placeholder:"输入用户名搜索",onSearch:P},null,8,["value"]),r(t,{value:R.value,"onUpdate:value":e[2]||(e[2]=a=>R.value=a),allowClear:"",placeholder:"输入相册名称",onSearch:P},{addonBefore:s((()=>[r(W,{value:F.value,"onUpdate:value":e[1]||(e[1]=a=>F.value=a)},{default:s((()=>[r(S,{value:""},{default:s((()=>e[9]||(e[9]=[_("全部")]))),_:1,__:[9]}),r(S,{value:"public"},{default:s((()=>e[10]||(e[10]=[_("公开")]))),_:1,__:[10]}),r(S,{value:"private"},{default:s((()=>e[11]||(e[11]=[_("私有")]))),_:1,__:[11]})])),_:1},8,["value"])])),_:1},8,["value"]),r(X,{type:"primary",onClick:T},{default:s((()=>e[12]||(e[12]=[_("新建相册")]))),_:1,__:[12]})]),r(ea,{spinning:J.value},{default:s((()=>[r(Z,{data:A.value,"scrollbar-always-on":!0,fit:""},{default:s((()=>[r(Y,{prop:"name",label:"相册名称"}),r(Y,{label:"所属用户"},{default:s((({row:a})=>[_(h(a.user.username),1)])),_:1}),r(Y,{label:"权限"},{default:s((({row:a})=>[_(h("public"===a.permission?"公开":"私有"),1)])),_:1}),r(Y,{prop:"imageCount",sortable:"",label:"图片数量"}),r(Y,{label:"创建时间"},{default:s((({row:a})=>[_(h(y(q)(a.createdAt)),1)])),_:1}),r(Y,{label:"最后修改时间"},{default:s((({row:a})=>[_(h(y(q)(a.updatedAt)),1)])),_:1}),r(Y,{label:"操作",fixed:"right"},{default:s((({row:a})=>[r(X,{type:"link",onClick:e=>{return l=a,$.value="edit",M.value={...l,userId:l.user._id},void(O.value=!0);var l}},{default:s((()=>e[13]||(e[13]=[_("编辑")]))),_:2,__:[13]},1032,["onClick"]),r(X,{type:"link",danger:"",onClick:e=>(async a=>{d.confirm({title:"确定要删除这个相册吗？",content:"删除相册不会删除相册内的图片的实际文件",async onOk(){var e;try{await j.delete(`/api/admin/albums/${a._id}`),n.success("删除相册成功"),P()}catch({response:l}){n.error(null==(e=null==l?void 0:l.data)?void 0:e.error)}}})})(a)},{default:s((()=>e[14]||(e[14]=[_("删除")]))),_:2,__:[14]},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r(aa,{class:"pagination",current:G.value,"onUpdate:current":e[3]||(e[3]=a=>G.value=a),pageSize:L.value,"onUpdate:pageSize":e[4]||(e[4]=a=>L.value=a),total:K.value,"show-size-changer":"",onChange:P},null,8,["current","pageSize","total"])])),_:1},8,["spinning"]),r(sa,{open:O.value,"onUpdate:open":e[8]||(e[8]=a=>O.value=a),title:"create"===$.value?"新建相册":"编辑相册",onOk:V},{default:s((()=>[r(ra,{model:M.value,rules:N,layout:"vertical",ref_key:"formRef",ref:B},{default:s((()=>["create"===$.value?(p(),k(la,{key:0,label:"用户",name:"userId"},{default:s((()=>[r(W,{value:M.value.userId,"onUpdate:value":e[5]||(e[5]=a=>M.value.userId=a),"show-search":"",placeholder:"请选择用户","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null,loading:D.value,options:E.value,onSearch:Q},null,8,["value","loading","options"])])),_:1})):C("",!0),r(la,{label:"相册名称",name:"name"},{default:s((()=>[r(ua,{value:M.value.name,"onUpdate:value":e[6]||(e[6]=a=>M.value.name=a),placeholder:"请输入相册名称"},null,8,["value"])])),_:1}),r(la,{label:"权限",name:"permission"},{default:s((()=>[r(W,{value:M.value.permission,"onUpdate:value":e[7]||(e[7]=a=>M.value.permission=a)},{default:s((()=>[r(S,{value:"public"},{default:s((()=>e[15]||(e[15]=[_("公开")]))),_:1,__:[15]}),r(S,{value:"private"},{default:s((()=>e[16]||(e[16]=[_("私有")]))),_:1,__:[16]})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"])])}}},[["__scopeId","data-v-fd56ccb0"]]);export{A as default};
