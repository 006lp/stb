import{_ as a,u as e,i as l}from"./index-D-heiWuO.js";import{r as s,o as t,f as u,g as i,h as o,i as n,a0 as v,m as r,k as m,l as g,a1 as d,j as c,y as p,z as y,E as f,q as h,a2 as _,a3 as k,J as w,a4 as b,a5 as x,a6 as V,x as j}from"./vendor-Ct0GE2cv.js";import{e as C}from"./404-D23t8Jcl.js";import{_ as I}from"./ImageInfoModal-DLh9CTU0.js";import"./formatDate-_UAqMSvc.js";const P={class:"gallery-container"},U={style:{"margin-bottom":"20px","text-align":"center"}},z={class:"gallery-content"},D={key:0,class:"loading-more"},K={class:"image-item-tags"},M=["src"],q=["src"],E=a({__name:"Gallery",setup(a){const E=e(),G=s([]),J=s(1),A=s(0),B=s(!1),F=s(!1),H=s(!1),L=s({}),N=s(0),O={1920:{rowPerView:5},1200:{rowPerView:4},800:{rowPerView:3},500:{rowPerView:2}},Q=s([]),R=async()=>{var a;if(!(!B.value&&G.value.length>=A.value&&A.value>0)){B.value=!0,F.value=!1;try{const{data:a}=await l.post("/api/images",k.stringify({page:J.value,limit:20,tags:Q.value}));A.value=a.total,1===J.value?G.value=a.images:G.value.push(...a.images),J.value++,0===G.value.length&&0===A.value&&0===Q.value.length?F.value=!0:F.value=!1}catch(e){w.error(null==(a=null==e?void 0:e.data)?void 0:a.error),F.value=!0}finally{B.value=!1}}},S=()=>{J.value=1,A.value=0,G.value=[],R()};return t((()=>{J.value=1,R()})),(a,e)=>{const l=v,s=f,t=d,k=V,w=b,J=_;return i(),u("div",P,[o("div",U,[n(l,{value:Q.value,"onUpdate:value":e[0]||(e[0]=a=>Q.value=a),mode:"tags",style:{width:"300px"},placeholder:"按标签搜索",onChange:S},null,8,["value"])]),o("div",z,[n(J,{loading:B.value,"item-layout":"horizontal","data-source":G.value},{loadMore:r((()=>[!B.value&&G.value.length<A.value?(i(),u("div",D,[n(s,{class:"loading-more-button",onClick:R},{default:r((()=>e[4]||(e[4]=[h("加载更多")]))),_:1,__:[4]})])):g("",!0)])),default:r((()=>[G.value.length?(i(),m(c(x),{key:0,list:G.value,animationDuration:100,animationDelay:100,breakpoints:O},{default:r((({item:a,index:e})=>[n(t,{src:c(E).config.site.url+a.thumb,preview:{visible:!1},onClick:l=>((a,e)=>{L.value=a,H.value=!0,N.value=e})(a,e)},null,8,["src","onClick"]),o("div",K,[(i(!0),u(p,null,y(a.tags,(a=>(i(),m(k,{key:a,size:"small",onClick:e=>(a=>{Q.value.push(a),S()})(a)},{default:r((()=>[h(j(a),1)])),_:2},1032,["onClick"])))),128))])])),_:1},8,["list"])):F.value&&!B.value?(i(),m(w,{key:1,title:"图片广场空空如也","sub-title":"快来上传你的第一张图片吧~"},{icon:r((()=>[o("img",{src:c(C),class:"ant-result-icon ant-result-image"},null,8,M)])),_:1})):0===G.value.length&&!B.value&&Q.value.length>0?(i(),m(w,{key:2,title:"没有找到匹配的图片","sub-title":"请尝试其他标签"},{icon:r((()=>[o("img",{src:c(C),class:"ant-result-icon ant-result-image"},null,8,q)])),_:1})):g("",!0)])),_:1},8,["loading","data-source"]),n(I,{modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=a=>H.value=a),imageInfo:L.value,"onUpdate:imageInfo":e[2]||(e[2]=a=>L.value=a),imageKey:N.value,"onUpdate:imageKey":e[3]||(e[3]=a=>N.value=a),images:G.value},null,8,["modelValue","imageInfo","imageKey","images"])])])}}},[["__scopeId","data-v-d2e562d2"]]);export{E as default};
