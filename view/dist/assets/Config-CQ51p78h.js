import{_ as O,u as X,l as r,o as Y,c as k,a,w as l,F as Q,C as Z,e as $,I as h,b5 as ee,b6 as ae,b7 as le,g as o,b8 as te,Y as ue,X as ne,b9 as oe,d as F,y as S,ba as ie,bb as de,b as G,bc as se,B as pe,W as re,v as ve,bd as me,T as _e,x as fe,be,A as I,j as m,k as v}from"./index-BJZIGMPf.js";const ke={class:"config-container"},ge={__name:"Config",setup(we){const P=X(),g=r(!1),w=r(!1),W=r("whitelist"),E=r([]),y=r(""),x=r(""),t=r({site:{title:"网站标题",url:"",captcha:!1},upload:{allowedFormats:[],maxSize:5,minWidth:0,minHeight:0,maxWidth:0,maxHeight:0,convertFormat:"",quality:80,dailyLimit:100},watermark:{enabled:!1,type:"text",text:{content:"",fontSize:24,color:"#ffffff",position:"bottom-right"},image:{path:"",opacity:.5,position:"bottom-right"}},ip:{blacklist:[],blacklistEnabled:!1,enabled:!1,whitelist:[],whitelistEnabled:!1}}),H=async()=>{g.value=!0;try{const i=await I.get("/api/admin/config");t.value=i.data,y.value=i.data.ip.whitelist.join(`
`),x.value=i.data.ip.blacklist.join(`
`)}catch{m.error("获取配置失败")}finally{g.value=!1}},T=async i=>{try{const e=new FormData;e.append("image",i);const s=await I.post("/api/admin/upload-watermark",e);return t.value.watermark.image.path=s.data.path,m.success("水印图片上传成功"),!1}catch{return m.error("水印图片上传失败"),!1}},N=i=>{t.value.ip.whitelist=i.target.value.split(`
`).map(e=>e.trim()).filter(e=>e)},q=i=>{t.value.ip.blacklist=i.target.value.split(`
`).map(e=>e.trim()).filter(e=>e)},J=async()=>{var i,e;w.value=!0;try{const s=await I.put("/api/admin/config",t.value);P.setConfig({site:t.value.site}),m.success(s.data.message)}catch(s){m.error((e=(i=s.response)==null?void 0:i.data)==null?void 0:e.error)}finally{w.value=!1}};return Y(H),(i,e)=>{const s=h,n=$,_=ee,f=Z,d=le,U=ae,p=te,b=ne,B=ue,L=oe,z=de,K=ie,c=pe,R=se,V=re,C=me,j=fe,D=_e,M=Q,A=be;return v(),k("div",ke,[a(A,{spinning:g.value},{default:l(()=>[a(M,{model:t.value,layout:"vertical",onFinish:J},{default:l(()=>[a(f,{title:"站点设置",class:"mb-4"},{default:l(()=>[a(n,{label:"网站标题"},{default:l(()=>[a(s,{value:t.value.site.title,"onUpdate:value":e[0]||(e[0]=u=>t.value.site.title=u)},null,8,["value"])]),_:1}),a(n,{label:"网站URL"},{default:l(()=>[a(s,{value:t.value.site.url,"onUpdate:value":e[1]||(e[1]=u=>t.value.site.url=u)},null,8,["value"])]),_:1}),a(n,{label:"验证码"},{default:l(()=>[a(_,{checked:t.value.site.captcha,"onUpdate:checked":e[2]||(e[2]=u=>t.value.site.captcha=u),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])]),_:1})]),_:1}),a(f,{title:"上传设置",class:"mb-4"},{default:l(()=>[a(n,{label:"允许的图片格式"},{default:l(()=>[a(U,{value:t.value.upload.allowedFormats,"onUpdate:value":e[3]||(e[3]=u=>t.value.upload.allowedFormats=u),mode:"multiple",placeholder:"选择允许的图片格式"},{default:l(()=>[a(d,{value:"jpg"},{default:l(()=>e[27]||(e[27]=[o("JPG")])),_:1,__:[27]}),a(d,{value:"jpeg"},{default:l(()=>e[28]||(e[28]=[o("JPEG")])),_:1,__:[28]}),a(d,{value:"png"},{default:l(()=>e[29]||(e[29]=[o("PNG")])),_:1,__:[29]}),a(d,{value:"gif"},{default:l(()=>e[30]||(e[30]=[o("GIF")])),_:1,__:[30]}),a(d,{value:"webp"},{default:l(()=>e[31]||(e[31]=[o("WEBP")])),_:1,__:[31]})]),_:1},8,["value"])]),_:1}),a(n,{label:"最大文件大小(MB)"},{default:l(()=>[a(p,{value:t.value.upload.maxSize,"onUpdate:value":e[4]||(e[4]=u=>t.value.upload.maxSize=u),min:1,max:100},null,8,["value"])]),_:1}),a(n,{label:"最多同时上传图片数量"},{default:l(()=>[a(p,{value:t.value.upload.concurrentUploads,"onUpdate:value":e[5]||(e[5]=u=>t.value.upload.concurrentUploads=u),min:1},null,8,["value"])]),_:1}),a(B,{gutter:16},{default:l(()=>[a(b,{span:12},{default:l(()=>[a(n,{label:"最小宽度(px)"},{default:l(()=>[a(p,{value:t.value.upload.minWidth,"onUpdate:value":e[6]||(e[6]=u=>t.value.upload.minWidth=u),min:0},null,8,["value"])]),_:1})]),_:1}),a(b,{span:12},{default:l(()=>[a(n,{label:"最小高度(px)"},{default:l(()=>[a(p,{value:t.value.upload.minHeight,"onUpdate:value":e[7]||(e[7]=u=>t.value.upload.minHeight=u),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(B,{gutter:16},{default:l(()=>[a(b,{span:12},{default:l(()=>[a(n,{label:"最大宽度(px)"},{default:l(()=>[a(p,{value:t.value.upload.maxWidth,"onUpdate:value":e[8]||(e[8]=u=>t.value.upload.maxWidth=u),min:0},null,8,["value"])]),_:1})]),_:1}),a(b,{span:12},{default:l(()=>[a(n,{label:"最大高度(px)"},{default:l(()=>[a(p,{value:t.value.upload.maxHeight,"onUpdate:value":e[9]||(e[9]=u=>t.value.upload.maxHeight=u),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(n,{label:"转换格式"},{default:l(()=>[a(U,{value:t.value.upload.convertFormat,"onUpdate:value":e[10]||(e[10]=u=>t.value.upload.convertFormat=u),allowClear:"",placeholder:"选择转换格式"},{default:l(()=>[a(d,{value:""},{default:l(()=>e[32]||(e[32]=[o("不转换")])),_:1,__:[32]}),a(d,{value:"jpeg"},{default:l(()=>e[33]||(e[33]=[o("JPEG")])),_:1,__:[33]}),a(d,{value:"png"},{default:l(()=>e[34]||(e[34]=[o("PNG")])),_:1,__:[34]}),a(d,{value:"webp"},{default:l(()=>e[35]||(e[35]=[o("WEBP")])),_:1,__:[35]})]),_:1},8,["value"])]),_:1}),a(n,{label:"图片质量"},{default:l(()=>[a(L,{value:t.value.upload.quality,"onUpdate:value":e[11]||(e[11]=u=>t.value.upload.quality=u),min:1,max:100,marks:{1:"1%",25:"25%",50:"50%",75:"75%",100:"100%"}},null,8,["value"])]),_:1}),a(n,{label:"每日上传限制"},{default:l(()=>[a(p,{value:t.value.upload.dailyLimit,"onUpdate:value":e[12]||(e[12]=u=>t.value.upload.dailyLimit=u),min:0,placeholder:"0表示不限制"},null,8,["value"])]),_:1})]),_:1}),a(f,{title:"水印设置",class:"mb-4"},{default:l(()=>[a(n,null,{default:l(()=>[a(_,{checked:t.value.watermark.enabled,"onUpdate:checked":e[13]||(e[13]=u=>t.value.watermark.enabled=u),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])]),_:1}),t.value.watermark.enabled?(v(),k(S,{key:0},[a(n,{label:"水印类型"},{default:l(()=>[a(K,{value:t.value.watermark.type,"onUpdate:value":e[14]||(e[14]=u=>t.value.watermark.type=u)},{default:l(()=>[a(z,{value:"text"},{default:l(()=>e[36]||(e[36]=[o("文字水印")])),_:1,__:[36]}),a(z,{value:"image"},{default:l(()=>e[37]||(e[37]=[o("图片水印")])),_:1,__:[37]})]),_:1},8,["value"])]),_:1}),t.value.watermark.type==="text"?(v(),k(S,{key:0},[a(n,{label:"水印文字"},{default:l(()=>[a(s,{value:t.value.watermark.text.content,"onUpdate:value":e[15]||(e[15]=u=>t.value.watermark.text.content=u)},null,8,["value"])]),_:1}),a(n,{label:"字体大小"},{default:l(()=>[a(p,{value:t.value.watermark.text.fontSize,"onUpdate:value":e[16]||(e[16]=u=>t.value.watermark.text.fontSize=u),min:12,max:72},null,8,["value"])]),_:1}),a(n,{label:"字体颜色"},{default:l(()=>[a(s,{value:t.value.watermark.text.color,"onUpdate:value":e[17]||(e[17]=u=>t.value.watermark.text.color=u),type:"color"},null,8,["value"])]),_:1})],64)):(v(),k(S,{key:1},[a(n,{label:"上传水印"},{default:l(()=>[a(R,{fileList:E.value,"onUpdate:fileList":e[18]||(e[18]=u=>E.value=u),beforeUpload:T,showUploadList:!1},{default:l(()=>[a(c,null,{default:l(()=>e[38]||(e[38]=[o("选择水印图片")])),_:1,__:[38]})]),_:1},8,["fileList"])]),_:1}),a(n,{label:"水印管理"},{default:l(()=>[a(c,null,{default:l(()=>e[39]||(e[39]=[o("删除水印图片")])),_:1,__:[39]})]),_:1}),t.value.watermark.image.path?(v(),G(n,{key:0,label:"水印图片"},{default:l(()=>[a(V,{src:ve(P).config.site.url+t.value.watermark.image.path},null,8,["src"])]),_:1})):F("",!0),t.value.watermark.image.path?(v(),G(n,{key:1,label:"水印图片URL"},{default:l(()=>[a(C,{value:t.value.watermark.image.path,"onUpdate:value":e[19]||(e[19]=u=>t.value.watermark.image.path=u),"auto-size":"",disabled:""},null,8,["value"])]),_:1})):F("",!0),a(n,{label:"透明度"},{default:l(()=>[a(L,{value:t.value.watermark.image.opacity,"onUpdate:value":e[20]||(e[20]=u=>t.value.watermark.image.opacity=u),min:0,max:1,step:.1},null,8,["value"])]),_:1})],64)),a(n,{label:"水印位置"},{default:l(()=>[a(U,{value:t.value.watermark[t.value.watermark.type].position,"onUpdate:value":e[21]||(e[21]=u=>t.value.watermark[t.value.watermark.type].position=u)},{default:l(()=>[a(d,{value:"top-left"},{default:l(()=>e[40]||(e[40]=[o("左上")])),_:1,__:[40]}),a(d,{value:"top-right"},{default:l(()=>e[41]||(e[41]=[o("右上")])),_:1,__:[41]}),a(d,{value:"bottom-left"},{default:l(()=>e[42]||(e[42]=[o("左下")])),_:1,__:[42]}),a(d,{value:"bottom-right"},{default:l(()=>e[43]||(e[43]=[o("右下")])),_:1,__:[43]}),a(d,{value:"center"},{default:l(()=>e[44]||(e[44]=[o("居中")])),_:1,__:[44]})]),_:1},8,["value"])]),_:1})],64)):F("",!0)]),_:1}),a(f,{title:"IP设置",class:"mb-4"},{default:l(()=>[a(D,{activeKey:W.value,"onUpdate:activeKey":e[26]||(e[26]=u=>W.value=u)},{default:l(()=>[a(j,{key:"whitelist",tab:"白名单"},{default:l(()=>[a(n,null,{default:l(()=>[a(_,{checked:t.value.ip.whitelistEnabled,"onUpdate:checked":e[22]||(e[22]=u=>t.value.ip.whitelistEnabled=u),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])]),_:1}),a(n,{label:"IP白名单"},{default:l(()=>[a(C,{value:y.value,"onUpdate:value":e[23]||(e[23]=u=>y.value=u),rows:4,placeholder:"每行一个IP地址",onChange:N},null,8,["value"])]),_:1})]),_:1}),a(j,{key:"blacklist",tab:"黑名单"},{default:l(()=>[a(n,null,{default:l(()=>[a(_,{checked:t.value.ip.blacklistEnabled,"onUpdate:checked":e[24]||(e[24]=u=>t.value.ip.blacklistEnabled=u),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])]),_:1}),a(n,{label:"IP黑名单"},{default:l(()=>[a(C,{value:x.value,"onUpdate:value":e[25]||(e[25]=u=>x.value=u),rows:4,placeholder:"每行一个IP地址",onChange:q},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["activeKey"])]),_:1}),a(n,null,{default:l(()=>[a(c,{type:"primary","html-type":"submit",loading:w.value},{default:l(()=>e[45]||(e[45]=[o(" 保存设置 ")])),_:1,__:[45]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},xe=O(ge,[["__scopeId","data-v-75271ded"]]);export{xe as default};
