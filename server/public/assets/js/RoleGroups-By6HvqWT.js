import{r as a,o as e,e as l,h as u,k as d,I as t,au as o,f as i,g as n,m as p,a2 as r,p as s,aM as v,aN as c,a7 as f,v as m,j as _,aQ as b,ay as h,am as y,an as x,ao as g,aR as k,aU as U,a0 as w,F as D,x as A,ax as C,V as G,W as q,i as j,aT as R,b0 as F,b1 as H,aY as I}from"./vendor-yaG8ImNT.js";import{_ as O,i as W}from"./index-k-75TJoX.js";import{i as L,a as M,e as S}from"./formatDate-Cfm9J1s9.js";const T={class:"role-groups-container"},Y={class:"header"},z=O({__name:"RoleGroups",setup(O){const z=a(!1),$=a(!1),B=a(!1),N=a(null),Q=a([]),V=Object.entries(L).filter((([a])=>"get"!==a)).map((([a,e])=>({value:a,label:e}))),E=a({name:"",description:"",isAdmin:!1,isDefault:!1,isGuest:!1,upload:{}}),J=[{label:"变量",prop:"variable"},{label:"说明",prop:"description"},{label:"示例",prop:"example"}],K=[{variable:"{Y}",description:"年份（4位）",example:"2024"},{variable:"{y}",description:"年份（2位）",example:"24"},{variable:"{m}",description:"月份",example:"03"},{variable:"{d}",description:"日期",example:"15"},{variable:"{Ymd}",description:"年月日",example:"20240315"},{variable:"{filename}",description:"原始文件名",example:"image"},{variable:"{ext}",description:"文件扩展名",example:"jpg"},{variable:"{time}",description:"时间戳",example:"1748695143942"},{variable:"{uniqid}",description:"唯一ID",example:"a1b2c3d4"},{variable:"{md5}",description:"文件MD5值",example:"d41d8cd98f00b204e9800998ecf8427e"},{variable:"{sha1}",description:"文件SHA1值",example:"da39a3ee5e6b4b0d3255bfef95601890afd80709"},{variable:"{uuid}",description:"UUID",example:"550e8400-e29b-41d4-a716-446655440000"},{variable:"{uid}",description:"用户ID（仅登录用户）",example:"123456"}],P=async(a,e)=>{var l;try{E.value=e?Q.value.find((e=>e._id===a)):{name:"",description:"",isAdmin:!1,isDefault:!1,isGuest:!1,upload:{}},N.value=e,B.value=!0}catch({response:u}){t.error(null==(l=null==u?void 0:u.data)?void 0:l.error)}},X=async()=>{var a;z.value=!0;try{const{data:a}=await W.post("/api/admin/role-groups");Q.value=a}catch({response:e}){t.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}finally{z.value=!1}},Z=async()=>{var a;$.value=!0;try{N.value?(await W.put(`/api/admin/role-groups/${E.value._id}`,E.value),t.success("更新成功")):(await W.post("/api/admin/role-groups/create",E.value),t.success("创建成功")),B.value=!1,X()}catch({response:e}){t.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}finally{$.value=!1}};return e((()=>{X()})),(a,e)=>{const O=r,L=c,aa=f,ea=b,la=v,ua=g,da=x,ta=k,oa=U,ia=C,na=w,pa=R,ra=H,sa=F,va=I,ca=q,fa=G,ma=y,_a=h,ba=o;return i(),l("div",T,[u(ba,{spinning:z.value},{default:d((()=>[n("div",Y,[u(O,{type:"primary",onClick:e[0]||(e[0]=a=>P("",!1))},{default:d((()=>e[21]||(e[21]=[s("创建角色组")]))),_:1,__:[21]})]),u(la,{data:Q.value,"scrollbar-always-on":"",fit:""},{default:d((()=>[u(L,{prop:"name",label:"名称",fixed:""}),u(L,{prop:"description",label:"描述"}),u(L,{label:"管理组"},{default:d((({row:a})=>[u(aa,{color:a.isAdmin?"green":"default"},{default:d((()=>[s(m(a.isAdmin?"是":"否"),1)])),_:2},1032,["color"])])),_:1}),u(L,{label:"默认组"},{default:d((({row:a})=>[u(aa,{color:a.isDefault?"green":"default"},{default:d((()=>[s(m(a.isDefault?"是":"否"),1)])),_:2},1032,["color"])])),_:1}),u(L,{label:"游客组"},{default:d((({row:a})=>[u(aa,{color:a.isGuest?"green":"default"},{default:d((()=>[s(m(a.isGuest?"是":"否"),1)])),_:2},1032,["color"])])),_:1}),u(L,{label:"创建时间"},{default:d((({row:a})=>[s(m(_(M)(a.createdAt)),1)])),_:1}),u(L,{label:"编辑时间"},{default:d((({row:a})=>[s(m(_(M)(a.updatedAt)),1)])),_:1}),u(L,{label:"操作",fixed:"right"},{default:d((({row:a})=>[u(O,{type:"link",onClick:e=>P(a._id,!0)},{default:d((()=>e[22]||(e[22]=[s("编辑")]))),_:2,__:[22]},1032,["onClick"]),u(ea,{title:"确定要删除这个角色组吗？",onConfirm:e=>(async a=>{var e;try{await W.delete(`/api/admin/role-groups/${a._id}`),t.success("删除成功"),X()}catch({response:l}){t.error(null==(e=null==l?void 0:l.data)?void 0:e.error)}})(a)},{default:d((()=>[u(O,{type:"link",danger:""},{default:d((()=>e[23]||(e[23]=[s("删除")]))),_:1,__:[23]})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),(i(),p(_a,{class:"RoleGroups-model",open:B.value,"onUpdate:open":e[20]||(e[20]=a=>B.value=a),title:N.value?"编辑角色组":"创建角色组",onOk:Z,confirmLoading:$.value,key:B.value},{default:d((()=>[u(ma,{model:E.value,layout:"vertical"},{default:d((()=>[u(da,{label:"名称",required:""},{default:d((()=>[u(ua,{value:E.value.name,"onUpdate:value":e[1]||(e[1]=a=>E.value.name=a),placeholder:"输入角色组名称"},null,8,["value"])])),_:1}),u(da,{label:"描述"},{default:d((()=>[u(ta,{value:E.value.description,"onUpdate:value":e[2]||(e[2]=a=>E.value.description=a),placeholder:"输入角色组描述"},null,8,["value"])])),_:1}),u(da,{label:"是否为管理组"},{default:d((()=>[u(oa,{checked:E.value.isAdmin,"onUpdate:checked":e[3]||(e[3]=a=>E.value.isAdmin=a)},null,8,["checked"])])),_:1}),u(da,{label:"是否为默认组"},{default:d((()=>[u(oa,{checked:E.value.isDefault,"onUpdate:checked":e[4]||(e[4]=a=>E.value.isDefault=a)},null,8,["checked"])])),_:1}),u(da,{label:"是否为游客组"},{default:d((()=>[u(oa,{checked:E.value.isGuest,"onUpdate:checked":e[5]||(e[5]=a=>E.value.isGuest=a)},null,8,["checked"])])),_:1}),u(da,{label:"存储类型"},{default:d((()=>[u(na,{value:E.value.upload.storageType,"onUpdate:value":e[6]||(e[6]=a=>E.value.upload.storageType=a)},{default:d((()=>[(i(!0),l(D,null,A(_(V),((a,e)=>(i(),p(ia,{value:a.value,key:e},{default:d((()=>[s(m(a.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),u(fa,null,{default:d((()=>[u(ca,{header:"上传设置"},{default:d((()=>[u(da,{label:"允许的图片格式"},{default:d((()=>[u(na,{value:E.value.upload.allowedFormats,"onUpdate:value":e[7]||(e[7]=a=>E.value.upload.allowedFormats=a),mode:"multiple",placeholder:"选择允许的图片格式"},{default:d((()=>[(i(!0),l(D,null,A(_(S),(a=>(i(),p(ia,{value:a,key:a},{default:d((()=>[s(m(a.toUpperCase()),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),u(da,{label:"最大文件大小(MB)"},{default:d((()=>[u(pa,{style:{width:"100%"},value:E.value.upload.maxSize,"onUpdate:value":e[8]||(e[8]=a=>E.value.upload.maxSize=a),min:1,max:100},null,8,["value"])])),_:1}),u(da,{label:"最多同时上传图片数量"},{default:d((()=>[u(pa,{style:{width:"100%"},value:E.value.upload.concurrentUploads,"onUpdate:value":e[9]||(e[9]=a=>E.value.upload.concurrentUploads=a),min:1},null,8,["value"])])),_:1}),u(sa,{gutter:16},{default:d((()=>[u(ra,{span:12},{default:d((()=>[u(da,{label:"最小宽度(px)"},{default:d((()=>[u(pa,{value:E.value.upload.minWidth,"onUpdate:value":e[10]||(e[10]=a=>E.value.upload.minWidth=a),min:0},null,8,["value"])])),_:1})])),_:1}),u(ra,{span:12},{default:d((()=>[u(da,{label:"最小高度(px)"},{default:d((()=>[u(pa,{value:E.value.upload.minHeight,"onUpdate:value":e[11]||(e[11]=a=>E.value.upload.minHeight=a),min:0},null,8,["value"])])),_:1})])),_:1})])),_:1}),u(sa,{gutter:16},{default:d((()=>[u(ra,{span:12},{default:d((()=>[u(da,{label:"最大宽度(px)"},{default:d((()=>[u(pa,{value:E.value.upload.maxWidth,"onUpdate:value":e[12]||(e[12]=a=>E.value.upload.maxWidth=a),min:0},null,8,["value"])])),_:1})])),_:1}),u(ra,{span:12},{default:d((()=>[u(da,{label:"最大高度(px)"},{default:d((()=>[u(pa,{value:E.value.upload.maxHeight,"onUpdate:value":e[13]||(e[13]=a=>E.value.upload.maxHeight=a),min:0},null,8,["value"])])),_:1})])),_:1})])),_:1}),u(da,{label:"转换格式"},{default:d((()=>[u(na,{value:E.value.upload.convertFormat,"onUpdate:value":e[14]||(e[14]=a=>E.value.upload.convertFormat=a),allowClear:"",placeholder:"选择转换格式"},{default:d((()=>[u(ia,{value:""},{default:d((()=>e[24]||(e[24]=[s("不转换")]))),_:1,__:[24]}),(i(!0),l(D,null,A(_(S),(a=>(i(),p(ia,{value:a,key:a},{default:d((()=>[s(m(a.toUpperCase()),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),u(da,{label:"图片压缩"},{default:d((()=>[u(oa,{checked:E.value.upload.qualityOpen,"onUpdate:checked":e[15]||(e[15]=a=>E.value.upload.qualityOpen=a),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),E.value.upload.qualityOpen?(i(),p(da,{key:0,label:"图片质量"},{default:d((()=>[u(va,{value:E.value.upload.quality,"onUpdate:value":e[16]||(e[16]=a=>E.value.upload.quality=a),min:1,max:100,marks:{1:"1%",25:"25%",50:"50%",75:"75%",100:"100%"}},null,8,["value"])])),_:1})):j("",!0),u(da,{label:"每日上传限制"},{default:d((()=>[u(pa,{style:{width:"100%"},value:E.value.upload.dailyLimit,"onUpdate:value":e[17]||(e[17]=a=>E.value.upload.dailyLimit=a),min:0,placeholder:"0表示不限制"},null,8,["value"]),e[25]||(e[25]=n("p",null,"该功能仅限制已登录用户, 游客模式下无效",-1))])),_:1,__:[25]}),u(da,{label:"文件目录命名规则"},{default:d((()=>[u(ua,{value:E.value.upload.catalogue,"onUpdate:value":e[18]||(e[18]=a=>E.value.upload.catalogue=a),placeholder:"输入文件目录命名规则"},null,8,["value"]),e[26]||(e[26]=n("p",null,'目录命名规则不能以"/"结尾, 不能包含"\\"',-1))])),_:1,__:[26]}),u(da,{label:"文件名命名规则"},{default:d((()=>[u(ua,{value:E.value.upload.namingRule,"onUpdate:value":e[19]||(e[19]=a=>E.value.upload.namingRule=a),placeholder:"输入文件命名规则"},null,8,["value"]),e[27]||(e[27]=n("p",null,'文件名命名规则中不能含有"/"和"\\"',-1)),e[28]||(e[28]=n("p",null,'如果设置了"格式转换", 文件后缀将以"转换后"的格式为准',-1))])),_:1,__:[27,28]}),u(fa,{class:"namingRule-collapse"},{default:d((()=>[u(ca,{header:"支持的命名规则"},{default:d((()=>[u(la,{data:K},{default:d((()=>[(i(),l(D,null,A(J,((a,e)=>u(L,{prop:a.prop,label:a.label,key:e},null,8,["prop","label"]))),64))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title","confirmLoading"]))])),_:1},8,["spinning"])])}}},[["__scopeId","data-v-88c61e2b"]]);export{z as default};
