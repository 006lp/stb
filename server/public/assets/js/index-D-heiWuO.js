const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Docs-DMcbtSZ4.js","assets/js/vendor-Ct0GE2cv.js","assets/css/vendor-Df23LWjm.css","assets/css/Docs-CH1DIOFv.css","assets/js/Gallery-CTNM7UfU.js","assets/js/404-D23t8Jcl.js","assets/js/ImageInfoModal-DLh9CTU0.js","assets/js/formatDate-_UAqMSvc.js","assets/css/ImageInfoModal-C5GRzk-x.css","assets/css/Gallery-CuJYT6ws.css","assets/js/Home-De4ZFrZW.js","assets/css/Home-CJc9H4c0.css","assets/js/Login-CX3QwHy_.js","assets/js/Captcha-D6sqaGmE.js","assets/css/Captcha-CvflNxUe.css","assets/css/Login-CSg1sMM2.css","assets/js/My-CA7Uzf9Q.js","assets/css/My-DVqF9g12.css","assets/js/Not-fPMTXDN8.js","assets/js/Register-Da-WCWcy.js","assets/css/Register-C7snBmAr.css","assets/js/ResetPassword-e44D754r.js","assets/css/ResetPassword-DznM_2IO.css","assets/js/Settings-DbdexbpU.js","assets/css/Settings-BPVwvRpw.css","assets/js/Albums-tcZKo2Ku.js","assets/css/Albums-DKoL8F6k.css","assets/js/Config-B4_W8JiG.js","assets/css/Config-3kOB9uRR.css","assets/js/Dashboard-6PV41lmK.js","assets/css/Dashboard-CMeUS86o.css","assets/js/Images-Dqe_ioUj.js","assets/css/Images-ODzwtMMy.css","assets/js/InviteCodes-CcFH5ZZc.js","assets/css/InviteCodes-DPm_JFQR.css","assets/js/Logs-CF1rXGim.js","assets/css/Logs-DZInL8tk.css","assets/js/Roles-Dk5jMeuy.js","assets/js/Users-C9Iz6sRC.js","assets/css/Users-B5-GUMKa.css","assets/js/UserPage-BT7whOXo.js","assets/css/UserPage-Tzeg7wyp.css","assets/js/UserPublicAlbumDetail-CsORF5JM.js","assets/css/UserPublicAlbumDetail-C7JQ2f0J.css"])))=>i.map(i=>d[i]);
import{d as e,a as t,u as s,b as n,r as o,c as a,H as r,S as i,F as l,Q as u,w as c,o as d,e as m,f as _,g as v,h as p,i as g,j as f,M as h,k as y,l as E,m as w,n as b,A as P,U as k,p as O,_ as A,q as L,s as R,t as D,L as I,D as j,v as T,x as V,y as C,z as S,B as U,C as N,P as $,E as M,G as q,I as J,J as z,K,N as B,O as G,R as H,T as x}from"./vendor-Ct0GE2cv.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const F=e("user",{state:()=>({ip:null,user:null,token:null,config:null,activeKey:"1"}),getters:{menuVisibility:e=>{var t,s,n,o;return{home:!0,my:!!e.token,gallery:!!(null==(s=null==(t=e.config)?void 0:t.site)?void 0:s.gallery),docs:!!(null==(o=null==(n=e.config)?void 0:n.site)?void 0:o.api)}}},persist:{key:"stb",storage:localStorage,serializer:{serialize:e=>JSON.stringify(e),deserialize:e=>JSON.parse(e)}}}),Q=e=>{const{method:t,url:s,params:n,data:o}=e;return[t,s,JSON.stringify(n),JSON.stringify(o)].join("&")},W=new Map,X=e=>{const t=Q(e);if(W.has(t)){W.get(t)(t),W.delete(t)}},Y=t.create({baseURL:"",timeout:1e4});Y.interceptors.request.use((e=>{X(e),(e=>{const s=Q(e);e.cancelToken=e.cancelToken||new t.CancelToken((e=>{W.has(s)||W.set(s,e)}))})(e);const{token:s}=JSON.parse(localStorage.getItem("stb"))||{};return e.headers.Authorization=s?`Bearer ${s}`:"",e}),(e=>Promise.reject(e))),Y.interceptors.response.use((e=>(X(e.config),e)),(e=>{var t,s;const n=JSON.parse(localStorage.getItem("stb"))||{};return(null==(t=null==n?void 0:n.site)?void 0:t.anonymousUpload)||401!==(null==(s=e.response)?void 0:s.status)||(localStorage.removeItem("stb"),location.href="/login"),X(e.config||{}),Promise.reject(e)}));const Z=(e,t)=>{const s=e.__vccOpts||e;for(const[n,o]of t)s[n]=o;return s},ee={class:"app"},te={class:"app-header"},se={class:"app-header-left"},ne={class:"app-header-right"},oe={class:"logo"},ae={class:"footer"},re=Z({__name:"App",setup(e){const t=s(),K=n(),B=F(),G=o(["home"]),H=o(!1),x=o({ipv4:"",ipv6:""}),Q=[{name:"home",title:"图床首页",url:"/home",icon:r},{name:"my",title:"我的图片",url:"/my",icon:i},{name:"gallery",title:"图片广场",url:"/gallery",icon:l},{name:"docs",title:"接口文档",url:"/docs",icon:u}],W=a((()=>{var e,t;const s=null==(t=null==(e=B.config)?void 0:e.site)?void 0:t.navigationOrder;return[...Q].sort(((e,t)=>s.indexOf(e.name)-s.indexOf(t.name))).map((e=>({...e,show:B.menuVisibility[e.name]})))})),X=[{name:"dashboard",title:"仪表盘"},{name:"logs",title:"日志管理"},{name:"users",title:"用户管理"},{name:"images",title:"图片管理"},{name:"albums",title:"相册管理"},{name:"invitecodes",title:"邀请码管理"},{name:"config",title:"系统配置"}],Z=()=>{B.user=null,B.token=null,K.push("/login"),z.warning("账号已退出")},re=e=>{const t=e.split("/").filter(Boolean);if(["register","reset-password"].includes(t[0]))return G.value=["login"];G.value=t.length>1?[t[1]]:[t[0]||"home"]};return c((()=>t.path),(async e=>{await(e=>{const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.qq.com"},{urls:"stun:stun.cloudflare.com:3478"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]});t.createDataChannel(""),t.createOffer().then((e=>t.setLocalDescription(e))),t.onicecandidate=t=>{t.candidate&&e(t.candidate.candidate.split(" ")[4])}})((e=>{try{/\b(?:\d{1,3}\.){3}\d{1,3}\b/.test(e)?x.value.ipv4=e:/^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(e)&&(x.value.ipv6=e),B.ip=x.value}catch(t){console.error(t)}})),re(e)})),d((async()=>{if((async()=>{var e;try{const{data:e}=await Y.post("/api/auth/config");B.config=e}catch({response:t}){z.error(null==(e=null==t?void 0:t.data)?void 0:e.error)}})(),re(location.pathname),(()=>{const e=new URLSearchParams(location.search),t=e.get("token"),s=e.get("isBind");t&&(B.token=t,history.replaceState({},document.title,location.pathname),"true"===s?K.push("/settings"):K.push("/"))})(),B.token)try{await(async()=>{var e;try{const{data:e}=await Y.post("/api/auth/info");B.user=e}catch({response:t}){z.error(null==(e=null==t?void 0:t.data)?void 0:e.error)}})()}catch(e){Z()}})),(e,t)=>{const s=P,n=A,o=D,a=O,r=j,i=m("router-link"),l=N,u=m("router-view"),c=M,d=J;return v(),_("div",ee,[p("div",te,[p("div",se,[p("div",{class:"hamburger",onClick:t[0]||(t[0]=e=>H.value=!H.value)},[g(f(h))])]),p("div",ne,[f(B).token?(v(),y(r,{key:0,arrow:{pointAtCenter:!0}},{overlay:w((()=>[g(a,null,{default:w((()=>[g(n,{key:"user",onClick:t[2]||(t[2]=e=>f(K).push(`/user/${f(B).user._id}`))},{default:w((()=>[g(f(k)),t[6]||(t[6]=L(" 个人主页 "))])),_:1,__:[6]}),g(n,{key:"settings",onClick:t[3]||(t[3]=e=>f(K).push("/settings"))},{default:w((()=>[g(f(R)),t[7]||(t[7]=L(" 个人设置 "))])),_:1,__:[7]}),g(o),g(n,{key:"logout",onClick:Z},{default:w((()=>[g(f(I)),t[8]||(t[8]=L(" 退出登录 "))])),_:1,__:[8]})])),_:1})])),default:w((()=>{var e;return[p("a",{class:"user-dropdown",onClick:t[1]||(t[1]=b((()=>{}),["prevent"]))},[g(s,{size:32,src:f(B).config.site.url+(null==(e=f(B).user)?void 0:e.avatar)},{icon:w((()=>[g(f(k))])),_:1},8,["src"])])]})),_:1})):E("",!0)])]),g(d,{locale:f(q)},{default:w((()=>[p("div",{class:T(["mask",{"mask-active":H.value}]),onClick:t[4]||(t[4]=e=>H.value=!1)},null,2),p("div",{class:T(["menu",{"menu-active":H.value}])},[p("div",oe,[g(i,{to:"/"},{default:w((()=>{var e,t;return[L(V(null==(t=null==(e=f(B).config)?void 0:e.site)?void 0:t.title),1)]})),_:1})]),g(a,{selectedKeys:G.value,"onUpdate:selectedKeys":t[5]||(t[5]=e=>G.value=e),"open-keys":["admin"],theme:"dark",mode:"inline"},{default:w((()=>{var e;return[(v(!0),_(C,null,S(W.value,(e=>(v(),_(C,null,[e.show?(v(),y(n,{key:e.name},{default:w((()=>[g(i,{to:e.url},{default:w((()=>[(v(),y(U(e.icon))),L(" "+V(e.title),1)])),_:2},1032,["to"])])),_:2},1024)):E("",!0)],64)))),256)),(null==(e=f(B).user)?void 0:e.founder)?(v(),y(l,{key:"admin"},{title:w((()=>[p("span",null,[g(f(R)),t[9]||(t[9]=L(" 后台管理 "))])])),default:w((()=>[(v(),_(C,null,S(X,(e=>g(n,{key:e.name},{default:w((()=>[g(i,{to:`/admin/${e.name}`},{default:w((()=>[L(V(e.title),1)])),_:2},1032,["to"])])),_:2},1024))),64))])),_:1})):E("",!0),f(B).token?E("",!0):(v(),y(n,{key:"login"},{default:w((()=>[g(i,{to:"/login"},{default:w((()=>[g(f(k)),t[10]||(t[10]=L(" 注册 / 登录 "))])),_:1,__:[10]})])),_:1})),f(B).token?(v(),y(n,{key:"logout",style:{float:"right"},onClick:Z},{default:w((()=>[g(f($)),t[11]||(t[11]=L(" 退出登录 "))])),_:1,__:[11]})):E("",!0)]})),_:1},8,["selectedKeys"])],2),p("div",{class:T(["content",G.value])},[g(u)],2),p("div",ae,[t[13]||(t[13]=L(" All rights reserved © 2025 ")),g(c,{class:"goLink",type:"link",href:"https://github.com/setube/stb",target:"_blank"},{default:w((()=>t[12]||(t[12]=[L("Stb")]))),_:1,__:[12]})])])),_:1},8,["locale"])])}}},[["__scopeId","data-v-0f6e017f"]]),ie={},le=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map((e=>Promise.resolve(e).then((e=>({status:"fulfilled",value:e})),(e=>({status:"rejected",reason:e}))))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=(null==s?void 0:s.nonce)||(null==s?void 0:s.getAttribute("nonce"));n=e(t.map((e=>{if((e=function(e){return"/"+e}(e))in ie)return;ie[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,o&&n.setAttribute("nonce",o),document.head.appendChild(n),t?new Promise(((t,s)=>{n.addEventListener("load",t),n.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then((t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)}))},ue=(e,t,s)=>{const n=e[t];return n?"function"==typeof n?n():Promise.resolve(n):new Promise(((e,n)=>{("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==s?". Note that variables only represent file names one level deep.":""))))}))},ce=["Dashboard","Users","Images","Config","Logs","InviteCodes","Albums"],de=["404","RootRedirect","Login","Register","Home","Gallery","Docs","My","ResetPassword","Settings","admin","UserPage","UserPublicAlbumDetail"].map((e=>{let t={path:`/${e.toLowerCase()}`,name:e,component:()=>ue(Object.assign({"../views/Docs.vue":()=>le((()=>import("./Docs-DMcbtSZ4.js")),__vite__mapDeps([0,1,2,3])),"../views/Gallery.vue":()=>le((()=>import("./Gallery-CTNM7UfU.js")),__vite__mapDeps([4,1,2,5,6,7,8,9])),"../views/Home.vue":()=>le((()=>import("./Home-De4ZFrZW.js")),__vite__mapDeps([10,1,2,7,11])),"../views/Login.vue":()=>le((()=>import("./Login-CX3QwHy_.js")),__vite__mapDeps([12,1,2,13,14,15])),"../views/My.vue":()=>le((()=>import("./My-CA7Uzf9Q.js")),__vite__mapDeps([16,1,2,7,6,8,17])),"../views/Not.vue":()=>le((()=>import("./Not-fPMTXDN8.js")),__vite__mapDeps([18,5,1,2])),"../views/Register.vue":()=>le((()=>import("./Register-Da-WCWcy.js")),__vite__mapDeps([19,1,2,13,14,20])),"../views/ResetPassword.vue":()=>le((()=>import("./ResetPassword-e44D754r.js")),__vite__mapDeps([21,1,2,22])),"../views/Settings.vue":()=>le((()=>import("./Settings-DbdexbpU.js")),__vite__mapDeps([23,1,2,24]))}),`../views/${e}.vue`,3)};return"404"===e&&(t={path:"/:pathMatch(.*)*",name:e,component:()=>le((()=>import("./Not-fPMTXDN8.js")),__vite__mapDeps([18,5,1,2]))}),"RootRedirect"===e&&(t={path:"/",name:e,component:()=>le((()=>import("./Home-De4ZFrZW.js")),__vite__mapDeps([10,1,2,7,11]))}),"admin"===e&&(t={path:"/admin",redirect:"/admin/dashboard",children:ce.map((e=>({path:e.toLowerCase(),name:e,component:()=>ue(Object.assign({"../views/admin/Albums.vue":()=>le((()=>import("./Albums-tcZKo2Ku.js")),__vite__mapDeps([25,1,2,7,26])),"../views/admin/Config.vue":()=>le((()=>import("./Config-B4_W8JiG.js")),__vite__mapDeps([27,1,2,7,28])),"../views/admin/Dashboard.vue":()=>le((()=>import("./Dashboard-6PV41lmK.js")),__vite__mapDeps([29,1,2,30])),"../views/admin/Images.vue":()=>le((()=>import("./Images-Dqe_ioUj.js")),__vite__mapDeps([31,1,2,7,32])),"../views/admin/InviteCodes.vue":()=>le((()=>import("./InviteCodes-CcFH5ZZc.js")),__vite__mapDeps([33,1,2,7,34])),"../views/admin/Logs.vue":()=>le((()=>import("./Logs-CF1rXGim.js")),__vite__mapDeps([35,1,2,7,36])),"../views/admin/Roles.vue":()=>le((()=>import("./Roles-Dk5jMeuy.js")),__vite__mapDeps([37,1,2])),"../views/admin/Users.vue":()=>le((()=>import("./Users-C9Iz6sRC.js")),__vite__mapDeps([38,1,2,7,39]))}),`../views/admin/${e}.vue`,4)})))}),"UserPage"===e&&(t={path:"/user/:userId",name:e,component:()=>ue(Object.assign({"../views/user/UserPage.vue":()=>le((()=>import("./UserPage-BT7whOXo.js")),__vite__mapDeps([40,1,2,7,41])),"../views/user/UserPublicAlbumDetail.vue":()=>le((()=>import("./UserPublicAlbumDetail-CsORF5JM.js")),__vite__mapDeps([42,1,2,43]))}),`../views/user/${e}.vue`,4)}),"UserPublicAlbumDetail"===e&&(t={path:"/user/:userId/album/:albumId",name:e,component:()=>ue(Object.assign({"../views/user/UserPage.vue":()=>le((()=>import("./UserPage-BT7whOXo.js")),__vite__mapDeps([40,1,2,7,41])),"../views/user/UserPublicAlbumDetail.vue":()=>le((()=>import("./UserPublicAlbumDetail-CsORF5JM.js")),__vite__mapDeps([42,1,2,43]))}),`../views/user/${e}.vue`,4)}),t})),me=K({history:B(),routes:de});me.beforeEach(((e,t,s)=>{var n,o,a,r;const{config:i,token:l,user:u}=F();if("/"===e.path){const t=null==(n=null==i?void 0:i.site)?void 0:n.navigationOrder[0],o=t.replace(t[0],t[0].toUpperCase());if(e.name!==o)return s({name:o})}return("Docs"!==e.name||(null==(o=null==i?void 0:i.site)?void 0:o.api))&&("Register"!==e.name||(null==(a=null==i?void 0:i.site)?void 0:a.register))&&("Gallery"!==e.name||(null==(r=null==i?void 0:i.site)?void 0:r.gallery))&&("Admin"!==e.name||l&&"admin"===(null==u?void 0:u.role))?"My"!==e.name||l?void s():s("/login"):s({name:"404"})}));const _e=G(re),ve=H();ve.use(x),_e.use(ve),_e.use(me),_e.mount("#app");export{Z as _,Y as i,F as u};
