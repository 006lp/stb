import{r as a,o as e,f as l,h as r,i as t,m as o,a3 as u,J as s,aH as n,aq as i,as as d,au as v,g as c,aI as p,l as _,aJ as f,a1 as m,j as b,q as g,x as k,y as w,a6 as h,E as y,ai as x,aj as C,aO as I,a0 as U,at as j}from"./vendor-Ct0GE2cv.js";import{_ as z,u as S,i as D}from"./index-D-heiWuO.js";import{f as H,i as O,d as P,e as q,a as A,c as J}from"./formatDate-_UAqMSvc.js";const M={class:"images"},$={class:"header"},E=z({__name:"Images",setup(z){const E=S(),Q=a([]),B=a(!1),F=a(1),G=a(10),K=a(0),L=a(""),N=a(!1),R=a({_id:"",remarks:"",orientation:"0"}),T={remarks:[{max:500,message:"备注不能超过500个字符",trigger:"blur"}]},V=async()=>{var a;B.value=!0,Q.value=[];try{const{data:a}=await D.post("/api/admin/images",u.stringify({page:F.value,limit:G.value,searchQuery:L.value}));K.value=a.total,Q.value.push(...a.images)}catch({response:e}){s.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}finally{B.value=!1}},W=()=>{F.value=1,V()},X=async()=>{var a;try{const{_id:a,remarks:e,orientation:l}=R.value;await D.patch(`/api/admin/images/${a}`,{remarks:e,orientation:parseInt(l)}),s.success("图片数据更新成功"),N.value=!1,V()}catch({response:e}){s.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}};return e(V),(a,e)=>{const u=n,z=m,S=f,Y=h,Z=y,aa=p,ea=i,la=d,ra=I,ta=C,oa=j,ua=U,sa=x,na=v;return c(),l("div",M,[r("div",$,[t(u,{value:L.value,"onUpdate:value":e[0]||(e[0]=a=>L.value=a),placeholder:"搜索文件名/MD5/SHA-1/备注/IP",style:{width:"260px","margin-right":"10px"},onSearch:W,"allow-clear":""},null,8,["value"])]),t(ea,{spinning:B.value},{default:o((()=>[t(aa,{data:Q.value,"scrollbar-always-on":!0,fit:""},{default:o((()=>{var a,r;return[t(S,{label:"预览",fixed:""},{default:o((({row:a})=>[t(z,{src:b(E).config.site.url+a.thumb,fallback:"local"===a.type?b(E).config.site.url+a.url:a.url,preview:{src:"local"==a.type?b(E).config.site.url+a.url:a.url}},null,8,["src","fallback","preview"])])),_:1}),t(S,{prop:"name",label:"文件名"}),t(S,{prop:"md5",label:"MD5"}),t(S,{prop:"sha1",label:"SHA-1"}),t(S,{sortable:"",label:"大小"},{default:o((({row:a})=>[g(k(b(H)(a.size)),1)])),_:1}),t(S,{prop:"album",label:"相册"},{default:o((({row:a})=>{var e;return[g(k((null==(e=a.album)?void 0:e.name)||"独立图片"),1)]})),_:1}),t(S,{prop:"remarks",label:"备注"},{default:o((({row:a})=>[g(k(a.remarks||"暂无备注"),1)])),_:1}),t(S,{label:"类型"},{default:o((({row:a})=>[g(k(b(O)[a.type]),1)])),_:1}),(null==(r=null==(a=b(E).config)?void 0:a.ai)?void 0:r.enabled)?(c(),l(w,{key:0},[t(S,{label:"健康状态"},{default:o((({row:a})=>{var e;return[t(Y,{color:null==(e=b(P)[a.safe])?void 0:e.color},{default:o((()=>{var e;return[g(k(null==(e=b(P)[a.safe])?void 0:e.text),1)]})),_:2},1032,["color"])]})),_:1}),t(S,{label:"检测结果"},{default:o((({row:a})=>{var e,l;return[t(Y,{color:b(q)[a.label]?null==(e=b(q)[a.label])?void 0:e.color:null==(l=b(P)[a.safe])?void 0:l.color},{default:o((()=>{var e;return[g(k(b(q)[a.label]?null==(e=b(q)[a.label])?void 0:e.text:a.label),1)]})),_:2},1032,["color"])]})),_:1})],64)):_("",!0),t(S,{label:"存储目录"},{default:o((({row:a})=>[g(k(a.filePath),1)])),_:1}),t(S,{label:"上传者"},{default:o((({row:a})=>[g(k(a.user?a.user.username:"游客"),1)])),_:1}),t(S,{prop:"ip",label:"IP地址"}),t(S,{sortable:"",label:"上传时间"},{default:o((({row:a})=>[g(k(b(A)(a.date)),1)])),_:1}),t(S,{label:"操作",fixed:"right",width:"150"},{default:o((({row:a})=>[t(Z,{type:"link",onClick:e=>b(J)(e,a,b(E))},{default:o((()=>e[7]||(e[7]=[g("复制")]))),_:2,__:[7]},1032,["onClick"]),t(Z,{type:"link",onClick:e=>{return l=a,R.value=l,R.value.orientation="0",void(N.value=!0);var l}},{default:o((()=>e[8]||(e[8]=[g("编辑")]))),_:2,__:[8]},1032,["onClick"]),t(Z,{type:"link",danger:"",onClick:e=>{return l=a._id,void v.confirm({title:"确认删除",content:"确定要删除这张图片吗？",async onOk(){var a;try{await D.delete(`/api/admin/images/${l}`),s.success("删除成功"),V()}catch({response:e}){s.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}}});var l}},{default:o((()=>e[9]||(e[9]=[g("删除")]))),_:2,__:[9]},1032,["onClick"])])),_:1})]})),_:1},8,["data"])])),_:1},8,["spinning"]),t(la,{class:"pagination",current:F.value,"onUpdate:current":e[1]||(e[1]=a=>F.value=a),"page-size":G.value,"onUpdate:pageSize":e[2]||(e[2]=a=>G.value=a),total:K.value,"show-size-changer":"",onChange:V},null,8,["current","page-size","total"]),t(na,{open:N.value,"onUpdate:open":e[5]||(e[5]=a=>N.value=a),title:"编辑图片",onOk:X,onCancel:e[6]||(e[6]=a=>N.value=!1)},{default:o((()=>[t(sa,{model:R.value,rules:T,layout:"vertical"},{default:o((()=>[t(ta,{label:"备注",name:"remarks"},{default:o((()=>[t(ra,{value:R.value.remarks,"onUpdate:value":e[3]||(e[3]=a=>R.value.remarks=a),placeholder:"添加图片备注",rows:4},null,8,["value"])])),_:1}),t(ta,{label:"图片方向",name:"orientation"},{default:o((()=>[t(ua,{value:R.value.orientation,"onUpdate:value":e[4]||(e[4]=a=>R.value.orientation=a),style:{width:"100%"},disabled:"local"!==R.value.type},{default:o((()=>[t(oa,{value:"0"},{default:o((()=>e[10]||(e[10]=[g("原始方向")]))),_:1,__:[10]}),t(oa,{value:"90"},{default:o((()=>e[11]||(e[11]=[g("顺时针旋转90°")]))),_:1,__:[11]}),t(oa,{value:"-90"},{default:o((()=>e[12]||(e[12]=[g("逆时针旋转90°")]))),_:1,__:[12]}),t(oa,{value:"180"},{default:o((()=>e[13]||(e[13]=[g("旋转180°")]))),_:1,__:[13]}),t(oa,{value:"270"},{default:o((()=>e[14]||(e[14]=[g("顺时针旋转270°")]))),_:1,__:[14]}),t(oa,{value:"-270"},{default:o((()=>e[15]||(e[15]=[g("逆时针旋转270°")]))),_:1,__:[15]})])),_:1},8,["value","disabled"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"])])}}},[["__scopeId","data-v-8d0f2253"]]);export{E as default};
