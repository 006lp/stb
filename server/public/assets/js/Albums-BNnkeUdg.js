import{r as a,o as e,e as l,g as u,h as r,k as s,a4 as t,I as o,aL as n,a2 as i,au as v,ay as d,f as p,a0 as c,ax as m,p as _,aM as f,aN as b,v as y,j as h,aw as g,am as w,m as k,i as C,an as I,ao as U}from"./vendor-DLaggKmm.js";import{_ as S,i as A}from"./index-CxgfQBo3.js";import{a as j}from"./formatDate-DJT1dS-E.js";const x={class:"admin-albums"},z={class:"search-area"},q=S({__name:"Albums",setup(S){const q=a([]),O=a(!1),$=a(!1),B=a("create"),D=a(null),L=a(!1),M=a([]),N=a(""),R=a(""),E=a(""),F=a(1),G=a(0),H=a(10),J=a({userId:void 0,name:"",permission:"private"}),K={userId:[{required:!0,message:"请选择用户"}],name:[{required:!0,message:"请输入相册名称"}],permission:[{required:!0,message:"请选择权限"}]},P=async()=>{var a;O.value=!0;try{const{data:a}=await A.post("/api/admin/albums",t.stringify({page:F.value,limit:H.value,name:R.value,username:N.value,permission:E.value}));q.value=a.albums,G.value=a.total}catch({response:e}){o.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}finally{O.value=!1}},Q=async a=>{var e;if(a){L.value=!0;try{const{data:e}=await A.post("/api/admin/users/search",t.stringify({username:a}));M.value=e.users}catch({response:l}){o.error(null==(e=null==l?void 0:l.data)?void 0:e.error)}finally{L.value=!1}}},T=()=>{B.value="create",J.value={userId:void 0,name:"",permission:"private"},$.value=!0},V=async()=>{var a;try{"create"===B.value?(await A.post("/api/admin/albums/new",J.value),o.success("创建相册成功")):(await A.put(`/api/admin/albums/${J.value._id}`,J.value),o.success("更新相册成功")),$.value=!1,P()}catch({response:e}){o.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}};return e(P),(a,e)=>{const t=n,S=m,W=c,X=i,Y=b,Z=f,aa=g,ea=v,la=I,ua=U,ra=w,sa=d;return p(),l("div",x,[u("div",z,[r(t,{value:N.value,"onUpdate:value":e[0]||(e[0]=a=>N.value=a),allowClear:"",placeholder:"输入用户名搜索",onSearch:P},null,8,["value"]),r(t,{value:R.value,"onUpdate:value":e[2]||(e[2]=a=>R.value=a),allowClear:"",placeholder:"输入相册名称",onSearch:P},{addonBefore:s((()=>[r(W,{value:E.value,"onUpdate:value":e[1]||(e[1]=a=>E.value=a)},{default:s((()=>[r(S,{value:""},{default:s((()=>e[9]||(e[9]=[_("全部")]))),_:1,__:[9]}),r(S,{value:"public"},{default:s((()=>e[10]||(e[10]=[_("公开")]))),_:1,__:[10]}),r(S,{value:"private"},{default:s((()=>e[11]||(e[11]=[_("私有")]))),_:1,__:[11]})])),_:1},8,["value"])])),_:1},8,["value"]),r(X,{type:"primary",onClick:T},{default:s((()=>e[12]||(e[12]=[_("新建相册")]))),_:1,__:[12]})]),r(ea,{spinning:O.value},{default:s((()=>[r(Z,{data:q.value,"scrollbar-always-on":"",fit:""},{default:s((()=>[r(Y,{prop:"name",label:"相册名称"}),r(Y,{label:"所属用户"},{default:s((({row:a})=>[_(y(a.user.username),1)])),_:1}),r(Y,{label:"权限"},{default:s((({row:a})=>[_(y("public"===a.permission?"公开":"私有"),1)])),_:1}),r(Y,{prop:"imageCount",sortable:"",label:"图片数量"}),r(Y,{prop:"createdAt",sortable:"",label:"创建时间"},{default:s((({row:a})=>[_(y(h(j)(a.createdAt)),1)])),_:1}),r(Y,{prop:"updatedAt",sortable:"",label:"最后修改时间"},{default:s((({row:a})=>[_(y(h(j)(a.updatedAt)),1)])),_:1}),r(Y,{label:"操作",fixed:"right"},{default:s((({row:a})=>[r(X,{type:"link",onClick:e=>{return l=a,B.value="edit",J.value={...l,userId:l.user._id},void($.value=!0);var l}},{default:s((()=>e[13]||(e[13]=[_("编辑")]))),_:2,__:[13]},1032,["onClick"]),r(X,{type:"link",danger:"",onClick:e=>(async a=>{d.confirm({title:"确定要删除这个相册吗？",content:"删除相册不会删除相册内的图片的实际文件",async onOk(){var e;try{await A.delete(`/api/admin/albums/${a._id}`),o.success("删除相册成功"),P()}catch({response:l}){o.error(null==(e=null==l?void 0:l.data)?void 0:e.error)}}})})(a)},{default:s((()=>e[14]||(e[14]=[_("删除")]))),_:2,__:[14]},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r(aa,{class:"pagination",current:F.value,"onUpdate:current":e[3]||(e[3]=a=>F.value=a),pageSize:H.value,"onUpdate:pageSize":e[4]||(e[4]=a=>H.value=a),total:G.value,"show-size-changer":"",onChange:P},null,8,["current","pageSize","total"])])),_:1},8,["spinning"]),r(sa,{open:$.value,"onUpdate:open":e[8]||(e[8]=a=>$.value=a),title:"create"===B.value?"新建相册":"编辑相册",onOk:V},{default:s((()=>[r(ra,{model:J.value,rules:K,layout:"vertical",ref_key:"formRef",ref:D},{default:s((()=>["create"===B.value?(p(),k(la,{key:0,label:"用户",name:"userId"},{default:s((()=>[r(W,{value:J.value.userId,"onUpdate:value":e[5]||(e[5]=a=>J.value.userId=a),"show-search":"",placeholder:"请选择用户","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null,loading:L.value,options:M.value,onSearch:Q},null,8,["value","loading","options"])])),_:1})):C("",!0),r(la,{label:"相册名称",name:"name"},{default:s((()=>[r(ua,{value:J.value.name,"onUpdate:value":e[6]||(e[6]=a=>J.value.name=a),placeholder:"请输入相册名称"},null,8,["value"])])),_:1}),r(la,{label:"权限",name:"permission"},{default:s((()=>[r(W,{value:J.value.permission,"onUpdate:value":e[7]||(e[7]=a=>J.value.permission=a)},{default:s((()=>[r(S,{value:"public"},{default:s((()=>e[15]||(e[15]=[_("公开")]))),_:1,__:[15]}),r(S,{value:"private"},{default:s((()=>e[16]||(e[16]=[_("私有")]))),_:1,__:[16]})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"])])}}},[["__scopeId","data-v-28e059a4"]]);export{q as default};
