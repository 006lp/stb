import{d as e,a,r as l,c as t,H as u,S as r,F as n,Q as i,w as o,o as d,b as s,e as c,f as v,u as p,M as m,g,h as f,i as _,l as y,C as h,j as b,k,D as w,m as U,n as I,p as x,q,A as S,U as C,s as P,_ as A,t as K,v as M,x as D,L,y as T,z,B as O,E as H,G as $,I as R,P as E,J as B,K as F,N as j,O as G,R as Z,T as V,V as N,W as Y,X as J,Y as W,Z as X,$ as Q,a0 as ee,a1 as ae,a2 as le,a3 as te,a4 as ue,a5 as re,a6 as ne,a7 as ie,a8 as oe,a9 as de,aa as se,ab as ce,ac as ve,ad as pe,ae as me,af as ge,ag as fe,ah as _e,ai as ye,aj as he,ak as be,al as ke,am as we,an as Ue,ao as Ie,ap as xe,aq as qe,ar as Se,as as Ce,at as Pe,au as Ae,av as Ke,aw as Me,ax as De,ay as Le,az as Te,aA as ze,aB as Oe,aC as He,aD as $e,aE as Re,aF as Ee,aG as Be,aH as Fe,aI as je,aJ as Ge,aK as Ze,aL as Ve,aM as Ne,aN as Ye,aO as Je,aP as We,aQ as Xe,aR as Qe,aS as ea,aT as aa,aU as la}from"./vendor-DTqst328.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const ta=e("user",{state:()=>({ip:null,user:null,token:null,config:null,activeKey:"1"}),getters:{menuVisibility:e=>{var a,l,t,u;return{home:!0,my:!!e.token,gallery:!!(null==(l=null==(a=e.config)?void 0:a.site)?void 0:l.gallery),docs:!!(null==(u=null==(t=e.config)?void 0:t.site)?void 0:u.api)}}},persist:{key:"stb",storage:localStorage,serializer:{serialize:e=>JSON.stringify(e),deserialize:e=>JSON.parse(e)}}}),ua=e=>{const{method:a,url:l,params:t,data:u}=e;return[a,l,JSON.stringify(t),JSON.stringify(u)].join("&")},ra=new Map,na=e=>{const a=ua(e);if(ra.has(a)){ra.get(a)(a),ra.delete(a)}},ia=a.create({baseURL:"",timeout:1e4});ia.interceptors.request.use((e=>{na(e),(e=>{const l=ua(e);e.cancelToken=e.cancelToken||new a.CancelToken((e=>{ra.has(l)||ra.set(l,e)}))})(e);const{token:l}=JSON.parse(localStorage.getItem("stb"))||{};return e.headers.Authorization=l?`Bearer ${l}`:"",e}),(e=>Promise.reject(e))),ia.interceptors.response.use((e=>(na(e.config),e)),(e=>{var a,l;const t=JSON.parse(localStorage.getItem("stb"))||{};return(null==(a=null==t?void 0:t.site)?void 0:a.anonymousUpload)||401!==(null==(l=e.response)?void 0:l.status)||(localStorage.removeItem("stb"),location.href="/login"),na(e.config||{}),Promise.reject(e)}));const oa=(e,a)=>{const l=e.__vccOpts||e;for(const[t,u]of a)l[t]=u;return l},da={class:"app"},sa={class:"app-header"},ca={class:"app-header-left"},va={class:"app-header-right"},pa={class:"logo"},ma={class:"footer"},ga=oa({__name:"App",setup(e){const a=U(),F=k(),j=ta(),G=l(["home"]),Z=l(!1),V=l({ipv4:"",ipv6:""}),N=[{name:"home",title:"图床首页",url:"/",icon:u},{name:"my",title:"我的图片",url:"/my",icon:r},{name:"gallery",title:"图片广场",url:"/gallery",icon:n},{name:"docs",title:"接口文档",url:"/docs",icon:i}],Y=t((()=>N.map((e=>({...e,show:j.menuVisibility[e.name]}))))),J=[{name:"dashboard",title:"仪表盘"},{name:"logs",title:"日志管理"},{name:"users",title:"用户管理"},{name:"images",title:"图片管理"},{name:"albums",title:"相册管理"},{name:"invitecodes",title:"邀请码管理"},{name:"config",title:"系统配置"}],W=()=>{j.user=null,j.token=null,F.push("/login"),b.warning("账号已退出")},X=e=>{const a=e.split("/").filter(Boolean);if(["register","reset-password"].includes(a[0]))return G.value=["login"];G.value=a.length>1?[a[1]]:[a[0]||"home"]};return o((()=>a.path),(async e=>{await(e=>{const a=new RTCPeerConnection({iceServers:[{urls:"stun:stun.qq.com"},{urls:"stun:stun.cloudflare.com:3478"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]});a.createDataChannel(""),a.createOffer().then((e=>a.setLocalDescription(e))),a.onicecandidate=a=>{a.candidate&&e(a.candidate.candidate.split(" ")[4])}})((e=>{try{/\b(?:\d{1,3}\.){3}\d{1,3}\b/.test(e)?V.value.ipv4=e:/^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(e)&&(V.value.ipv6=e),j.ip=V.value}catch(a){console.error(a)}})),X(e)})),d((async()=>{if((async()=>{try{const{data:e}=await ia.post("/api/auth/config");j.config=e}catch(e){b.error(e)}})(),X(location.pathname),(()=>{const e=new URLSearchParams(location.search),a=e.get("token"),l=e.get("isBind");a&&(j.token=a,history.replaceState({},document.title,location.pathname),"true"===l?F.push("/settings"):F.push("/"))})(),j.token)try{await(async()=>{var e,a;try{const{data:e}=await ia.post("/api/auth/info");j.user=e}catch(l){b.error((null==(a=null==(e=null==l?void 0:l.response)?void 0:e.data)?void 0:a.error)||"获取用户信息失败")}})()}catch(e){W()}})),(e,a)=>{const l=S,t=A,u=D,r=P,n=w,i=I("router-link"),o=R,d=I("router-view"),b=B,k=h;return x(),s("div",da,[c("div",sa,[c("div",ca,[c("div",{class:"hamburger",onClick:a[0]||(a[0]=e=>Z.value=!Z.value)},[v(p(m))])]),c("div",va,[p(j).token?(x(),g(n,{key:0,arrow:{pointAtCenter:!0}},{overlay:_((()=>[v(r,null,{default:_((()=>[v(t,{key:"user",onClick:a[2]||(a[2]=e=>p(F).push(`/user/${p(j).user._id}`))},{default:_((()=>[v(p(C)),a[6]||(a[6]=K(" 个人主页 "))])),_:1,__:[6]}),v(t,{key:"settings",onClick:a[3]||(a[3]=e=>p(F).push("/settings"))},{default:_((()=>[v(p(M)),a[7]||(a[7]=K(" 个人设置 "))])),_:1,__:[7]}),v(u),v(t,{key:"logout",onClick:W},{default:_((()=>[v(p(L)),a[8]||(a[8]=K(" 退出登录 "))])),_:1,__:[8]})])),_:1})])),default:_((()=>{var e;return[c("a",{class:"user-dropdown",onClick:a[1]||(a[1]=q((()=>{}),["prevent"]))},[v(l,{size:32,src:p(j).config.site.url+(null==(e=p(j).user)?void 0:e.avatar)},{icon:_((()=>[v(p(C))])),_:1},8,["src"])])]})),_:1})):f("",!0)])]),v(k,{locale:p(y)},{default:_((()=>[c("div",{class:T(["mask",{"mask-active":Z.value}]),onClick:a[4]||(a[4]=e=>Z.value=!1)},null,2),c("div",{class:T(["menu",{"menu-active":Z.value}])},[c("div",pa,[v(i,{to:"/"},{default:_((()=>{var e,a;return[K(z(null==(a=null==(e=p(j).config)?void 0:e.site)?void 0:a.title),1)]})),_:1})]),v(r,{selectedKeys:G.value,"onUpdate:selectedKeys":a[5]||(a[5]=e=>G.value=e),"open-keys":["admin"],theme:"dark",mode:"inline"},{default:_((()=>{var e;return[(x(!0),s(O,null,H(Y.value,(e=>(x(),s(O,null,[e.show?(x(),g(t,{key:e.name},{default:_((()=>[v(i,{to:e.url},{default:_((()=>[(x(),g($(e.icon))),K(" "+z(e.title),1)])),_:2},1032,["to"])])),_:2},1024)):f("",!0)],64)))),256)),(null==(e=p(j).user)?void 0:e.founder)?(x(),g(o,{key:"admin"},{title:_((()=>[c("span",null,[v(p(M)),a[9]||(a[9]=K(" 后台管理 "))])])),default:_((()=>[(x(),s(O,null,H(J,(e=>v(t,{key:e.name},{default:_((()=>[v(i,{to:`/admin/${e.name}`},{default:_((()=>[K(z(e.title),1)])),_:2},1032,["to"])])),_:2},1024))),64))])),_:1})):f("",!0),p(j).token?f("",!0):(x(),g(t,{key:"login"},{default:_((()=>[v(i,{to:"/login"},{default:_((()=>[v(p(C)),a[10]||(a[10]=K(" 注册 / 登录 "))])),_:1,__:[10]})])),_:1})),p(j).token?(x(),g(t,{key:"logout",style:{float:"right"},onClick:W},{default:_((()=>[v(p(E)),a[11]||(a[11]=K(" 退出登录 "))])),_:1,__:[11]})):f("",!0)]})),_:1},8,["selectedKeys"])],2),c("div",{class:T(["content",G.value])},[v(d)],2),c("div",ma,[a[13]||(a[13]=K(" All rights reserved © 2025 ")),v(b,{class:"goLink",type:"link",href:"https://github.com/setube/stb",target:"_blank"},{default:_((()=>a[12]||(a[12]=[K("Stb")]))),_:1,__:[12]})])])),_:1},8,["locale"])])}}},[["__scopeId","data-v-bb872cbd"]]),fa={class:"drag-verify"},_a={key:0,class:"text"},ya={key:1,class:"text"},ha=oa(Object.assign({name:"Captcha"},{__name:"Captcha",props:{value:{type:Boolean,default:!1},successText:{type:String,default:"验证成功"},startText:{type:String,default:"请按住滑块，拖动到最右边"}},emits:["update:value","verify-success","update:captchaId"],setup(e,{emit:a}){const t=a,u=l(!1),r=l(null),n="ontouchstart"in document.documentElement,i=n?"touchmove":"mousemove",o=n?"touchend":"mouseup",d=async()=>{var e;r.value||await(async()=>{var e;try{const{data:e}=await ia.post("/api/auth/captcha/generate");r.value=e.captchaId,t("update:captchaId",e.captchaId)}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}})();try{const{data:e}=await ia.post("/api/auth/captcha/verify",{captchaId:r.value,verifyResult:!0});e.isValid?(u.value=!0,t("update:value",!0),t("verify-success")):(b.error("验证失败"),m())}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error),m()}},m=()=>{u.value=!1,t("update:value",!1),r.value=null,t("update:captchaId",null)},f=e=>{let a=0;const l=document.querySelector(".drag-verify .block"),t=e.clientX||e.touches[0].pageX,r=l.offsetWidth-40;if(u.value)return!1;const n=e=>{const u=e.clientX||e.touches[0].pageX;a=u-t,a<=0&&(a=0),a>=r-40&&(a=r),l.style.transition=".1s all",l.style.transform=`translate3d(${a}px, 0, 0)`},s=()=>{a!==r?(l.style.transition=".5s all",l.style.transform="translate3d(0, 0, 0)"):d(),document.removeEventListener(i,n),document.removeEventListener(o,s)};document.addEventListener(i,n),document.addEventListener(o,s)};return(a,l)=>(x(),s("div",fa,[c("div",{class:T(["range",u.value?"success":""])},[c("div",{class:"block",onMousedown:f,onTouchstartPassive:f},[c("span",null,[u.value?(x(),g(p(F),{key:0})):(x(),g(p(j),{key:1}))])],32),u.value?(x(),s("span",_a,[v(p(G)),K(" "+z(e.successText),1)])):(x(),s("span",ya,[v(p(Z)),K(" "+z(e.startText),1)]))],2)]))}}),[["__scopeId","data-v-e090de80"]]),ba={class:"login-container"},ka={class:"anticon"},wa=["src"],Ua=oa({__name:"Login",setup(e){const a=k(),l=ta(),u=t((()=>{var e,a;return null==(a=null==(e=null==l?void 0:l.config)?void 0:e.site)?void 0:a.captcha})),r=V({username:"",password:"",captcha:!1,captchaId:""}),n=t((()=>{let e=!r.username||!r.password;return u.value&&(e=e||!r.captcha||!r.captchaId),e})),i=async()=>{var e;try{const{data:e}=await ia.post("/api/auth/login",{username:r.username,password:r.password,captchaId:r.captchaId});l.token=e.token,l.user=e.user,a.push("/"),b.success("登录成功")}catch({response:t}){b.error((null==(e=null==t?void 0:t.data)?void 0:e.error)||"登录失败")}},o=e=>{var a;const{oauth:t,site:u}=null==l?void 0:l.config;t.enabled?(null==(a=t[e])?void 0:a.enabled)?location.href=`${u.url}/oauth/${e}?redirectUrl=${encodeURIComponent(location.href)}`:b.error(`${e}登录功能未启用`):b.error("社会化登录功能未启用")};return(e,t)=>{const d=W,m=J,y=X,h=B,b=Q,k=Y,w=N;return x(),s("div",ba,[v(w,{title:"登录",class:"login-box"},{default:_((()=>[v(k,{model:r,onFinish:i,layout:"vertical"},{default:_((()=>{var e,i,k,w,U,I,q,S,P,A,M,D,L,T,z,H,$,R,E,B,F,j,G,V,N,Y,J;return[v(m,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"}]},{default:_((()=>[v(d,{value:r.username,"onUpdate:value":t[0]||(t[0]=e=>r.username=e),placeholder:"请输入用户名"},{prefix:_((()=>[v(p(C))])),_:1},8,["value"])])),_:1}),v(m,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}]},{default:_((()=>[v(y,{value:r.password,"onUpdate:value":t[1]||(t[1]=e=>r.password=e),placeholder:"请输入密码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1}),u.value?(x(),g(m,{key:0,label:"验证码",required:"",name:"captcha"},{default:_((()=>[v(ha,{value:r.captcha,"onUpdate:value":t[2]||(t[2]=e=>r.captcha=e),captchaId:r.captchaId,"onUpdate:captchaId":t[3]||(t[3]=e=>r.captchaId=e)},null,8,["value","captchaId"])])),_:1})):f("",!0),v(m,{class:"sin"},{default:_((()=>{var e,u,r,i;return[v(h,{type:"primary","html-type":"submit",block:!(null==(u=null==(e=p(l).config)?void 0:e.site)?void 0:u.register),disabled:n.value},{default:_((()=>t[9]||(t[9]=[K(" 登录账号 ")]))),_:1,__:[9]},8,["block","disabled"]),(null==(i=null==(r=p(l).config)?void 0:r.site)?void 0:i.register)?(x(),g(h,{key:0,onClick:t[4]||(t[4]=e=>p(a).push("/register"))},{default:_((()=>t[10]||(t[10]=[K("注册账号")]))),_:1,__:[10]})):f("",!0),v(h,{onClick:t[5]||(t[5]=e=>p(a).push("/reset-password"))},{default:_((()=>t[11]||(t[11]=[K("找回密码")]))),_:1,__:[11]})]})),_:1}),(null==(k=null==(i=null==(e=p(l))?void 0:e.config)?void 0:i.oauth)?void 0:k.enabled)?(x(),s(O,{key:1},[(null==(q=null==(I=null==(U=null==(w=p(l))?void 0:w.config)?void 0:U.oauth)?void 0:I.github)?void 0:q.enabled)||(null==(M=null==(A=null==(P=null==(S=p(l))?void 0:S.config)?void 0:P.oauth)?void 0:A.google)?void 0:M.enabled)||(null==(z=null==(T=null==(L=null==(D=p(l))?void 0:D.config)?void 0:L.oauth)?void 0:T.linuxdo)?void 0:z.enabled)?(x(),g(b,{key:0},{default:_((()=>t[12]||(t[12]=[K(" 或 ")]))),_:1,__:[12]})):f("",!0),(null==(E=null==(R=null==($=null==(H=p(l))?void 0:H.config)?void 0:$.oauth)?void 0:R.github)?void 0:E.enabled)?(x(),g(h,{key:1,onClick:t[6]||(t[6]=e=>o("github"))},{default:_((()=>[v(p(ee)),t[13]||(t[13]=K(" GitHub "))])),_:1,__:[13]})):f("",!0),(null==(G=null==(j=null==(F=null==(B=p(l))?void 0:B.config)?void 0:F.oauth)?void 0:j.google)?void 0:G.enabled)?(x(),g(h,{key:2,onClick:t[7]||(t[7]=e=>o("google"))},{default:_((()=>[v(p(ae)),t[14]||(t[14]=K(" Google "))])),_:1,__:[14]})):f("",!0),(null==(J=null==(Y=null==(N=null==(V=p(l))?void 0:V.config)?void 0:N.oauth)?void 0:Y.linuxdo)?void 0:J.enabled)?(x(),g(h,{key:3,onClick:t[8]||(t[8]=e=>o("linuxdo"))},{default:_((()=>[c("span",ka,[c("img",{class:"linuxdo",src:p("/assets/svg/linuxdo-CAlHVQQP.svg")},null,8,wa)]),t[15]||(t[15]=K(" Linux Do "))])),_:1,__:[15]})):f("",!0)],64)):f("",!0)]})),_:1},8,["model"])])),_:1})])}}},[["__scopeId","data-v-f800b6a0"]]),Ia={class:"register"},xa=oa({__name:"Register",setup(e){const a=k(),u=ta(),r=l(!1),n=l(0),i=t((()=>{var e,a;return null==(a=null==(e=null==u?void 0:u.config)?void 0:e.site)?void 0:a.captcha})),o=V({username:"",email:"",code:"",password:"",confirmPassword:"",inviteCode:"",captcha:!1,captchaId:""}),c=t((()=>{var e,a,l,t;let r=!(o.username&&o.email&&o.password&&o.confirmPassword);return(null==(a=null==(e=null==u?void 0:u.config)?void 0:e.smtp)?void 0:a.enabled)&&(r=r||!o.code),(null==(t=null==(l=null==u?void 0:u.config)?void 0:l.site)?void 0:t.inviteCodeRequired)&&(r=r||!o.inviteCode),i.value&&(r=r||!o.captcha||!o.captchaId),r})),m={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应在3-20个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:async(e,a)=>{if(a!==o.password)throw new Error("两次输入的密码不一致")},trigger:"blur"}],inviteCode:[{required:!0,message:"请输入邀请码",trigger:"blur"}]},y=async()=>{if(o.email)try{await ia.post("/api/auth/register/send-code",re.stringify({email:o.email,username:o.username})),b.success("验证码已发送到您的邮箱"),n.value=60;const e=setInterval((()=>{n.value--,n.value<=0&&clearInterval(e)}),1e3)}catch({response:e}){b.error(e.data.error||"发送验证码失败")}else b.error("请先输入邮箱")},h=async()=>{var e;try{r.value=!0;const{data:e}=await ia.post("/api/auth/register",{username:o.username,password:o.password,email:o.email,code:o.code,ip:u.ip,inviteCode:o.inviteCode,captchaId:o.captchaId});u.token=e.token,u.user=e.user,b.success("注册成功"),a.push("/")}catch({response:l}){b.error((null==(e=null==l?void 0:l.data)?void 0:e.error)||"注册失败")}finally{r.value=!1}};return d((()=>{new URLSearchParams(location.search).get("oauth")&&(history.replaceState({},document.title,location.pathname),b.error("请注册后再使用本功能"))})),(e,a)=>{const l=W,t=J,d=B,b=te,k=X,w=I("router-link"),U=Y,q=N;return x(),s("div",Ia,[v(q,{class:"register-card",title:"注册"},{default:_((()=>[v(U,{model:o,onFinish:h},{default:_((()=>{var e,s,h,U,I,q;return[v(t,{name:"username",rules:m.username},{default:_((()=>[v(l,{value:o.username,"onUpdate:value":a[0]||(a[0]=e=>o.username=e),placeholder:"请输入用户名"},{prefix:_((()=>[v(p(C))])),_:1},8,["value"])])),_:1},8,["rules"]),v(t,{name:"email",rules:m.email},{default:_((()=>[v(l,{value:o.email,"onUpdate:value":a[1]||(a[1]=e=>o.email=e),placeholder:"请输入邮箱"},{prefix:_((()=>[v(p(le))])),_:1},8,["value"])])),_:1},8,["rules"]),(null==(h=null==(s=null==(e=p(u))?void 0:e.config)?void 0:s.smtp)?void 0:h.enabled)?(x(),g(t,{key:0,name:"code",rules:m.code},{default:_((()=>[v(b,{compact:""},{default:_((()=>[v(l,{value:o.code,"onUpdate:value":a[2]||(a[2]=e=>o.code=e),placeholder:"请输入验证码",style:{width:"calc(100% - 120px)"}},{prefix:_((()=>[v(p(ue))])),_:1},8,["value"]),v(d,{disabled:!o.email||!!n.value,style:{width:"120px"},onClick:y},{default:_((()=>[K(z(n.value?`${n.value}s后重试`:"获取验证码"),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["rules"])):f("",!0),v(t,{name:"password",rules:m.password},{default:_((()=>[v(k,{value:o.password,"onUpdate:value":a[3]||(a[3]=e=>o.password=e),placeholder:"请输入密码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1},8,["rules"]),v(t,{name:"confirmPassword",rules:m.confirmPassword},{default:_((()=>[v(k,{value:o.confirmPassword,"onUpdate:value":a[4]||(a[4]=e=>o.confirmPassword=e),placeholder:"请确认密码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1},8,["rules"]),(null==(q=null==(I=null==(U=p(u))?void 0:U.config)?void 0:I.site)?void 0:q.inviteCodeRequired)?(x(),g(t,{key:1,name:"inviteCode",rules:m.inviteCode},{default:_((()=>[v(l,{value:o.inviteCode,"onUpdate:value":a[5]||(a[5]=e=>o.inviteCode=e),placeholder:"请输入邀请码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1},8,["rules"])):f("",!0),i.value?(x(),g(t,{key:2,required:"",name:"captcha"},{default:_((()=>[v(ha,{value:o.captcha,"onUpdate:value":a[6]||(a[6]=e=>o.captcha=e),captchaId:o.captchaId,"onUpdate:captchaId":a[7]||(a[7]=e=>o.captchaId=e)},null,8,["value","captchaId"])])),_:1})):f("",!0),v(t,null,{default:_((()=>[v(d,{type:"primary","html-type":"submit",loading:r.value,disabled:c.value,block:""},{default:_((()=>a[8]||(a[8]=[K(" 注册 ")]))),_:1,__:[8]},8,["loading","disabled"])])),_:1}),v(t,null,{default:_((()=>[v(w,{to:"/login"},{default:_((()=>a[9]||(a[9]=[K("已有账号？去登录")]))),_:1,__:[9]}),a[11]||(a[11]=K(" 或者 ")),v(w,{to:"/reset-password"},{default:_((()=>a[10]||(a[10]=[K("找回密码")]))),_:1,__:[10]})])),_:1,__:[11]})]})),_:1},8,["model"])])),_:1})])}}},[["__scopeId","data-v-5e88b9b8"]]),qa=e=>{const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`},Sa=e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]},Ca=(e,a,l)=>{const t=new ne(e.target,{text:()=>"local"==a.type?l.config.site.url+a.url:a.url});t.on("success",(e=>{e.clearSelection(),b.success("链接已复制到剪贴板"),t.destroy()})),t.on("error",(e=>{b.error("复制失败, 请检查当前浏览器是否支持Clipboard.js"),t.destroy()}))},Pa={local:"本地存储",oss:"阿里云OSS",cos:"腾讯云COS",s3:"AWS S3",r2:"Cloudflare R2",qiniu:"七牛云 Kodo",upyun:"又拍云 USS",sftp:"SFTP",ftp:"FTP",webdav:"WebDAV",telegram:"Telegram",github:"GitHub",get:e=>Pa[e]??"本地存储"},Aa={Block:{color:"red",text:"建议屏蔽"},Review:{color:"orange",text:"建议人工审核"},Pass:{color:"green",text:"建议通过"},high:{color:"red",text:"高风险"},medium:{color:"orange",text:"中风险"},low:{color:"green",text:"低风险"},none:{color:"gray",text:"无风险"}},Ka={Porn:{color:"red",text:"色情"},Ad:{color:"red",text:"广告"},Abuse:{color:"red",text:"暴力"},Normal:{color:"green",text:"正常"},unsafe:{color:"red",text:"不安全"},safe:{color:"green",text:"安全"}},Ma={class:"ant-upload-hint"},Da={class:"ant-upload-drag-icon"},La={class:"ant-upload-hint"},Ta={key:0,class:"file-list"},za={class:"file-list-header"},Oa={class:"file-list-actions"},Ha={class:"file-items"},$a={class:"file-preview"},Ra=["src","alt"],Ea={class:"file-info"},Ba={class:"file-name"},Fa={class:"file-size"},ja={class:"file-status"},Ga={key:1,class:"success-text"},Za={key:2,class:"error-text"},Va={class:"file-actions"},Na={key:1,class:"result-panel"},Ya=["onClick"],Ja=oa({__name:"Home",setup(e){const a=ta(),u=l([]),r=l([]),n=l({url:[],html:[],bbcode:[],markdown:[]}),i=l(0),o=l("url"),d=[{key:"url",tab:"URL"},{key:"html",tab:"HTML"},{key:"bbcode",tab:"BBCode"},{key:"markdown",tab:"Markdown"}],m=l(!1),y=()=>{const e=new ne(".copyAll",{text:()=>n.value[o.value].join("\n")});e.on("success",(a=>{r.value=[],u.value=[],n.value={url:[],html:[],bbcode:[],markdown:[]},i.value=0,a.clearSelection(),b.success("链接已复制到剪贴板"),e.destroy()})),e.on("error",(a=>{b.error("复制失败, 请手动复制"),e.destroy()}))},h=t((()=>{var e,l;const t=null==(l=null==(e=a.config)?void 0:e.upload)?void 0:l.allowedFormats;return(null==t?void 0:t.length)?t.map((e=>`image/${e}`)).join(","):"image/*"})),k=t((()=>{var e,l;const t=null==(l=null==(e=a.config)?void 0:e.upload)?void 0:l.allowedFormats;return(null==t?void 0:t.length)?t.join(", ").toUpperCase():"all"})),w=e=>e.type.startsWith("image/")?(u.value.push({uid:Date.now()+Math.random().toString(36).slice(2),name:e.name,size:e.size,file:e,preview:URL.createObjectURL(e),status:"waiting",percent:0,error:""}),!1):(b.error("只能上传图片文件！"),!1),U=async(e,l)=>{var t,u,d,s;try{const{ip:d,config:s,token:c}=a,v=new FormData;v.append("image",e),v.append("ip",(null==d?void 0:d.ipv4)?null==d?void 0:d.ipv4:null==d?void 0:d.ipv6);const p=(null==(t=null==s?void 0:s.site)?void 0:t.anonymousUpload)&&!c?"/api/tourist/upload":"/api/upload",{data:m}=await ia.post(p,v,{onUploadProgress:e=>{l&&l({percent:Math.round(e.loaded/e.total*100)})}}),{url:g,type:f,filename:_}=m;return r.value.unshift(m),((e,a)=>{const{url:l,html:t,bbcode:u,markdown:r}=n.value;l.push(a),t.push(`<img src="${a}" alt="${e}" />`),u.push(`[img]${a}[/img]`),r.push(`![${e}](${a})`),i.value=n.value[o.value].length-1})(_,"local"==f?(null==(u=null==s?void 0:s.site)?void 0:u.url)+g:g),m}catch(c){throw new Error((null==(s=null==(d=null==c?void 0:c.response)?void 0:d.data)?void 0:s.error)||c)}},I=async e=>{const a=(e.clipboardData||window.Clipboard).items,l=[];for(let t=0;t<a.length;t++){const e=a[t];if("file"===e.kind&&e.type.startsWith("image/")){const a=e.getAsFile(),u=URL.createObjectURL(a);l.push({uid:Date.now()+t,name:a.name,size:a.size,file:a,preview:u})}}l.length>0&&u.value.push(...l)},q=async()=>{const e=u.value.filter((e=>"waiting"===e.status));if(0!==e.length){m.value=!0;for(const a of e)await P(a);m.value=!1}},S=()=>{u.value=u.value.filter((e=>"success"===e.status||"error"===e.status))},C=(e,a)=>{const l=new ne(e,{text:()=>a});l.on("success",(e=>{e.clearSelection(),b.success("链接已复制到剪贴板"),l.destroy()})),l.on("error",(e=>{b.error("复制失败, 请手动复制"),l.destroy()}))},P=async e=>{var l,t,r,n;const i=u.value.findIndex((a=>a.uid===e.uid));if(-1!==i){u.value[i].status="uploading",u.value[i].percent=0;try{const o=await U(e.file,(a=>{const l=u.value.findIndex((a=>a.uid===e.uid));l>-1&&(u.value[l].percent=a.percent)}));u.value[i].status="success",u.value[i].url="local"==o.type?(null==(t=null==(l=a.config)?void 0:l.site)?void 0:t.url)+o.url:o.url,u.value[i].thumb=(null==(n=null==(r=a.config)?void 0:r.site)?void 0:n.url)+o.thumb}catch(o){u.value[i].status="error",u.value[i].error=o.message||"上传失败"}}};return(e,l)=>{const t=ie,r=B,i=de,b=se,U=me,A=pe,M=N;return x(),s("div",{class:"home-container",onPaste:I},[v(M,{class:"upload-card"},{default:_((()=>{var e,I,M,D,L,T;return[c("p",Ma," 您单次最多可以上传"+z(null==(I=null==(e=p(a).config)?void 0:e.upload)?void 0:I.concurrentUploads)+"张图片, 最大文件大小："+z(null==(D=null==(M=p(a).config)?void 0:M.upload)?void 0:D.maxSize)+"MB ",1),v(t,{beforeUpload:w,accept:h.value,multiple:"",maxCount:null==(T=null==(L=p(a).config)?void 0:L.upload)?void 0:T.concurrentUploads,showUploadList:!1},{default:_((()=>[c("p",Da,[v(p(oe))]),l[1]||(l[1]=c("p",{class:"ant-upload-text"},"点击、拖拽或粘贴图片上传",-1)),c("p",La,"支持格式："+z(k.value),1)])),_:1,__:[1]},8,["accept","maxCount"]),u.value.length>0?(x(),s("div",Ta,[c("div",za,[c("span",null,"文件列表 ("+z(u.value.length)+")",1),c("div",Oa,[v(r,{type:"primary",onClick:q,loading:m.value,disabled:!u.value.some((e=>"waiting"===e.status))},{default:_((()=>l[2]||(l[2]=[K(" 批量上传 ")]))),_:1,__:[2]},8,["loading","disabled"]),v(r,{onClick:S,disabled:!u.value.some((e=>"waiting"===e.status||"uploading"===e.status))},{default:_((()=>l[3]||(l[3]=[K(" 清空列表 ")]))),_:1,__:[3]},8,["disabled"])])]),c("div",Ha,[(x(!0),s(O,null,H(u.value,(e=>(x(),s("div",{key:e.uid,class:"file-item"},[c("div",$a,[c("img",{src:e.preview,alt:e.name},null,8,Ra)]),c("div",Ea,[c("div",Ba,z(e.name),1),c("div",Fa,z(p(Sa)(e.size)),1),c("div",ja,["uploading"===e.status?(x(),g(i,{key:0,percent:e.percent,size:"small"},null,8,["percent"])):"success"===e.status?(x(),s("span",Ga,"上传成功")):"error"===e.status?(x(),s("span",Za,z(e.error),1)):f("",!0)])]),c("div",Va,["waiting"===e.status?(x(),g(b,{key:0,title:"上传"},{default:_((()=>[v(r,{type:"text",onClick:a=>P(e)},{default:_((()=>[v(p(ce))])),_:2},1032,["onClick"])])),_:2},1024)):f("",!0),v(b,{title:"删除"},{default:_((()=>[v(r,{type:"text",danger:"",onClick:a=>(e=>{const a=u.value.findIndex((a=>a.uid===e.uid));a>-1&&u.value.splice(a,1)})(e),disabled:"uploading"===e.status},{default:_((()=>[v(p(ve))])),_:2},1032,["onClick","disabled"])])),_:2},1024)])])))),128))])])):f("",!0),n.value[o.value].length>0?(x(),s("div",Na,[v(r,{class:"copyAll",type:"primary",onClick:y},{default:_((()=>l[4]||(l[4]=[K("一键复制")]))),_:1,__:[4]}),v(A,{activeKey:o.value,"onUpdate:activeKey":l[0]||(l[0]=e=>o.value=e)},{default:_((()=>[(x(),s(O,null,H(d,(e=>v(U,{key:e.key,tab:e.tab,class:"link-items"},{default:_((()=>[(x(!0),s(O,null,H(n.value[o.value],((e,a)=>(x(),s("div",{key:a,class:"link-item"},[c("div",{class:"link-content",onClick:a=>C(".link-content",e)},z(e),9,Ya),v(b,{title:"复制"},{default:_((()=>[v(r,{type:"link",class:"link",onClick:a=>C(".link",e)},{icon:_((()=>[v(p(ge))])),_:2},1032,["onClick"])])),_:2},1024)])))),128))])),_:2},1032,["tab"]))),64))])),_:1},8,["activeKey"])])):f("",!0)]})),_:1})],32)}}},[["__scopeId","data-v-5f80b7e9"]]),Wa="data:image/svg+xml,%3csvg%20id='图层_1'%20data-name='图层%201'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20144%20144'%3e%3cdefs%3e%3cstyle%3e.cls-1{fill:%23666;}.cls-2{fill:%23999;}.cls-3{fill:%23ccc;}%3c/style%3e%3c/defs%3e%3cpath%20class='cls-1'%20d='M118,32a14,14,0,0,1,0-28,14.38,14.38,0,0,1,2.57.24,2,2,0,0,1,.08,3.92,6,6,0,1,0,7.19,7.19,2,2,0,0,1,3.91.08A13.55,13.55,0,0,1,132,18,14,14,0,0,1,118,32ZM113.2,9.23A10,10,0,1,0,126.77,22.8,10,10,0,0,1,113.2,9.23Z'/%3e%3cpath%20class='cls-1'%20d='M80,136H24a2,2,0,0,1-1.7-.95,2,2,0,0,1-.09-1.94l28-56a2,2,0,0,1,3.58,0l28,56a2,2,0,0,1-.09,1.94A2,2,0,0,1,80,136Zm-52.76-4H76.76L52,82.47Z'/%3e%3cpath%20class='cls-1'%20d='M134,136H80a2,2,0,0,1-1.79-1.11l-28-56A2,2,0,0,1,50.3,77,2,2,0,0,1,52,76h55a2,2,0,0,1,1.8,1.13l27,56A2,2,0,0,1,134,136Zm-52.76-4h49.58L105.74,80H55.24Z'/%3e%3cpath%20class='cls-1'%20d='M116,118a2,2,0,0,1-1.79-1.11L99.46,87.39A2,2,0,0,1,103,85.61l14.75,29.5A2,2,0,0,1,116,118Z'/%3e%3cpath%20class='cls-1'%20d='M120.08,126.16a2,2,0,0,1-1.79-1.11l-1.08-2.16a2,2,0,0,1,3.58-1.78l1.08,2.15a2,2,0,0,1-1.79,2.9Z'/%3e%3cpath%20class='cls-1'%20d='M52,136a2,2,0,0,1-2-2V78a2,2,0,0,1,4,0v56A2,2,0,0,1,52,136Z'/%3e%3cpath%20class='cls-1'%20d='M80,136a2,2,0,0,1-2-2v-8a2,2,0,0,1,4,0v8A2,2,0,0,1,80,136Z'/%3e%3cpath%20class='cls-1'%20d='M134,136a2,2,0,0,1-2-2v-8a2,2,0,0,1,4,0v8A2,2,0,0,1,134,136Z'/%3e%3cpath%20class='cls-1'%20d='M24,136a2,2,0,0,1-2-2v-8a2,2,0,0,1,4,0v8A2,2,0,0,1,24,136Z'/%3e%3cpath%20class='cls-2'%20d='M33.13,95.39a2,2,0,0,1-1.68-.9L29,90.73a2,2,0,0,1,1.68-3.09H35a2,2,0,0,1,0,4h-.63l.43.65a2,2,0,0,1-1.67,3.1Z'/%3e%3cpath%20class='cls-2'%20d='M24,120a2,2,0,0,1-2-2v-6H4a2,2,0,0,1-1.67-3.1l11.3-17.26H7.33a2,2,0,0,1-1.67-3.1l8-12.18h-3A2,2,0,0,1,9,73.27L22.33,52.9a2,2,0,0,1,3.34,0L39,73.27a2,2,0,0,1-1.68,3.09h-3l4.76,7.27a2,2,0,0,1-3.35,2.2L29,75.46a2,2,0,0,1,1.68-3.1h3L24,57.65,14.37,72.36h3A2,2,0,0,1,19,75.46L11,87.64h6.3A2,2,0,0,1,19,90.73L7.7,108H24a2,2,0,0,1,2,2v8A2,2,0,0,1,24,120Z'/%3e%3cpath%20class='cls-2'%20d='M83.34,70a2,2,0,0,1-1.67-.89L67,47.11A2,2,0,0,1,68.67,44H75.6L58,17.61,40.4,44h6.93a2,2,0,0,1,1.77,1.06,2,2,0,0,1-.1,2L40.61,59.69a2,2,0,1,1-3.32-2.22L43.6,48H36.67A2,2,0,0,1,35,44.89l21.34-32a2,2,0,0,1,3.32,0L81,44.89A2,2,0,0,1,79.33,48H72.4L85,66.89a2,2,0,0,1-.56,2.77A2,2,0,0,1,83.34,70Z'/%3e%3cpath%20class='cls-3'%20d='M122,54H86a2,2,0,0,1,0-4h36a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M138,54h-8a2,2,0,0,1,0-4h8a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M42,20H14a2,2,0,0,1,0-4H42a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M8,20H6a2,2,0,0,1,0-4H8a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M18,28H2a2,2,0,0,1,0-4H18a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M142,46H118a2,2,0,0,1,0-4h24a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M110,46h-4a2,2,0,0,1,0-4h4a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M142.59,2.67H142a.67.67,0,0,1-.67-.67V1.41A1.39,1.39,0,0,0,140.23,0a1.34,1.34,0,0,0-1.56,1.31V2a.67.67,0,0,1-.67.67h-.59A1.39,1.39,0,0,0,136,3.77a1.34,1.34,0,0,0,1.31,1.56H138a.67.67,0,0,1,.67.67v.59A1.39,1.39,0,0,0,139.77,8a1.34,1.34,0,0,0,1.56-1.31V6a.67.67,0,0,1,.67-.67h.67A1.34,1.34,0,0,0,144,3.77,1.39,1.39,0,0,0,142.59,2.67Z'/%3e%3cpath%20class='cls-3'%20d='M14.59,46.67H14a.67.67,0,0,1-.67-.67v-.59A1.39,1.39,0,0,0,12.23,44a1.34,1.34,0,0,0-1.56,1.31V46a.67.67,0,0,1-.67.67H9.41A1.39,1.39,0,0,0,8,47.77a1.34,1.34,0,0,0,1.31,1.56H10a.67.67,0,0,1,.67.67v.59A1.39,1.39,0,0,0,11.77,52a1.34,1.34,0,0,0,1.56-1.31V50a.67.67,0,0,1,.67-.67h.67A1.34,1.34,0,0,0,16,47.77,1.39,1.39,0,0,0,14.59,46.67Z'/%3e%3cpath%20class='cls-3'%20d='M6,136H2a2,2,0,0,1,0-4H6a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M142,136H14a2,2,0,0,1,0-4H142a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M102,144H22a2,2,0,0,1,0-4h80a2,2,0,0,1,0,4Z'/%3e%3cpath%20class='cls-3'%20d='M122,144H110a2,2,0,0,1,0-4h12a2,2,0,0,1,0,4Z'/%3e%3c/svg%3e",Xa={class:"modal-image-container"},Qa={class:"anticon anticon-left"},el={class:"anticon anticon-right"},al={__name:"ImageInfoModal",props:{modelValue:{type:Boolean,required:!0},imageInfo:{type:Object,required:!0},imageKey:{type:Number,default:0},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:imageInfo","update:imageKey"],setup(e,{emit:a}){const l=k(),t=e,u=a,r=ta(),n=e=>{u("update:modelValue",e)},i=()=>{u("update:modelValue",!1)},o=()=>{t.imageKey>0&&(u("update:imageInfo",t.images[t.imageKey-1]),u("update:imageKey",t.imageKey-1))},d=()=>{t.imageKey<t.images.length-1&&(u("update:imageInfo",t.images[t.imageKey+1]),u("update:imageKey",t.imageKey+1))},m=(e,a)=>{("user"!==a||e.user)&&("album"!==a||e.album)&&l.push("user"===a?`/user/${e.user._id}`:`/user/${e.user._id}/album/${e.album._id}`)};return(a,l)=>{const t=fe,u=ye,y=_e,h=B,b=ke;return x(),g(b,{open:e.modelValue,"onUpdate:open":n,class:T(["gallery-modal",{isUser:p(r).token}]),maskClosable:!1,closable:!1,title:" "},{footer:_((()=>[v(h,{type:"primary",onClick:l[2]||(l[2]=a=>p(Ca)(a,e.imageInfo,p(r)))},{default:_((()=>l[3]||(l[3]=[K("复制链接")]))),_:1,__:[3]}),v(h,{type:"primary",onClick:i},{default:_((()=>l[4]||(l[4]=[K("关闭弹窗")]))),_:1,__:[4]})])),default:_((()=>[c("div",Xa,[v(t,{class:"modal-image",placeholder:"",src:"local"===e.imageInfo.type?p(r).config.site.url+e.imageInfo.url:e.imageInfo.url,preview:!1},null,8,["src"])]),p(r).token?(x(),g(y,{key:0,bordered:"",column:1,size:"middle"},{default:_((()=>{var a,t,n,i,o;return[v(u,{label:"上传用户"},{default:_((()=>{var a,t;return[c("span",{class:"username",onClick:l[0]||(l[0]=a=>m(e.imageInfo,"user"))},z((null==(t=null==(a=e.imageInfo)?void 0:a.user)?void 0:t.username)||"游客"),1)]})),_:1}),v(u,{label:"所属相册"},{default:_((()=>{var a,t;return[c("span",{class:"username",onClick:l[1]||(l[1]=a=>m(e.imageInfo,"album"))},z((null==(t=null==(a=e.imageInfo)?void 0:a.album)?void 0:t.name)||"独立图片"),1)]})),_:1}),v(u,{label:"图片名称"},{default:_((()=>[K(z(e.imageInfo.filename),1)])),_:1}),v(u,{label:"原始名称"},{default:_((()=>[K(z(e.imageInfo.name),1)])),_:1}),v(u,{label:"图片大小"},{default:_((()=>[K(z(p(Sa)(e.imageInfo.size)),1)])),_:1}),v(u,{label:"物理路径"},{default:_((()=>[K(z(e.imageInfo.filePath),1)])),_:1}),v(u,{label:"图片类型"},{default:_((()=>[K("image/"+z(e.imageInfo.filename.split(".").pop()),1)])),_:1}),v(u,{label:"MD5"},{default:_((()=>[K(z(e.imageInfo.md5),1)])),_:1}),v(u,{label:"SHA1"},{default:_((()=>[K(z(e.imageInfo.sha1),1)])),_:1}),v(u,{label:"尺寸"},{default:_((()=>[K(z(e.imageInfo.width)+" x "+z(e.imageInfo.height),1)])),_:1}),(null==(a=p(r))?void 0:a.user)&&((null==(n=null==(t=p(r))?void 0:t.user)?void 0:n.username)===(null==(i=e.imageInfo.user)?void 0:i.username)||(null==(o=p(r).user)?void 0:o.founder))?(x(),g(u,{key:0,label:"上传IP"},{default:_((()=>[K(z(e.imageInfo.ip)+" (仅自己与管理员可见) ",1)])),_:1})):f("",!0),v(u,{label:"上传时间"},{default:_((()=>[K(z(p(qa)(e.imageInfo.updatedAt)),1)])),_:1})]})),_:1})):f("",!0),e.imageKey>0?(x(),s("div",{key:1,class:"ant-image-preview-switch-left",onClick:o},[c("span",Qa,[v(p(he))])])):f("",!0),e.images.length>1&&e.images.length>e.imageKey+1?(x(),s("div",{key:2,class:"ant-image-preview-switch-right",onClick:d},[c("span",el,[v(p(be))])])):f("",!0)])),_:1},8,["open","class"])}}},ll={class:"gallery-container"},tl={style:{"margin-bottom":"20px","text-align":"center"}},ul={class:"gallery-content"},rl={key:0,class:"loading-more"},nl={class:"image-item-tags"},il=["src"],ol=["src"],dl=oa({__name:"Gallery",setup(e){const a=ta(),t=l([]),u=l(1),r=l(0),n=l(!1),i=l(!1),o=l(!1),m=l({}),y=l(0),h={1920:{rowPerView:5},1200:{rowPerView:4},800:{rowPerView:3},500:{rowPerView:2}},k=l([]),w=async()=>{if(!(!n.value&&t.value.length>=r.value&&r.value>0)){n.value=!0,i.value=!1;try{const{data:e}=await ia.post("/api/images",re.stringify({page:u.value,limit:20,tags:k.value}));r.value=e.total,1===u.value?t.value=e.images:t.value.push(...e.images),u.value++,0===t.value.length&&0===r.value&&0===k.value.length?i.value=!0:i.value=!1}catch(e){console.error("获取图片列表失败:",e),b.error("获取图片列表失败"),i.value=!0}finally{n.value=!1}}},U=()=>{u.value=1,r.value=0,t.value=[],w()};return d((()=>{u.value=1,w()})),(e,l)=>{const u=we,d=B,b=fe,I=xe,q=qe,S=Ue;return x(),s("div",ll,[c("div",tl,[v(u,{value:k.value,"onUpdate:value":l[0]||(l[0]=e=>k.value=e),mode:"tags",style:{width:"300px"},placeholder:"按标签搜索",onChange:U},null,8,["value"])]),c("div",ul,[v(S,{loading:n.value,"item-layout":"horizontal","data-source":t.value},{loadMore:_((()=>[!n.value&&t.value.length<r.value?(x(),s("div",rl,[v(d,{class:"loading-more-button",onClick:w},{default:_((()=>l[4]||(l[4]=[K("加载更多")]))),_:1,__:[4]})])):f("",!0)])),default:_((()=>[t.value.length?(x(),g(p(Ie),{key:0,list:t.value,animationDuration:100,animationDelay:100,breakpoints:h},{default:_((({item:e,index:l})=>[v(b,{src:p(a).config.site.url+e.thumb,preview:{visible:!1},onClick:a=>((e,a)=>{m.value=e,o.value=!0,y.value=a})(e,l)},null,8,["src","onClick"]),c("div",nl,[(x(!0),s(O,null,H(e.tags,(e=>(x(),g(I,{key:e,size:"small",onClick:a=>(e=>{k.value.push(e),U()})(e)},{default:_((()=>[K(z(e),1)])),_:2},1032,["onClick"])))),128))])])),_:1},8,["list"])):i.value&&!n.value?(x(),g(q,{key:1,title:"图片广场空空如也","sub-title":"快来上传你的第一张图片吧~"},{icon:_((()=>[c("img",{src:p(Wa),class:"ant-result-icon ant-result-image"},null,8,il)])),_:1})):0===t.value.length&&!n.value&&k.value.length>0?(x(),g(q,{key:2,title:"没有找到匹配的图片","sub-title":"请尝试其他标签"},{icon:_((()=>[c("img",{src:p(Wa),class:"ant-result-icon ant-result-image"},null,8,ol)])),_:1})):f("",!0)])),_:1},8,["loading","data-source"]),v(al,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value=e),imageInfo:m.value,"onUpdate:imageInfo":l[2]||(l[2]=e=>m.value=e),imageKey:y.value,"onUpdate:imageKey":l[3]||(l[3]=e=>y.value=e),images:t.value},null,8,["modelValue","imageInfo","imageKey","images"])])])}}},[["__scopeId","data-v-fd7d6941"]]),sl={class:"api-docs"},cl=oa({__name:"Docs",setup(e){const a=l(["login"]),t=[{title:"参数名",dataIndex:"name",key:"name"},{title:"类型",dataIndex:"type",key:"type"},{title:"必填",dataIndex:"required",key:"required"},{title:"说明",dataIndex:"description",key:"description"}],u=[{title:"字段名",dataIndex:"field",key:"field"},{title:"类型",dataIndex:"type",key:"type"},{title:"说明",dataIndex:"description",key:"description"}],r=[{title:"响应码",dataIndex:"code",key:"code"},{title:"说明",dataIndex:"description",key:"description"}],n=[{key:"1",name:"username",type:"string",required:"是",description:"用户名"},{key:"2",name:"password",type:"string",required:"是",description:"密码"}],i=[{key:"1",field:"token",type:"string",description:"JWT认证令牌"},{key:"2",field:"user",type:"object",description:"用户信息对象"},{key:"3",field:"user._id",type:"string",description:"用户ID"},{key:"4",field:"user.username",type:"string",description:"用户名"},{key:"5",field:"user.role",type:"string",description:"用户角色(admin/user)"},{key:"6",field:"user.status",type:"string",description:"用户状态"},{key:"7",field:"user.email",type:"string",description:"用户邮箱"},{key:"8",field:"user.founder",type:"boolean",description:"是否为创始人"}],o=[{key:"1",code:"200",description:"登录成功"},{key:"2",code:"400",description:"用户名或密码错误"},{key:"3",code:"400",description:"账号已被禁用"}],d=[{key:"1",name:"username",type:"string",required:"是",description:"用户名"},{key:"2",name:"password",type:"string",required:"是",description:"密码"},{key:"3",name:"email",type:"string",required:"是",description:"邮箱"}],m=[{key:"1",field:"token",type:"string",description:"JWT认证令牌"},{key:"2",field:"user",type:"object",description:"用户信息对象"}],g=[{key:"1",code:"201",description:"注册成功"},{key:"2",code:"400",description:"用户名已存在"},{key:"3",code:"403",description:"注册已关闭"}],f=[{key:"1",name:"Authorization",type:"string",required:"是",description:"Bearer token"}],y=[{key:"1",field:"_id",type:"string",description:"用户ID"},{key:"2",field:"username",type:"string",description:"用户名"},{key:"3",field:"role",type:"string",description:"用户角色"},{key:"4",field:"status",type:"string",description:"用户状态"},{key:"5",field:"email",type:"string",description:"用户邮箱"},{key:"6",field:"founder",type:"boolean",description:"是否为创始人"},{key:"7",field:"lastLogin",type:"number",description:"最后登录时间戳"}],h=[{key:"1",code:"200",description:"获取成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"404",description:"用户不存在"}],b=[],k=[{key:"1",field:"upload",type:"object",description:"上传配置"},{key:"2",field:"site",type:"object",description:"站点配置"},{key:"3",field:"ai",type:"object",description:"鉴黄配置"}],w=[{key:"1",code:"200",description:"获取成功"},{key:"2",code:"404",description:"配置不存在"},{key:"3",code:"500",description:"服务器错误"}],U=[{key:"1",name:"image",type:"File",required:"是",description:"图片文件"},{key:"2",name:"md5",type:"string",required:"否",description:"文件MD5值"},{key:"3",name:"ip",type:"string",required:"否",description:"客户端IP地址"}],I=[{key:"1",field:"name",type:"string",description:"原始文件名"},{key:"2",field:"url",type:"string",description:"图片访问地址"},{key:"3",field:"thumb",type:"string",description:"缩略图地址"},{key:"4",field:"md5",type:"string",description:"文件MD5值"},{key:"5",field:"sha1",type:"string",description:"文件SHA1值"},{key:"6",field:"safe",type:"string",description:"图片安全检测结果"},{key:"7",field:"label",type:"array",description:"图片标签"},{key:"8",field:"type",type:"string",description:"存储类型"},{key:"9",field:"user",type:"string",description:"上传用户ID"},{key:"10",field:"width",type:"number",description:"图片宽度"},{key:"11",field:"height",type:"number",description:"图片高度"},{key:"12",field:"date",type:"number",description:"上传时间戳"},{key:"13",field:"ip",type:"string",description:"上传IP"},{key:"14",field:"size",type:"number",description:"文件大小(字节)"},{key:"15",field:"filePath",type:"string",description:"文件存储路径"},{key:"16",field:"filename",type:"string",description:"文件名"}],q=[{key:"1",code:"201",description:"上传成功"},{key:"2",code:"400",description:"上传失败"},{key:"3",code:"400",description:"图片中包含敏感内容"},{key:"4",code:"400",code:"当前上传IP已被拉黑"},{key:"5",code:"401",description:"未认证"}],S=U,C=I,P=[{key:"1",code:"201",description:"上传成功"},{key:"2",code:"400",description:"上传失败"},{key:"3",code:"400",description:"图片中包含敏感内容"},{key:"4",code:"400",description:"当前上传IP已被拉黑"}],A=[{key:"1",name:"page",type:"number",required:"是",description:"页码"},{key:"2",name:"limit",type:"number",required:"是",description:"每页数量"}],M=[{key:"1",field:"images",type:"array",description:"图片列表"},{key:"2",field:"total",type:"number",description:"总数量"}],D=[{key:"1",code:"200",description:"获取成功"},{key:"2",code:"500",description:"服务器错误"}],L=[{key:"1",name:"id",type:"string",required:"是",description:"图片ID"},{key:"2",name:"Authorization",type:"string",required:"是",description:"Bearer token"}],T=[{key:"1",field:"message",type:"string",description:"删除成功"}],z=[{key:"1",code:"200",description:"删除成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"404",description:"图片不存在"},{key:"4",code:"500",description:"服务器错误"}],O=[{key:"1",name:"page",type:"number",required:"是",description:"页码"},{key:"2",name:"limit",type:"number",required:"是",description:"每页数量"}],H=[{key:"1",field:"users",type:"array",description:"用户列表"},{key:"2",field:"total",type:"number",description:"总数量"}],$=[{key:"1",code:"200",description:"获取成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"403",description:"无权限"},{key:"4",code:"500",description:"服务器错误"}],R=[{key:"1",name:"id",type:"string",required:"是",description:"用户ID"},{key:"2",name:"status",type:"string",required:"是",description:"用户状态(active/disabled)"}],E=[{key:"1",field:"_id",type:"string",description:"用户ID"},{key:"2",field:"username",type:"string",description:"用户名"},{key:"3",field:"role",type:"string",description:"用户角色"},{key:"4",field:"status",type:"string",description:"用户状态"},{key:"5",field:"email",type:"string",description:"用户邮箱"},{key:"6",field:"founder",type:"boolean",description:"是否为创始人"}],B=[{key:"1",code:"200",description:"更新成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"403",description:"无权限或无法修改创始人状态"},{key:"4",code:"404",description:"用户不存在"},{key:"5",code:"500",description:"服务器错误"}],F=[{key:"1",name:"id",type:"string",required:"是",description:"用户ID"},{key:"2",name:"role",type:"string",required:"是",description:"用户角色(admin/user)"}],j=E,G=B,Z=[],V=[{key:"1",field:"stats",type:"array",description:"统计信息"},{key:"2",field:"stats[].name",type:"string",description:"统计项名称"},{key:"3",field:"stats[].value",type:"string/number",description:"统计项值"},{key:"4",field:"system",type:"array",description:"系统信息"},{key:"5",field:"system[].name",type:"string",description:"系统信息项名称"},{key:"6",field:"system[].value",type:"string",description:"系统信息项值"}],Y=[{key:"1",code:"200",description:"获取成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"403",description:"无权限"},{key:"4",code:"500",description:"服务器错误"}],J=[{key:"1",name:"page",type:"number",required:"是",description:"页码"},{key:"2",name:"limit",type:"number",required:"是",description:"每页数量"},{key:"3",name:"startDate",type:"string",required:"否",description:"开始日期"},{key:"4",name:"endDate",type:"string",required:"否",description:"结束日期"},{key:"5",name:"username",type:"string",required:"否",description:"用户名(模糊搜索)"},{key:"6",name:"ip",type:"string",required:"否",description:"IP地址(模糊搜索)"}],W=[{key:"1",field:"logs",type:"array",description:"日志列表"},{key:"2",field:"total",type:"number",description:"总数量"},{key:"3",field:"page",type:"number",description:"当前页码"},{key:"4",field:"limit",type:"number",description:"每页数量"}],X=[{key:"1",code:"200",description:"获取成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"403",description:"无权限"},{key:"4",code:"500",description:"服务器错误"}],Q=[{key:"1",name:"startDate",type:"string",required:"否",description:"开始日期"},{key:"2",name:"endDate",type:"string",required:"否",description:"结束日期"}],ee=[{key:"1",field:"dailyStats",type:"array",description:"每日统计信息"},{key:"2",field:"dailyStats[]._id",type:"object",description:"日期信息"},{key:"3",field:"dailyStats[]._id.year",type:"number",description:"年份"},{key:"4",field:"dailyStats[]._id.month",type:"number",description:"月份"},{key:"5",field:"dailyStats[]._id.day",type:"number",description:"日期"},{key:"6",field:"dailyStats[].count",type:"number",description:"上传数量"},{key:"7",field:"dailyStats[].totalSize",type:"number",description:"总大小(字节)"},{key:"8",field:"ipStats",type:"array",description:"IP统计信息"},{key:"9",field:"ipStats[]._id",type:"string",description:"IP地址"},{key:"10",field:"ipStats[].count",type:"number",description:"上传次数"},{key:"11",field:"userStats",type:"array",description:"用户统计信息"},{key:"12",field:"userStats[]._id",type:"string",description:"用户ID"},{key:"13",field:"userStats[].username",type:"string",description:"用户名"},{key:"14",field:"userStats[].count",type:"number",description:"上传次数"},{key:"15",field:"userStats[].totalSize",type:"number",description:"总大小(字节)"}],ae=[{key:"1",code:"200",description:"获取成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"403",description:"无权限"},{key:"4",code:"500",description:"服务器错误"}],le=[{key:"1",name:"id",type:"string",required:"是",description:"日志ID"}],te=[{key:"1",field:"message",type:"string",description:"删除成功"}],ue=[{key:"1",code:"200",description:"删除成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"403",description:"无权限"},{key:"4",code:"404",description:"日志不存在"},{key:"5",code:"500",description:"服务器错误"}],re=[],ne=[{key:"1",field:"message",type:"string",description:"所有日志已清空"}],ie=[{key:"1",code:"200",description:"清空成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"403",description:"无权限"},{key:"4",code:"500",description:"服务器错误"}],oe=[{key:"1",name:"page",type:"number",required:"是",description:"页码"},{key:"2",name:"limit",type:"number",required:"是",description:"每页数量"}],de=[{key:"1",field:"images",type:"array",description:"图片列表"},{key:"2",field:"total",type:"number",description:"总数量"}],se=[{key:"1",code:"200",description:"获取成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"500",description:"服务器错误"}],ce=[{key:"1",name:"id",type:"string",required:"是",description:"图片ID"}],ve=[{key:"1",field:"message",type:"string",description:"删除成功"}],pe=[{key:"1",code:"200",description:"删除成功"},{key:"2",code:"401",description:"未认证"},{key:"3",code:"404",description:"图片不存在"},{key:"4",code:"500",description:"服务器错误"}];return(e,l)=>{const me=ye,ge=_e,fe=Pe,he=Ce,be=Se,ke=N;return x(),s("div",sl,[v(ke,{class:"api-card"},{title:_((()=>l[1]||(l[1]=[c("h2",null,"API 接口文档",-1)]))),default:_((()=>[v(be,{activeKey:a.value,"onUpdate:activeKey":l[0]||(l[0]=e=>a.value=e),accordion:"",bordered:!1},{default:_((()=>[v(he,{key:"users",header:"用户相关接口"},{default:_((()=>[v(be,{accordion:"",bordered:!1},{default:_((()=>[v(he,{key:"login",header:"登录接口"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[2]||(l[2]=[K("/api/auth/login")]))),_:1,__:[2]}),v(me,{label:"请求方式"},{default:_((()=>l[3]||(l[3]=[K("POST")]))),_:1,__:[3]}),v(me,{label:"接口说明"},{default:_((()=>l[4]||(l[4]=[K("用户登录")]))),_:1,__:[4]})])),_:1}),l[5]||(l[5]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":n,pagination:!1}),l[6]||(l[6]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":i,pagination:!1}),l[7]||(l[7]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":o,pagination:!1})])),_:1,__:[5,6,7]}),v(he,{key:"register",header:"注册接口"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[8]||(l[8]=[K("/api/auth/register")]))),_:1,__:[8]}),v(me,{label:"请求方式"},{default:_((()=>l[9]||(l[9]=[K("POST")]))),_:1,__:[9]}),v(me,{label:"接口说明"},{default:_((()=>l[10]||(l[10]=[K("用户注册")]))),_:1,__:[10]})])),_:1}),l[11]||(l[11]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":d,pagination:!1}),l[12]||(l[12]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":m,pagination:!1}),l[13]||(l[13]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":g,pagination:!1})])),_:1,__:[11,12,13]}),v(he,{key:"userInfo",header:"获取当前登录用户信息"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[14]||(l[14]=[K("/api/auth/info")]))),_:1,__:[14]}),v(me,{label:"请求方式"},{default:_((()=>l[15]||(l[15]=[K("POST")]))),_:1,__:[15]}),v(me,{label:"接口说明"},{default:_((()=>l[16]||(l[16]=[K("获取当前登录用户信息")]))),_:1,__:[16]}),v(me,{label:"需要认证"},{default:_((()=>l[17]||(l[17]=[K("是")]))),_:1,__:[17]})])),_:1}),l[18]||(l[18]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":f,pagination:!1}),l[19]||(l[19]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":y,pagination:!1}),l[20]||(l[20]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":h,pagination:!1})])),_:1,__:[18,19,20]}),v(he,{key:"myImages",header:"获取我的图片列表"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[21]||(l[21]=[K("/api/auth/my")]))),_:1,__:[21]}),v(me,{label:"请求方式"},{default:_((()=>l[22]||(l[22]=[K("POST")]))),_:1,__:[22]}),v(me,{label:"接口说明"},{default:_((()=>l[23]||(l[23]=[K("获取当前登录用户的图片列表")]))),_:1,__:[23]}),v(me,{label:"需要认证"},{default:_((()=>l[24]||(l[24]=[K("是")]))),_:1,__:[24]})])),_:1}),l[25]||(l[25]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":oe,pagination:!1}),l[26]||(l[26]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":de,pagination:!1}),l[27]||(l[27]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":se,pagination:!1})])),_:1,__:[25,26,27]}),v(he,{key:"deleteMyImage",header:"删除我的图片"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[28]||(l[28]=[K("/api/auth/images/:id")]))),_:1,__:[28]}),v(me,{label:"请求方式"},{default:_((()=>l[29]||(l[29]=[K("DELETE")]))),_:1,__:[29]}),v(me,{label:"接口说明"},{default:_((()=>l[30]||(l[30]=[K("删除当前登录用户的指定图片")]))),_:1,__:[30]}),v(me,{label:"需要认证"},{default:_((()=>l[31]||(l[31]=[K("是")]))),_:1,__:[31]})])),_:1}),l[32]||(l[32]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":ce,pagination:!1}),l[33]||(l[33]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":ve,pagination:!1}),l[34]||(l[34]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":pe,pagination:!1})])),_:1,__:[32,33,34]})])),_:1})])),_:1}),v(he,{key:"config",header:"获取站点配置"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[35]||(l[35]=[K("/api/auth/config")]))),_:1,__:[35]}),v(me,{label:"请求方式"},{default:_((()=>l[36]||(l[36]=[K("POST")]))),_:1,__:[36]}),v(me,{label:"接口说明"},{default:_((()=>l[37]||(l[37]=[K("获取站点配置信息")]))),_:1,__:[37]})])),_:1}),l[38]||(l[38]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":b,pagination:!1}),l[39]||(l[39]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":k,pagination:!1}),l[40]||(l[40]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":w,pagination:!1})])),_:1,__:[38,39,40]}),v(he,{key:"images",header:"图片相关接口"},{default:_((()=>[v(be,{accordion:"",bordered:!1},{default:_((()=>[v(he,{key:"userUpload",header:"用户上传图片"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[41]||(l[41]=[K("/api/upload")]))),_:1,__:[41]}),v(me,{label:"请求方式"},{default:_((()=>l[42]||(l[42]=[K("POST")]))),_:1,__:[42]}),v(me,{label:"接口说明"},{default:_((()=>l[43]||(l[43]=[K("用户上传图片（需要登录）")]))),_:1,__:[43]}),v(me,{label:"需要认证"},{default:_((()=>l[44]||(l[44]=[K("是")]))),_:1,__:[44]})])),_:1}),l[45]||(l[45]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":U,pagination:!1}),l[46]||(l[46]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":I,pagination:!1}),l[47]||(l[47]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":q,pagination:!1})])),_:1,__:[45,46,47]}),v(he,{key:"touristUpload",header:"游客上传图片"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[48]||(l[48]=[K("/api/tourist/upload")]))),_:1,__:[48]}),v(me,{label:"请求方式"},{default:_((()=>l[49]||(l[49]=[K("POST")]))),_:1,__:[49]}),v(me,{label:"接口说明"},{default:_((()=>l[50]||(l[50]=[K("游客上传图片（无需登录）")]))),_:1,__:[50]})])),_:1}),l[51]||(l[51]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":p(S),pagination:!1},null,8,["data-source"]),l[52]||(l[52]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":p(C),pagination:!1},null,8,["data-source"]),l[53]||(l[53]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":P,pagination:!1})])),_:1,__:[51,52,53]}),v(he,{key:"imageList",header:"获取图片广场数据"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[54]||(l[54]=[K("/api/images")]))),_:1,__:[54]}),v(me,{label:"请求方式"},{default:_((()=>l[55]||(l[55]=[K("POST")]))),_:1,__:[55]}),v(me,{label:"接口说明"},{default:_((()=>l[56]||(l[56]=[K("获取图片广场数据")]))),_:1,__:[56]})])),_:1}),l[57]||(l[57]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":A,pagination:!1}),l[58]||(l[58]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":M,pagination:!1}),l[59]||(l[59]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":D,pagination:!1})])),_:1,__:[57,58,59]}),v(he,{key:"deleteImage",header:"删除图片"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[60]||(l[60]=[K("/api/images/:id")]))),_:1,__:[60]}),v(me,{label:"请求方式"},{default:_((()=>l[61]||(l[61]=[K("DELETE")]))),_:1,__:[61]}),v(me,{label:"接口说明"},{default:_((()=>l[62]||(l[62]=[K("删除指定图片")]))),_:1,__:[62]}),v(me,{label:"需要认证"},{default:_((()=>l[63]||(l[63]=[K("是")]))),_:1,__:[63]})])),_:1}),l[64]||(l[64]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":L,pagination:!1}),l[65]||(l[65]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":T,pagination:!1}),l[66]||(l[66]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":z,pagination:!1})])),_:1,__:[64,65,66]})])),_:1})])),_:1}),v(he,{key:"admin",header:"管理相关接口"},{default:_((()=>[v(be,{accordion:"",bordered:!1},{default:_((()=>[v(he,{key:"adminUsers",header:"获取用户列表"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[67]||(l[67]=[K("/api/admin/users")]))),_:1,__:[67]}),v(me,{label:"请求方式"},{default:_((()=>l[68]||(l[68]=[K("POST")]))),_:1,__:[68]}),v(me,{label:"接口说明"},{default:_((()=>l[69]||(l[69]=[K("获取所有用户列表")]))),_:1,__:[69]}),v(me,{label:"需要认证"},{default:_((()=>l[70]||(l[70]=[K("是")]))),_:1,__:[70]}),v(me,{label:"需要权限"},{default:_((()=>l[71]||(l[71]=[K("admin")]))),_:1,__:[71]})])),_:1}),l[72]||(l[72]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":O,pagination:!1}),l[73]||(l[73]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":H,pagination:!1}),l[74]||(l[74]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":$,pagination:!1})])),_:1,__:[72,73,74]}),v(he,{key:"updateUserStatus",header:"更新用户状态"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[75]||(l[75]=[K("/api/admin/users/:id/status")]))),_:1,__:[75]}),v(me,{label:"请求方式"},{default:_((()=>l[76]||(l[76]=[K("PATCH")]))),_:1,__:[76]}),v(me,{label:"接口说明"},{default:_((()=>l[77]||(l[77]=[K("更新用户状态")]))),_:1,__:[77]}),v(me,{label:"需要认证"},{default:_((()=>l[78]||(l[78]=[K("是")]))),_:1,__:[78]}),v(me,{label:"需要权限"},{default:_((()=>l[79]||(l[79]=[K("admin")]))),_:1,__:[79]})])),_:1}),l[80]||(l[80]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":R,pagination:!1}),l[81]||(l[81]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":E,pagination:!1}),l[82]||(l[82]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":B,pagination:!1})])),_:1,__:[80,81,82]}),v(he,{key:"updateUserRole",header:"更新用户角色"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[83]||(l[83]=[K("/api/admin/users/:id/role")]))),_:1,__:[83]}),v(me,{label:"请求方式"},{default:_((()=>l[84]||(l[84]=[K("PATCH")]))),_:1,__:[84]}),v(me,{label:"接口说明"},{default:_((()=>l[85]||(l[85]=[K("更新用户角色")]))),_:1,__:[85]}),v(me,{label:"需要认证"},{default:_((()=>l[86]||(l[86]=[K("是")]))),_:1,__:[86]}),v(me,{label:"需要权限"},{default:_((()=>l[87]||(l[87]=[K("admin")]))),_:1,__:[87]})])),_:1}),l[88]||(l[88]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":F,pagination:!1}),l[89]||(l[89]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":p(j),pagination:!1},null,8,["data-source"]),l[90]||(l[90]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":p(G),pagination:!1},null,8,["data-source"])])),_:1,__:[88,89,90]}),v(he,{key:"systemStats",header:"获取系统统计信息"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[91]||(l[91]=[K("/api/admin/stats")]))),_:1,__:[91]}),v(me,{label:"请求方式"},{default:_((()=>l[92]||(l[92]=[K("POST")]))),_:1,__:[92]}),v(me,{label:"接口说明"},{default:_((()=>l[93]||(l[93]=[K("获取系统统计信息")]))),_:1,__:[93]}),v(me,{label:"需要认证"},{default:_((()=>l[94]||(l[94]=[K("是")]))),_:1,__:[94]}),v(me,{label:"需要权限"},{default:_((()=>l[95]||(l[95]=[K("admin")]))),_:1,__:[95]})])),_:1}),l[96]||(l[96]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":Z,pagination:!1}),l[97]||(l[97]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":V,pagination:!1}),l[98]||(l[98]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":Y,pagination:!1})])),_:1,__:[96,97,98]})])),_:1})])),_:1}),v(he,{key:"logs",header:"日志管理相关接口"},{default:_((()=>[v(be,{accordion:"",bordered:!1},{default:_((()=>[v(he,{key:"getLogs",header:"获取上传日志列表"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[99]||(l[99]=[K("/api/admin/logs")]))),_:1,__:[99]}),v(me,{label:"请求方式"},{default:_((()=>l[100]||(l[100]=[K("POST")]))),_:1,__:[100]}),v(me,{label:"接口说明"},{default:_((()=>l[101]||(l[101]=[K("获取上传日志列表")]))),_:1,__:[101]}),v(me,{label:"需要认证"},{default:_((()=>l[102]||(l[102]=[K("是")]))),_:1,__:[102]}),v(me,{label:"需要权限"},{default:_((()=>l[103]||(l[103]=[K("admin")]))),_:1,__:[103]})])),_:1}),l[104]||(l[104]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":J,pagination:!1}),l[105]||(l[105]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":W,pagination:!1}),l[106]||(l[106]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":X,pagination:!1})])),_:1,__:[104,105,106]}),v(he,{key:"getLogsStats",header:"获取日志统计信息"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[107]||(l[107]=[K("/api/admin/logs/stats")]))),_:1,__:[107]}),v(me,{label:"请求方式"},{default:_((()=>l[108]||(l[108]=[K("POST")]))),_:1,__:[108]}),v(me,{label:"接口说明"},{default:_((()=>l[109]||(l[109]=[K("获取日志统计信息")]))),_:1,__:[109]}),v(me,{label:"需要认证"},{default:_((()=>l[110]||(l[110]=[K("是")]))),_:1,__:[110]}),v(me,{label:"需要权限"},{default:_((()=>l[111]||(l[111]=[K("admin")]))),_:1,__:[111]})])),_:1}),l[112]||(l[112]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":Q,pagination:!1}),l[113]||(l[113]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":ee,pagination:!1}),l[114]||(l[114]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":ae,pagination:!1})])),_:1,__:[112,113,114]}),v(he,{key:"deleteLog",header:"删除指定日志"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[115]||(l[115]=[K("/api/admin/logs/:id")]))),_:1,__:[115]}),v(me,{label:"请求方式"},{default:_((()=>l[116]||(l[116]=[K("DELETE")]))),_:1,__:[116]}),v(me,{label:"接口说明"},{default:_((()=>l[117]||(l[117]=[K("删除指定日志")]))),_:1,__:[117]}),v(me,{label:"需要认证"},{default:_((()=>l[118]||(l[118]=[K("是")]))),_:1,__:[118]}),v(me,{label:"需要权限"},{default:_((()=>l[119]||(l[119]=[K("admin")]))),_:1,__:[119]})])),_:1}),l[120]||(l[120]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":le,pagination:!1}),l[121]||(l[121]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":te,pagination:!1}),l[122]||(l[122]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":ue,pagination:!1})])),_:1,__:[120,121,122]}),v(he,{key:"clearLogs",header:"清空所有日志"},{default:_((()=>[v(ge,{bordered:""},{default:_((()=>[v(me,{label:"接口路径"},{default:_((()=>l[123]||(l[123]=[K("/api/admin/logs")]))),_:1,__:[123]}),v(me,{label:"请求方式"},{default:_((()=>l[124]||(l[124]=[K("DELETE")]))),_:1,__:[124]}),v(me,{label:"接口说明"},{default:_((()=>l[125]||(l[125]=[K("清空所有日志")]))),_:1,__:[125]}),v(me,{label:"需要认证"},{default:_((()=>l[126]||(l[126]=[K("是")]))),_:1,__:[126]}),v(me,{label:"需要权限"},{default:_((()=>l[127]||(l[127]=[K("admin")]))),_:1,__:[127]})])),_:1}),l[128]||(l[128]=c("h3",null,"请求参数",-1)),v(fe,{columns:t,"data-source":re,pagination:!1}),l[129]||(l[129]=c("h3",null,"返回参数",-1)),v(fe,{columns:u,"data-source":ne,pagination:!1}),l[130]||(l[130]=c("h3",null,"响应码说明",-1)),v(fe,{columns:r,"data-source":ie,pagination:!1})])),_:1,__:[128,129,130]})])),_:1})])),_:1})])),_:1},8,["activeKey"])])),_:1})])}}},[["__scopeId","data-v-9290c167"]]),vl=["src"],pl={__name:"Not",setup:e=>(e,a)=>{const l=qe;return x(),g(l,{title:"404","sub-title":"页面不存在"},{icon:_((()=>[c("img",{src:p(Wa),class:"ant-result-icon ant-result-image"},null,8,vl)])),_:1})}},ml={class:"my-images"},gl={class:"card-title"},fl={class:"album-list-overview"},_l={key:1,class:"none-cover"},yl={key:0},hl={key:1,class:"image-grid"},bl={class:"image-info"},kl={class:"image-tags"},wl={class:"pagination"},Ul={key:1,style:{"margin-top":"10px"}},Il={key:1,class:"image-select-grid"},xl=["onClick"],ql=["src","alt"],Sl={style:{"text-align":"center","margin-top":"5px","font-size":"12px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Cl={class:"pagination",style:{"margin-top":"20px"}},Pl=oa({__name:"My",setup(e){const a=ta(),t=l(!1),u=l(!1),r=l([]),n=l(0),i=l(1),o=l(12),m=l(!1),y=l({}),h=l(0),k=l([]),U=l(0),S=l(null),C=l(!1),M=l(!1),D=l(null),L=l({_id:null,name:"",permission:"public",coverImage:null}),T={name:[{required:!0,message:"请输入相册名称",trigger:"blur"}],permission:[{required:!0,message:"请选择权限",trigger:"change"}]},$=l(!1),E=l(null),F=l(!1),j=l(!1),G=l([]),Z=l(0),V=l(1),X=l(20),Q=async()=>{var e;t.value=!0;try{const e={page:i.value,limit:o.value};void 0!==S.value&&null!==S.value?e.albumId=S.value._id:e.albumId="standalone";const{data:a}=await ia.post("/api/auth/my",re.stringify(e));r.value=a.images,n.value=a.total}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{t.value=!1}},ee=async()=>{var e;u.value=!0;try{const{data:e}=await ia.post("/api/auth/albums/my");k.value=e.albums||[],U.value=e.standaloneCount||0}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{u.value=!1}},ae=async()=>{var e;j.value=!0;try{const{data:e}=await ia.post("/api/auth/my",re.stringify({page:V.value,limit:X.value}));G.value=e.images,Z.value=e.total}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{j.value=!1}},le=e=>{i.value=e,Q()},te=e=>{S.value=e,i.value=1,n.value=0,r.value=[],Q()},ue=()=>{M.value=!1,L.value={_id:null,name:"",permission:"public",tags:[],coverImage:null},C.value=!0,D.value&&D.value.resetFields()},ne=async()=>{var e;try{await D.value.validate();const e={name:L.value.name,permission:L.value.permission,coverImage:L.value.coverImage?L.value.coverImage._id:null};if(M.value?(await ia.patch(`/api/auth/albums/${L.value._id}`,e),b.success("相册更新成功")):(await ia.post("/api/auth/albums",e),b.success("相册创建成功")),C.value=!1,ee(),M.value&&S.value&&S.value._id===L.value._id){-1!==k.value.findIndex((e=>e._id===L.value._id))&&ee()}}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}},ie=async(e,a)=>{var l;try{await ia.patch(`/api/auth/images/${e}/album`,{albumId:a}),b.success(a?"图片已添加到相册":"图片已移出相册"),Q(),ee()}catch({response:t}){b.error(null==(l=null==t?void 0:t.data)?void 0:l.error)}},oe=async()=>{var e;if(E.value)try{const e=E.value._id;await ia.patch(`/api/auth/images/${e}/tags`,{tags:E.value.tags}),b.success("图片标签更新成功"),$.value=!1,Q()}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}},de=()=>{V.value=1,G.value=[],Z.value=0,ae(),F.value=!0},se=()=>{L.value.coverImage=null};return d((()=>{ee(),te(null)})),(e,l)=>{const d=B,re=I("router-link"),ve=Ke,pe=N,me=fe,ge=Me,_e=xe,ye=A,he=R,be=P,Ue=w,Ie=Te,qe=Ae,Se=W,Ce=J,Pe=ze,Oe=we,He=Y,$e=ke;return x(),s("div",ml,[v(pe,null,{title:_((()=>[c("div",gl,[l[17]||(l[17]=c("span",null,"我的图片",-1)),c("div",null,[v(d,{style:{"margin-right":"10px"},onClick:ue},{default:_((()=>l[15]||(l[15]=[K("创建相册")]))),_:1,__:[15]}),v(d,{type:"primary"},{default:_((()=>[v(re,{to:"/"},{default:_((()=>[v(p(ce)),l[16]||(l[16]=K(" 上传图片 "))])),_:1,__:[16]})])),_:1})])])])),default:_((()=>[v(qe,{spinning:t.value||u.value},{default:_((()=>[c("div",fl,[v(pe,{hoverable:"",onClick:l[0]||(l[0]=e=>te(null))},{default:_((()=>[v(ve,{title:"独立图片"},{description:_((()=>[K("共 "+z(U.value)+" 张",1)])),_:1})])),_:1}),(x(!0),s(O,null,H(k.value,(e=>(x(),g(pe,{hoverable:"",key:e._id,onClick:a=>te(e)},{cover:_((()=>[e.coverImage?(x(),g(me,{key:0,src:p(a).config.site.url+e.coverImage.thumb,preview:!1},null,8,["src"])):(x(),s("div",_l,"无封面"))])),actions:_((()=>[v(d,{type:"link",onClick:q((a=>(e=>{M.value=!0,L.value={_id:e._id,name:e.name,permission:e.permission,tags:e.tags||[],coverImage:e.coverImage||null},C.value=!0,D.value&&D.value.resetFields()})(e)),["stop"])},{default:_((()=>l[18]||(l[18]=[K("编辑")]))),_:2,__:[18]},1032,["onClick"]),v(d,{type:"link",danger:"",onClick:q((a=>(e=>{ke.confirm({title:"确认删除相册",content:`确定要删除相册 "${e.name}" 吗？相册内的图片将被移出相册，但不会被删除。`,async onOk(){var a;try{await ia.delete(`/api/auth/albums/${e._id}`),b.success("相册已删除，图片已移出"),ee(),S.value&&S.value._id===e._id&&te(null)}catch({response:l}){b.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}}})})(e)),["stop"])},{default:_((()=>l[19]||(l[19]=[K("删除")]))),_:2,__:[19]},1032,["onClick"])])),default:_((()=>[v(ve,{title:e.name},{description:_((()=>[K("权限: "+z("public"===e.permission?"公开":"私有"),1)])),_:2},1032,["title"])])),_:2},1032,["onClick"])))),128))]),c("h2",null,[K(z(S.value?S.value.name:"独立图片")+" ",1),S.value?(x(),s("small",yl,"("+z("public"===S.value.permission?"公开":"私有")+")",1)):f("",!0)]),0!==r.value.length||t.value?(x(),s("div",hl,[(x(!0),s(O,null,H(r.value,(e=>(x(),s("div",{key:e._id,class:"image-item"},[v(pe,{hoverable:""},{cover:_((()=>[v(me,{src:p(a).config.site.url+e.thumb,preview:{visible:!1},onClick:a=>(e=>{y.value=e,m.value=!0})(e)},null,8,["src","onClick"])])),actions:_((()=>[v(d,{type:"link",onClick:l=>p(Ca)(l,e,p(a))},{default:_((()=>[v(p(De)),l[20]||(l[20]=K(" 复制 "))])),_:2,__:[20]},1032,["onClick"]),v(Ue,null,{overlay:_((()=>[v(be,null,{default:_((()=>[v(he,{key:"album",title:"修改相册"},{default:_((()=>[v(ye,{disabled:!e.album,onClick:a=>ie(e._id,null)},{default:_((()=>l[22]||(l[22]=[K(" 独立图片 ")]))),_:2,__:[22]},1032,["disabled","onClick"]),(x(!0),s(O,null,H(k.value,(a=>(x(),g(ye,{key:a._id,disabled:e.album===a._id,onClick:l=>ie(e._id,a._id)},{default:_((()=>[K(z(a.name),1)])),_:2},1032,["disabled","onClick"])))),128))])),_:2},1024),v(ye,{onClick:a=>(e=>{E.value=e,$.value=!0})(e)},{default:_((()=>[K(z(e.tags.length?"修改标签":"添加标签"),1)])),_:2},1032,["onClick"]),v(ye,{onClick:a=>(async e=>{ke.confirm({title:"确认删除",content:`确定要删除图片 "${e.filename}" 吗？`,async onOk(){var a;try{await ia.delete(`/api/auth/images/${e._id}`),b.success("删除成功"),Q(),S.value||ee()}catch({response:l}){b.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}}})})(e)},{default:_((()=>l[23]||(l[23]=[K("删除图片")]))),_:2,__:[23]},1032,["onClick"])])),_:2},1024)])),default:_((()=>[c("a",{class:"ant-dropdown-link",onClick:l[1]||(l[1]=q((()=>{}),["prevent"]))},[v(p(Le)),l[21]||(l[21]=K(" 更多 "))])])),_:2},1024)])),default:_((()=>[v(ve,null,{title:_((()=>[K(z(e.filename),1)])),description:_((()=>[c("div",bl,[c("span",null,z(p(Sa)(e.size)),1),c("span",null,z(p(qa)(e.date)),1)]),c("div",kl,[(x(!0),s(O,null,H(e.tags,(e=>(x(),g(_e,{key:e},{default:_((()=>[K(z(e),1)])),_:2},1024)))),128))])])),_:2},1024)])),_:2},1024)])))),128))])):(x(),g(ge,{key:0,description:"暂无图片"})),c("div",wl,[v(Ie,{current:i.value,"onUpdate:current":l[2]||(l[2]=e=>i.value=e),total:n.value,"page-size":o.value,onChange:le},null,8,["current","total","page-size"])])])),_:1},8,["spinning"])])),_:1}),v(al,{modelValue:m.value,"onUpdate:modelValue":l[3]||(l[3]=e=>m.value=e),imageInfo:y.value,"onUpdate:imageInfo":l[4]||(l[4]=e=>y.value=e),imageKey:h.value,"onUpdate:imageKey":l[5]||(l[5]=e=>h.value=e),images:r.value},null,8,["modelValue","imageInfo","imageKey","images"]),v($e,{open:C.value,"onUpdate:open":l[8]||(l[8]=e=>C.value=e),title:M.value?"编辑相册":"创建相册",onOk:ne,onCancel:l[9]||(l[9]=e=>C.value=!1)},{default:_((()=>[v(He,{model:L.value,rules:T,ref_key:"albumFormRef",ref:D,layout:"vertical"},{default:_((()=>[v(Ce,{label:"相册名称",name:"name"},{default:_((()=>[v(Se,{value:L.value.name,"onUpdate:value":l[6]||(l[6]=e=>L.value.name=e),placeholder:"请输入相册名称"},null,8,["value"])])),_:1}),v(Ce,{label:"权限",name:"permission"},{default:_((()=>[v(Oe,{value:L.value.permission,"onUpdate:value":l[7]||(l[7]=e=>L.value.permission=e),placeholder:"请选择相册权限"},{default:_((()=>[v(Pe,{value:"public"},{default:_((()=>l[24]||(l[24]=[K("公开")]))),_:1,__:[24]}),v(Pe,{value:"private"},{default:_((()=>l[25]||(l[25]=[K("私有")]))),_:1,__:[25]})])),_:1},8,["value"])])),_:1}),M.value?(x(),g(Ce,{key:0,label:"封面图片"},{default:_((()=>[v(d,{type:"primary",style:{"margin-right":"10px"},onClick:de},{default:_((()=>l[26]||(l[26]=[K("选择图片")]))),_:1,__:[26]}),L.value.coverImage?(x(),g(d,{key:0,type:"primary",danger:"",onClick:se},{default:_((()=>l[27]||(l[27]=[K("移除封面")]))),_:1,__:[27]})):f("",!0),L.value.coverImage?(x(),s("div",Ul,[v(me,{src:p(a).config.site.url+L.value.coverImage.thumb,height:200},null,8,["src"])])):f("",!0)])),_:1})):f("",!0)])),_:1},8,["model"])])),_:1},8,["open","title"]),v($e,{open:$.value,"onUpdate:open":l[11]||(l[11]=e=>$.value=e),title:"标签",onOk:oe,onCancel:l[12]||(l[12]=e=>$.value=!1)},{default:_((()=>[v(Oe,{value:E.value.tags,"onUpdate:value":l[10]||(l[10]=e=>E.value.tags=e),mode:"tags",placeholder:"输入标签，按回车键添加",style:{width:"100%"}},null,8,["value"])])),_:1},8,["open"]),v($e,{open:F.value,"onUpdate:open":l[14]||(l[14]=e=>F.value=e),title:"选择相册封面",width:"80%",footer:null},{default:_((()=>[v(qe,{spinning:j.value},{default:_((()=>[0!==G.value.length||j.value?(x(),s("div",Il,[(x(!0),s(O,null,H(G.value,(e=>(x(),s("div",{key:e._id,class:"image-select-item",onClick:a=>(e=>{L.value.coverImage=e,F.value=!1})(e)},[v(pe,{hoverable:"",bodyStyle:{padding:"5px"}},{default:_((()=>[c("img",{src:p(a).config.site.url+e.thumb,alt:e.filename,style:{width:"100%",height:"120px","object-fit":"cover"}},null,8,ql),c("p",Sl,z(e.filename),1)])),_:2},1024)],8,xl)))),128))])):(x(),g(ge,{key:0,description:"暂无图片可选"})),c("div",Cl,[v(Ie,{current:V.value,"onUpdate:current":l[13]||(l[13]=e=>V.value=e),total:Z.value,"page-size":X.value,onChange:ae},null,8,["current","total","page-size"])])])),_:1},8,["spinning"])])),_:1},8,["open"])])}}},[["__scopeId","data-v-5a7ba412"]]),Al={class:"dashboard"},Kl={class:"ant-row"},Ml={class:"ant-row"},Dl=oa({__name:"Dashboard",setup(e){const a=l([]),t=l([]),u=l(!0);return d((async()=>{try{const{data:e}=await ia.post("/api/admin/stats");a.value=e.stats,t.value=e.system,u.value=!1}catch(e){console.error("获取统计信息失败:",e)}})),(e,l)=>{const r=N,n=He,i=Oe,o=Ae;return x(),s("div",Al,[v(o,{spinning:u.value},{default:_((()=>[c("div",Kl,[(x(!0),s(O,null,H(a.value,((e,a)=>(x(),g(r,{class:"ant-row-item",key:a},{title:_((()=>[K(z(e.name),1)])),default:_((()=>[c("h2",null,z(e.value),1)])),_:2},1024)))),128))]),c("div",Ml,[v(r,{class:"ant-row-item-table"},{title:_((()=>l[0]||(l[0]=[K("系统信息")]))),default:_((()=>[v(i,{stripe:"",data:t.value,"show-header":!1},{default:_((()=>[v(n,{prop:"name"}),v(n,{prop:"value"})])),_:1},8,["data"])])),_:1})])])),_:1},8,["spinning"])])}}},[["__scopeId","data-v-7e4705c2"]]),Ll={class:"users"},Tl={class:"header"},zl=oa({__name:"Users",setup(e){const a=l([]),t=l(!1),u=l(1),r=l(10),n=l(0),i=l(""),o=l(!1),m=l(null),g=l({username:"",email:"",password:"",role:"user"}),f=l(!1),y=l(null),h=l({_id:"",username:"",email:"",role:"",status:"",founder:!1,password:""}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应在3-20个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},w={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应在3-20个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],password:[{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}]},U=async()=>{t.value=!0,a.value=[];try{const{data:e}=await ia.post("/api/admin/users",re.stringify({page:u.value,limit:r.value,username:i.value}));n.value=e.total,a.value.push(...e.users)}catch({response:e}){b.error("获取用户列表失败")}finally{t.value=!1}},I=()=>{g.value={username:"",email:"",password:"",role:"user"},o.value=!0,m.value&&m.value.resetFields()},q=async()=>{var e,a;try{await m.value.validate(),await ia.post("/api/admin/users/create",g.value),b.success("用户创建成功"),o.value=!1,U()}catch(l){console.error("创建用户失败:",l),(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)?b.error(l.response.data.error):b.error("创建用户失败")}},S=async()=>{var e;try{await y.value.validate();const e=h.value._id,a={username:h.value.username,email:h.value.email,role:h.value.role,status:h.value.status};h.value.password&&(a.password=h.value.password),h.value.founder&&(delete a.role,delete a.status),await ia.patch(`/api/admin/users/${e}`,a),b.success("用户数据更新成功"),f.value=!1,U()}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}};return d(U),(e,l)=>{const d=$e,C=B,P=He,A=xe,M=Oe,D=Ae,L=Te,T=W,O=J,H=X,$=ze,R=we,E=Y,F=ke;return x(),s("div",Ll,[c("div",Tl,[v(d,{value:i.value,"onUpdate:value":l[0]||(l[0]=e=>i.value=e),allowClear:"",placeholder:"输入用户名搜索",onSearch:U},null,8,["value"]),v(C,{type:"primary",onClick:I},{default:_((()=>l[16]||(l[16]=[K("创建用户")]))),_:1,__:[16]})]),v(D,{spinning:t.value},{default:_((()=>[v(M,{data:a.value,"scrollbar-always-on":!0,fit:""},{default:_((()=>[v(P,{prop:"username",label:"用户名",fixed:""}),v(P,{prop:"name",label:"IP地址"},{default:_((({row:e})=>{var a,l;return[K(z((null==(a=e.ip)?void 0:a.ipv4)||(null==(l=e.ip)?void 0:l.ipv6)),1)]})),_:1}),v(P,{prop:"email",label:"注册邮箱"}),v(P,{prop:"role",label:"角色"},{default:_((({row:e})=>[K(z("admin"===e.role?"管理员":"注册用户"),1)])),_:1}),v(P,{prop:"date",label:"状态"},{default:_((({row:e})=>[v(A,{color:"active"===e.status?"green":"red"},{default:_((()=>[K(z("active"===e.status?"正常":"封号"),1)])),_:2},1032,["color"])])),_:1}),v(P,{prop:"createdAt",sortable:"",label:"注册时间"},{default:_((({row:e})=>[K(z(p(qa)(e.createdAt)),1)])),_:1}),v(P,{prop:"lastLogin",sortable:"",label:"最后登录"},{default:_((({row:e})=>[K(z(p(qa)(e.lastLogin)),1)])),_:1}),v(P,{label:"操作",fixed:"right"},{default:_((({row:e})=>[v(C,{type:"link",onClick:a=>{return l=e,h.value={_id:l._id,username:l.username,email:l.email,role:l.role,status:l.status,founder:l.founder,password:""},f.value=!0,void(y.value&&y.value.resetFields());var l}},{default:_((()=>l[17]||(l[17]=[K("编辑")]))),_:2,__:[17]},1032,["onClick"]),v(C,{type:"link",danger:"",onClick:a=>(async e=>{e.founder?b.error("无法删除创始人账号"):ke.confirm({title:"确认删除",content:`确定要删除用户 "${e.username}" 的账号吗？`,async onOk(){var a;try{await ia.delete(`/api/admin/users/${e._id}`),b.success("该账号已删除"),U()}catch({response:l}){b.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}}})})(e),disabled:e.founder},{default:_((()=>l[18]||(l[18]=[K("删除")]))),_:2,__:[18]},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])])),_:1},8,["spinning"]),v(L,{class:"pagination",current:u.value,"onUpdate:current":l[1]||(l[1]=e=>u.value=e),"page-size":r.value,"onUpdate:pageSize":l[2]||(l[2]=e=>r.value=e),total:n.value,"show-size-changer":"",onChange:U},null,8,["current","page-size","total"]),v(F,{open:o.value,"onUpdate:open":l[7]||(l[7]=e=>o.value=e),title:"创建用户",onOk:q,onCancel:l[8]||(l[8]=e=>o.value=!1)},{default:_((()=>[v(E,{model:g.value,rules:k,layout:"vertical",ref_key:"createFormRef",ref:m},{default:_((()=>[v(O,{label:"用户名",name:"username"},{default:_((()=>[v(T,{value:g.value.username,"onUpdate:value":l[3]||(l[3]=e=>g.value.username=e),placeholder:"请输入用户名"},null,8,["value"])])),_:1}),v(O,{label:"邮箱",name:"email"},{default:_((()=>[v(T,{value:g.value.email,"onUpdate:value":l[4]||(l[4]=e=>g.value.email=e),placeholder:"请输入邮箱"},null,8,["value"])])),_:1}),v(O,{label:"密码",name:"password"},{default:_((()=>[v(H,{value:g.value.password,"onUpdate:value":l[5]||(l[5]=e=>g.value.password=e),placeholder:"请输入密码"},null,8,["value"])])),_:1}),v(O,{label:"权限",name:"role"},{default:_((()=>[v(R,{value:g.value.role,"onUpdate:value":l[6]||(l[6]=e=>g.value.role=e)},{default:_((()=>[v($,{value:"user"},{default:_((()=>l[19]||(l[19]=[K("用户")]))),_:1,__:[19]}),v($,{value:"admin"},{default:_((()=>l[20]||(l[20]=[K("管理员")]))),_:1,__:[20]})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"]),v(F,{open:f.value,"onUpdate:open":l[14]||(l[14]=e=>f.value=e),title:"编辑用户",onOk:S,onCancel:l[15]||(l[15]=e=>f.value=!1)},{default:_((()=>[v(E,{model:h.value,rules:w,layout:"vertical",ref_key:"editFormRef",ref:y},{default:_((()=>[v(O,{label:"用户名",name:"username"},{default:_((()=>[v(T,{value:h.value.username,"onUpdate:value":l[9]||(l[9]=e=>h.value.username=e),placeholder:"请输入用户名"},null,8,["value"])])),_:1}),v(O,{label:"邮箱",name:"email"},{default:_((()=>[v(T,{value:h.value.email,"onUpdate:value":l[10]||(l[10]=e=>h.value.email=e),placeholder:"请输入邮箱"},null,8,["value"])])),_:1}),v(O,{label:"权限",name:"role"},{default:_((()=>[v(R,{value:h.value.role,"onUpdate:value":l[11]||(l[11]=e=>h.value.role=e),disabled:h.value.founder},{default:_((()=>[v($,{value:"user"},{default:_((()=>l[21]||(l[21]=[K("用户")]))),_:1,__:[21]}),v($,{value:"admin"},{default:_((()=>l[22]||(l[22]=[K("管理员")]))),_:1,__:[22]})])),_:1},8,["value","disabled"])])),_:1}),v(O,{label:"状态",name:"status"},{default:_((()=>[v(R,{value:h.value.status,"onUpdate:value":l[12]||(l[12]=e=>h.value.status=e),disabled:h.value.founder},{default:_((()=>[v($,{value:"active"},{default:_((()=>l[23]||(l[23]=[K("正常")]))),_:1,__:[23]}),v($,{value:"disabled"},{default:_((()=>l[24]||(l[24]=[K("封号")]))),_:1,__:[24]})])),_:1},8,["value","disabled"])])),_:1}),v(O,{label:"新密码",name:"password"},{default:_((()=>[v(H,{value:h.value.password,"onUpdate:value":l[13]||(l[13]=e=>h.value.password=e),placeholder:"留空则不修改密码"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"])])}}},[["__scopeId","data-v-b2c635c2"]]),Ol={class:"images"},Hl={class:"header"},$l=oa({__name:"Images",setup(e){const a=ta(),t=l([]),u=l(!1),r=l(1),n=l(10),i=l(0),o=l(""),m=l(!1),g=l(null),y=l({_id:"",remarks:""}),h={remarks:[{max:500,message:"备注不能超过500个字符",trigger:"blur"}]},k=async()=>{var e;u.value=!0,t.value=[];try{const{data:e}=await ia.post("/api/admin/images",re.stringify({page:r.value,limit:n.value,searchQuery:o.value}));i.value=e.total,t.value.push(...e.images)}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{u.value=!1}},w=()=>{r.value=1,k()},U=async()=>{var e;try{await g.value.validate();const e=y.value._id;await ia.patch(`/api/admin/images/${e}`,{remarks:y.value.remarks}),b.success("图片数据更新成功"),m.value=!1,k()}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}};return d(k),(e,l)=>{const d=$e,I=fe,q=He,S=xe,C=B,P=Oe,A=Ae,M=Te,D=Re,L=J,T=Y,H=ke;return x(),s("div",Ol,[c("div",Hl,[v(d,{value:o.value,"onUpdate:value":l[0]||(l[0]=e=>o.value=e),placeholder:"搜索文件名/MD5/SHA-1/备注/IP",style:{width:"260px","margin-right":"10px"},onSearch:w,"allow-clear":""},null,8,["value"])]),v(A,{spinning:u.value},{default:_((()=>[v(P,{data:t.value,"scrollbar-always-on":!0,fit:""},{default:_((()=>{var e,t;return[v(q,{label:"预览",fixed:""},{default:_((({row:e})=>[v(I,{src:p(a).config.site.url+e.thumb,fallback:"local"===e.type?p(a).config.site.url+e.url:e.url,preview:{src:"local"==e.type?p(a).config.site.url+e.url:e.url}},null,8,["src","fallback","preview"])])),_:1}),v(q,{prop:"name",label:"文件名"}),v(q,{prop:"md5",label:"MD5"}),v(q,{prop:"sha1",label:"SHA-1"}),v(q,{sortable:"",label:"大小"},{default:_((({row:e})=>[K(z(p(Sa)(e.size)),1)])),_:1}),v(q,{prop:"album",label:"相册"},{default:_((({row:e})=>{var a;return[K(z((null==(a=e.album)?void 0:a.name)||"独立图片"),1)]})),_:1}),v(q,{prop:"remarks",label:"备注"},{default:_((({row:e})=>[K(z(e.remarks||"暂无备注"),1)])),_:1}),v(q,{label:"类型"},{default:_((({row:e})=>[K(z(p(Pa)[e.type]),1)])),_:1}),(null==(t=null==(e=p(a).config)?void 0:e.ai)?void 0:t.enabled)?(x(),s(O,{key:0},[v(q,{label:"健康状态"},{default:_((({row:e})=>{var a;return[v(S,{color:null==(a=p(Aa)[e.safe])?void 0:a.color},{default:_((()=>{var a;return[K(z(null==(a=p(Aa)[e.safe])?void 0:a.text),1)]})),_:2},1032,["color"])]})),_:1}),v(q,{label:"检测结果"},{default:_((({row:e})=>{var a,l;return[v(S,{color:p(Ka)[e.label]?null==(a=p(Ka)[e.label])?void 0:a.color:null==(l=p(Aa)[e.safe])?void 0:l.color},{default:_((()=>{var a;return[K(z(p(Ka)[e.label]?null==(a=p(Ka)[e.label])?void 0:a.text:e.label),1)]})),_:2},1032,["color"])]})),_:1})],64)):f("",!0),v(q,{label:"存储目录"},{default:_((({row:e})=>[K(z(e.filePath),1)])),_:1}),v(q,{label:"上传者"},{default:_((({row:e})=>[K(z(e.user?e.user.username:"游客"),1)])),_:1}),v(q,{prop:"ip",label:"IP地址"}),v(q,{sortable:"",label:"上传时间"},{default:_((({row:e})=>[K(z(p(qa)(e.date)),1)])),_:1}),v(q,{label:"操作",fixed:"right",width:"150"},{default:_((({row:e})=>[v(C,{type:"link",onClick:l=>p(Ca)(l,e,p(a))},{default:_((()=>l[6]||(l[6]=[K("复制")]))),_:2,__:[6]},1032,["onClick"]),v(C,{type:"link",onClick:a=>{return l=e,y.value={_id:l._id,remarks:l.remarks},m.value=!0,void(g.value&&g.value.resetFields());var l}},{default:_((()=>l[7]||(l[7]=[K("编辑")]))),_:2,__:[7]},1032,["onClick"]),v(C,{type:"link",danger:"",onClick:a=>{return l=e._id,void ke.confirm({title:"确认删除",content:"确定要删除这张图片吗？",async onOk(){var e;try{await ia.delete(`/api/admin/images/${l}`),b.success("删除成功"),k()}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}}});var l}},{default:_((()=>l[8]||(l[8]=[K("删除")]))),_:2,__:[8]},1032,["onClick"])])),_:1})]})),_:1},8,["data"])])),_:1},8,["spinning"]),v(M,{class:"pagination",current:r.value,"onUpdate:current":l[1]||(l[1]=e=>r.value=e),"page-size":n.value,"onUpdate:pageSize":l[2]||(l[2]=e=>n.value=e),total:i.value,"show-size-changer":"",onChange:k},null,8,["current","page-size","total"]),v(H,{open:m.value,"onUpdate:open":l[4]||(l[4]=e=>m.value=e),title:"编辑图片",onOk:U,onCancel:l[5]||(l[5]=e=>m.value=!1)},{default:_((()=>[v(T,{model:y.value,rules:h,layout:"vertical",ref_key:"editFormRef",ref:g},{default:_((()=>[v(L,{label:"备注",name:"remarks"},{default:_((()=>[v(D,{value:y.value.remarks,"onUpdate:value":l[3]||(l[3]=e=>y.value.remarks=e),placeholder:"添加图片备注",rows:4},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"])])}}},[["__scopeId","data-v-26192b05"]]),Rl={class:"config-container"},El=oa({__name:"Config",setup(e){const a=ta(),t=l(!1),u=l(!1),r=l([]),n=l(""),i=l("1"),m=Object.entries(Pa).filter((([e])=>"get"!==e)).map((([e,a])=>({value:e,label:a}))),y=l({site:{},upload:{},storage:{},watermark:{},ip:{},ai:{},oauth:{}}),h=[{label:"变量",prop:"variable"},{label:"说明",prop:"description"},{label:"示例",prop:"example"}],k=[{variable:"{Y}",description:"年份（4位）",example:"2024"},{variable:"{y}",description:"年份（2位）",example:"24"},{variable:"{m}",description:"月份",example:"03"},{variable:"{d}",description:"日期",example:"15"},{variable:"{Ymd}",description:"年月日",example:"20240315"},{variable:"{filename}",description:"原始文件名",example:"image"},{variable:"{ext}",description:"文件扩展名",example:"jpg"},{variable:"{time}",description:"时间戳",example:"1748695143942"},{variable:"{uniqid}",description:"唯一ID",example:"a1b2c3d4"},{variable:"{md5}",description:"文件MD5值",example:"d41d8cd98f00b204e9800998ecf8427e"},{variable:"{sha1}",description:"文件SHA1值",example:"da39a3ee5e6b4b0d3255bfef95601890afd80709"},{variable:"{uuid}",description:"UUID",example:"550e8400-e29b-41d4-a716-446655440000"},{variable:"{uid}",description:"用户ID（仅登录用户）",example:"123456"}],w=async e=>{try{const a=new FormData;a.append("image",e);const{data:l}=await ia.post("/api/admin/upload-watermark",a);return y.value.watermark.image.path=l.path,b.success("水印图片上传成功"),!1}catch(a){return b.error("水印图片上传失败"),!1}},U=e=>{const{ip:a}=y.value;a.blacklist=e.target.value.split("\n").map((e=>e.trim())).filter((e=>e))},I=async()=>{var e,l;u.value=!0;try{const{data:e}=await ia.put("/api/admin/config",y.value),{site:l,upload:t,ai:u,oauth:r}=y.value;a.config=JSON.parse(JSON.stringify({site:l,upload:t,ai:{enabled:u.enabled},oauth:{enabled:r.enabled,github:{enabled:r.github.enabled},google:{enabled:r.google.enabled},linuxdo:{enabled:r.linuxdo.enabled}}})),b.success(e.message)}catch(t){b.error(null==(l=null==(e=t.response)?void 0:e.data)?void 0:l.error)}finally{u.value=!1}};return o((()=>i.value),(e=>{a.activeKey=e||"1"})),d((()=>{i.value=a.activeKey||"1",(async()=>{t.value=!0;try{const{data:e}=await ia.post("/api/admin/config"),{ip:a}=e;y.value=e,n.value=a.blacklist.join("\n")}catch(e){b.error("获取配置失败")}finally{t.value=!1}})()})),(e,l)=>{const o=W,d=J,b=Ee,q=Ce,S=ze,C=we,P=X,A=Fe,M=Be,D=je,L=B,T=Ge,$=fe,R=Re,E=Ze,F=Ne,j=Ve,G=He,Z=Oe,V=Se,N=Y,Q=Ae;return x(),s("div",Rl,[v(Q,{spinning:t.value},{default:_((()=>[v(N,{model:y.value,layout:"vertical",onFinish:I},{default:_((()=>[v(V,{activeKey:i.value,"onUpdate:activeKey":l[153]||(l[153]=e=>i.value=e),accordion:"",bordered:!1,style:{background:"#f0f2f5"}},{default:_((()=>[v(q,{key:"1",header:"站点设置"},{default:_((()=>[v(d,{required:"",label:"网站标题"},{default:_((()=>[v(o,{value:y.value.site.title,"onUpdate:value":l[0]||(l[0]=e=>y.value.site.title=e)},null,8,["value"])])),_:1}),v(d,{required:"",label:"网站URL"},{default:_((()=>[v(o,{value:y.value.site.url,"onUpdate:value":l[1]||(l[1]=e=>y.value.site.url=e)},null,8,["value"])])),_:1}),v(d,{label:"是否开启验证码"},{default:_((()=>[v(b,{checked:y.value.site.captcha,"onUpdate:checked":l[2]||(l[2]=e=>y.value.site.captcha=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),v(d,{label:"是否开启API接口文档页面"},{default:_((()=>[v(b,{checked:y.value.site.api,"onUpdate:checked":l[3]||(l[3]=e=>y.value.site.api=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),v(d,{label:"是否开启图片广场页面"},{default:_((()=>[v(b,{checked:y.value.site.gallery,"onUpdate:checked":l[4]||(l[4]=e=>y.value.site.gallery=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),v(d,{label:"是否游客上传"},{default:_((()=>[v(b,{checked:y.value.site.anonymousUpload,"onUpdate:checked":l[5]||(l[5]=e=>y.value.site.anonymousUpload=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),v(d,{label:"是否开启注册"},{default:_((()=>[v(b,{checked:y.value.site.register,"onUpdate:checked":l[6]||(l[6]=e=>y.value.site.register=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),y.value.site.register?(x(),g(d,{key:0,label:"是否开启邀请码注册"},{default:_((()=>[v(b,{checked:y.value.site.inviteCodeRequired,"onUpdate:checked":l[7]||(l[7]=e=>y.value.site.inviteCodeRequired=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1})):f("",!0)])),_:1}),v(q,{key:"2",header:"SMTP设置"},{default:_((()=>[y.value.site.register?(x(),s(O,{key:0},[v(d,{label:"是否开启邮箱验证"},{default:_((()=>[v(b,{checked:y.value.smtp.enabled,"onUpdate:checked":l[8]||(l[8]=e=>y.value.smtp.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),y.value.smtp.enabled?(x(),s(O,{key:0},[v(d,{required:"",label:"发件人邮箱地址"},{default:_((()=>[v(o,{value:y.value.smtp.from,"onUpdate:value":l[9]||(l[9]=e=>y.value.smtp.from=e),placeholder:"输入发件人邮箱地址"},null,8,["value"])])),_:1}),v(d,{required:"",label:"发件人名称"},{default:_((()=>[v(o,{value:y.value.smtp.fromName,"onUpdate:value":l[10]||(l[10]=e=>y.value.smtp.fromName=e),placeholder:"输入发件人名称"},null,8,["value"])])),_:1}),v(d,{required:"",label:"SMTP 服务器地址"},{default:_((()=>[v(o,{value:y.value.smtp.host,"onUpdate:value":l[11]||(l[11]=e=>y.value.smtp.host=e),placeholder:"输入 SMTP 服务器地址，例如：smtp.qiye.aliyun.com"},null,8,["value"])])),_:1}),v(d,{required:"",label:"SMTP 服务器端口"},{default:_((()=>[v(o,{value:y.value.smtp.port,"onUpdate:value":l[12]||(l[12]=e=>y.value.smtp.port=e),placeholder:"输入 SMTP 服务器端口，例如：465"},null,8,["value"])])),_:1}),v(d,{required:"",label:"SMTP 加密方式"},{default:_((()=>[v(C,{value:y.value.smtp.secure,"onUpdate:value":l[13]||(l[13]=e=>y.value.smtp.secure=e)},{default:_((()=>[v(S,{value:"none"},{default:_((()=>l[154]||(l[154]=[K("无")]))),_:1,__:[154]}),v(S,{value:"ssl"},{default:_((()=>l[155]||(l[155]=[K("SSL")]))),_:1,__:[155]}),v(S,{value:"tls"},{default:_((()=>l[156]||(l[156]=[K("TLS")]))),_:1,__:[156]})])),_:1},8,["value"])])),_:1}),v(d,{required:"",label:"SMTP 用户名"},{default:_((()=>[v(o,{value:y.value.smtp.username,"onUpdate:value":l[14]||(l[14]=e=>y.value.smtp.username=e),placeholder:"输入 SMTP 用户名"},null,8,["value"])])),_:1}),v(d,{required:"",label:"SMTP 密码"},{default:_((()=>[v(P,{value:y.value.smtp.password,"onUpdate:value":l[15]||(l[15]=e=>y.value.smtp.password=e),placeholder:"输入 SMTP 密码"},null,8,["value"])])),_:1})],64)):f("",!0)],64)):f("",!0)])),_:1}),v(q,{key:"3",header:"水印设置"},{default:_((()=>[v(d,null,{default:_((()=>[v(b,{checked:y.value.watermark.enabled,"onUpdate:checked":l[16]||(l[16]=e=>y.value.watermark.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),y.value.watermark.enabled?(x(),s(O,{key:0},[v(d,{label:"水印类型"},{default:_((()=>[v(M,{value:y.value.watermark.type,"onUpdate:value":l[17]||(l[17]=e=>y.value.watermark.type=e)},{default:_((()=>[v(A,{value:"text"},{default:_((()=>l[157]||(l[157]=[K("文字水印")]))),_:1,__:[157]}),v(A,{value:"image"},{default:_((()=>l[158]||(l[158]=[K("图片水印")]))),_:1,__:[158]})])),_:1},8,["value"])])),_:1}),"text"===y.value.watermark.type?(x(),s(O,{key:0},[v(d,{label:"水印文字"},{default:_((()=>[v(o,{value:y.value.watermark.text.content,"onUpdate:value":l[18]||(l[18]=e=>y.value.watermark.text.content=e)},null,8,["value"])])),_:1}),v(d,{label:"字体大小"},{default:_((()=>[v(D,{value:y.value.watermark.text.fontSize,"onUpdate:value":l[19]||(l[19]=e=>y.value.watermark.text.fontSize=e),min:12,max:72},null,8,["value"])])),_:1}),v(d,{label:"字体颜色"},{default:_((()=>[v(o,{value:y.value.watermark.text.color,"onUpdate:value":l[20]||(l[20]=e=>y.value.watermark.text.color=e),type:"color"},null,8,["value"])])),_:1})],64)):(x(),s(O,{key:1},[v(d,{label:"上传水印"},{default:_((()=>[v(T,{fileList:r.value,"onUpdate:fileList":l[21]||(l[21]=e=>r.value=e),beforeUpload:w,showUploadList:!1},{default:_((()=>[v(L,null,{default:_((()=>l[159]||(l[159]=[K("选择水印图片")]))),_:1,__:[159]})])),_:1},8,["fileList"])])),_:1}),v(d,{label:"水印管理"},{default:_((()=>[v(L,null,{default:_((()=>l[160]||(l[160]=[K("删除水印图片")]))),_:1,__:[160]})])),_:1}),y.value.watermark.image.path?(x(),g(d,{key:0,label:"水印图片"},{default:_((()=>[v($,{src:p(a).config.site.url+y.value.watermark.image.path},null,8,["src"])])),_:1})):f("",!0),y.value.watermark.image.path?(x(),g(d,{key:1,label:"水印图片URL"},{default:_((()=>[v(R,{value:y.value.watermark.image.path,"onUpdate:value":l[22]||(l[22]=e=>y.value.watermark.image.path=e),"auto-size":"",disabled:""},null,8,["value"])])),_:1})):f("",!0),v(d,{label:"透明度"},{default:_((()=>[v(E,{value:y.value.watermark.image.opacity,"onUpdate:value":l[23]||(l[23]=e=>y.value.watermark.image.opacity=e),min:0,max:1,step:.1},null,8,["value"])])),_:1})],64)),v(d,{label:"水印位置"},{default:_((()=>[v(C,{value:y.value.watermark[y.value.watermark.type].position,"onUpdate:value":l[24]||(l[24]=e=>y.value.watermark[y.value.watermark.type].position=e)},{default:_((()=>[v(S,{value:"top-left"},{default:_((()=>l[161]||(l[161]=[K("左上")]))),_:1,__:[161]}),v(S,{value:"top-right"},{default:_((()=>l[162]||(l[162]=[K("右上")]))),_:1,__:[162]}),v(S,{value:"bottom-left"},{default:_((()=>l[163]||(l[163]=[K("左下")]))),_:1,__:[163]}),v(S,{value:"bottom-right"},{default:_((()=>l[164]||(l[164]=[K("右下")]))),_:1,__:[164]}),v(S,{value:"center"},{default:_((()=>l[165]||(l[165]=[K("居中")]))),_:1,__:[165]})])),_:1},8,["value"])])),_:1})],64)):f("",!0)])),_:1}),v(q,{key:"4",header:"存储设置"},{default:_((()=>[v(d,{label:"存储类型"},{default:_((()=>[v(C,{value:y.value.storage.type,"onUpdate:value":l[25]||(l[25]=e=>y.value.storage.type=e)},{default:_((()=>[(x(!0),s(O,null,H(p(m),((e,a)=>(x(),g(S,{value:e.value,key:a},{default:_((()=>[K(z(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),"local"===y.value.storage.type?(x(),g(d,{key:0,required:"",label:"储存目录"},{default:_((()=>[v(o,{value:y.value.storage.local.path,"onUpdate:value":l[26]||(l[26]=e=>y.value.storage.local.path=e),placeholder:"输入储存目录"},null,8,["value"])])),_:1})):f("",!0),"oss"===y.value.storage.type?(x(),s(O,{key:1},[v(d,{required:"",label:"AccessKey ID"},{default:_((()=>[v(o,{value:y.value.storage.oss.accessKeyId,"onUpdate:value":l[27]||(l[27]=e=>y.value.storage.oss.accessKeyId=e),placeholder:"输入 AccessKeyId"},null,8,["value"])])),_:1}),v(d,{required:"",label:"AccessKey Secret"},{default:_((()=>[v(P,{value:y.value.storage.oss.accessKeySecret,"onUpdate:value":l[28]||(l[28]=e=>y.value.storage.oss.accessKeySecret=e),placeholder:"输入 AccessKeySecret"},null,8,["value"])])),_:1}),v(d,{required:"",label:"OSS Bucket"},{default:_((()=>[v(o,{value:y.value.storage.oss.bucket,"onUpdate:value":l[29]||(l[29]=e=>y.value.storage.oss.bucket=e)},null,8,["value"])])),_:1}),v(d,{label:"储存目录"},{default:_((()=>[v(o,{value:y.value.storage.oss.path,"onUpdate:value":l[30]||(l[30]=e=>y.value.storage.oss.path=e),placeholder:"输入储存目录"},null,8,["value"])])),_:1}),v(d,{label:"OSS Region"},{default:_((()=>[v(o,{value:y.value.storage.oss.region,"onUpdate:value":l[31]||(l[31]=e=>y.value.storage.oss.region=e),placeholder:"输入 Region，例如：cn-shanghai"},null,8,["value"])])),_:1}),v(d,{required:"",label:"外网 Endpoint"},{default:_((()=>[v(o,{value:y.value.storage.oss.endpoint,"onUpdate:value":l[32]||(l[32]=e=>y.value.storage.oss.endpoint=e),placeholder:"输入 Endpoint，例如：oss-cn-shanghai.aliyuncs.com"},null,8,["value"])])),_:1}),v(d,{label:"内网 Endpoint"},{default:_((()=>[v(o,{value:y.value.storage.oss.internal,"onUpdate:value":l[33]||(l[33]=e=>y.value.storage.oss.internal=e),placeholder:"输入内网 Endpoint，内网上传地址，填写即启用，例如：oss-cn-shanghai-internal.aliyuncs.com"},null,8,["value"])])),_:1}),v(d,{label:"Is Cname"},{default:_((()=>[v(b,{checked:y.value.storage.oss.isCname,"onUpdate:checked":l[34]||(l[34]=e=>y.value.storage.oss.isCname=e),"checked-children":"是","un-checked-children":"否"},null,8,["checked"]),l[166]||(l[166]=c("p",null,"若 Endpoint 为自定义域名，请打开此项。",-1))])),_:1,__:[166]})],64)):f("",!0),"cos"===y.value.storage.type?(x(),s(O,{key:2},[v(d,{required:"",label:"Secret Id"},{default:_((()=>[v(o,{value:y.value.storage.cos.secretId,"onUpdate:value":l[35]||(l[35]=e=>y.value.storage.cos.secretId=e),placeholder:"输入 Secret Id"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Secret Key"},{default:_((()=>[v(P,{value:y.value.storage.cos.secretKey,"onUpdate:value":l[36]||(l[36]=e=>y.value.storage.cos.secretKey=e),placeholder:"输入 Secret Key"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Bucket"},{default:_((()=>[v(o,{value:y.value.storage.cos.bucket,"onUpdate:value":l[37]||(l[37]=e=>y.value.storage.cos.bucket=e),placeholder:"输入 Bucket"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Region"},{default:_((()=>[v(o,{value:y.value.storage.cos.region,"onUpdate:value":l[38]||(l[38]=e=>y.value.storage.cos.region=e),placeholder:"输入 Region，例如：ap-guangzhou"},null,8,["value"])])),_:1}),v(d,{required:"",label:"储存目录"},{default:_((()=>[v(o,{value:y.value.storage.cos.filePath,"onUpdate:value":l[39]||(l[39]=e=>y.value.storage.cos.filePath=e),placeholder:"输入储存目录"},null,8,["value"])])),_:1})],64)):f("",!0),"s3"===y.value.storage.type?(x(),s(O,{key:3},[v(d,{required:"",label:"储存目录"},{default:_((()=>[v(o,{value:y.value.storage.s3.directory,"onUpdate:value":l[40]||(l[40]=e=>y.value.storage.s3.directory=e),placeholder:"输入储存目录"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Endpoint"},{default:_((()=>[v(o,{value:y.value.storage.s3.endpoint,"onUpdate:value":l[41]||(l[41]=e=>y.value.storage.s3.endpoint=e),placeholder:"输入 Endpoint，例如：https://s3.amazonaws.com"},null,8,["value"])])),_:1}),v(d,{required:"",label:"AccessKeyId"},{default:_((()=>[v(o,{value:y.value.storage.s3.accessKeyId,"onUpdate:value":l[42]||(l[42]=e=>y.value.storage.s3.accessKeyId=e),placeholder:"输入 AccessKeyId"},null,8,["value"])])),_:1}),v(d,{required:"",label:"SecretAccessKey"},{default:_((()=>[v(P,{value:y.value.storage.s3.secretAccessKey,"onUpdate:value":l[43]||(l[43]=e=>y.value.storage.s3.secretAccessKey=e),placeholder:"输入 SecretAccessKey"},null,8,["value"])])),_:1}),v(d,{label:"Region"},{default:_((()=>[v(o,{value:y.value.storage.s3.region,"onUpdate:value":l[44]||(l[44]=e=>y.value.storage.s3.region=e),placeholder:"输入 Region，例如：us-east-1"},null,8,["value"])])),_:1}),v(d,{label:"Bucket"},{default:_((()=>[v(o,{value:y.value.storage.s3.bucket,"onUpdate:value":l[45]||(l[45]=e=>y.value.storage.s3.bucket=e),placeholder:"输入 Bucket"},null,8,["value"])])),_:1})],64)):f("",!0),"r2"===y.value.storage.type?(x(),s(O,{key:4},[v(d,{required:"",label:"储存目录"},{default:_((()=>[v(o,{value:y.value.storage.r2.directory,"onUpdate:value":l[46]||(l[46]=e=>y.value.storage.r2.directory=e),placeholder:"输入储存目录"},null,8,["value"])])),_:1}),v(d,{required:"",label:"AccountId"},{default:_((()=>[v(o,{value:y.value.storage.r2.accountId,"onUpdate:value":l[47]||(l[47]=e=>y.value.storage.r2.accountId=e),placeholder:"输入 AccountId"},null,8,["value"])])),_:1}),v(d,{required:"",label:"AccessKeyId"},{default:_((()=>[v(o,{value:y.value.storage.r2.accessKeyId,"onUpdate:value":l[48]||(l[48]=e=>y.value.storage.r2.accessKeyId=e),placeholder:"输入 AccessKeyId"},null,8,["value"])])),_:1}),v(d,{required:"",label:"SecretAccessKey"},{default:_((()=>[v(P,{value:y.value.storage.r2.secretAccessKey,"onUpdate:value":l[49]||(l[49]=e=>y.value.storage.r2.secretAccessKey=e),placeholder:"输入 SecretAccessKey"},null,8,["value"])])),_:1}),v(d,{required:"",label:"公共URL"},{default:_((()=>[v(o,{value:y.value.storage.r2.publicUrl,"onUpdate:value":l[50]||(l[50]=e=>y.value.storage.r2.publicUrl=e),placeholder:"输入 公共URL"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Bucket"},{default:_((()=>[v(o,{value:y.value.storage.r2.bucket,"onUpdate:value":l[51]||(l[51]=e=>y.value.storage.r2.bucket=e),placeholder:"输入 Bucket"},null,8,["value"])])),_:1})],64)):f("",!0),"qiniu"===y.value.storage.type?(x(),s(O,{key:5},[v(d,{required:"",label:"Access Key"},{default:_((()=>[v(o,{value:y.value.storage.qiniu.accessKey,"onUpdate:value":l[52]||(l[52]=e=>y.value.storage.qiniu.accessKey=e),placeholder:"输入 Access Key"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Secret Key"},{default:_((()=>[v(P,{value:y.value.storage.qiniu.secretKey,"onUpdate:value":l[53]||(l[53]=e=>y.value.storage.qiniu.secretKey=e),placeholder:"输入 Secret Key"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Bucket"},{default:_((()=>[v(o,{value:y.value.storage.qiniu.bucket,"onUpdate:value":l[54]||(l[54]=e=>y.value.storage.qiniu.bucket=e),placeholder:"输入 Bucket"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Bucket 域名"},{default:_((()=>[v(o,{value:y.value.storage.qiniu.domain,"onUpdate:value":l[55]||(l[55]=e=>y.value.storage.qiniu.domain=e),placeholder:"输入 Bucket 域名"},null,8,["value"])])),_:1})],64)):f("",!0),"upyun"===y.value.storage.type?(x(),s(O,{key:6},[v(d,{required:"",label:"又拍云服务名"},{default:_((()=>[v(o,{value:y.value.storage.upyun.service,"onUpdate:value":l[56]||(l[56]=e=>y.value.storage.upyun.service=e),placeholder:"输入服务名"},null,8,["value"])])),_:1}),v(d,{required:"",label:"又拍云操作员"},{default:_((()=>[v(o,{value:y.value.storage.upyun.operator,"onUpdate:value":l[57]||(l[57]=e=>y.value.storage.upyun.operator=e),placeholder:"输入操作员"},null,8,["value"])])),_:1}),v(d,{required:"",label:"又拍云密码"},{default:_((()=>[v(P,{value:y.value.storage.upyun.password,"onUpdate:value":l[58]||(l[58]=e=>y.value.storage.upyun.password=e),placeholder:"输入密码"},null,8,["value"])])),_:1}),v(d,{required:"",label:"存储目录"},{default:_((()=>[v(o,{value:y.value.storage.upyun.directory,"onUpdate:value":l[59]||(l[59]=e=>y.value.storage.upyun.directory=e),placeholder:"输入储存目录"},null,8,["value"])])),_:1}),v(d,{required:"",label:"访问域名"},{default:_((()=>[v(o,{value:y.value.storage.upyun.domain,"onUpdate:value":l[60]||(l[60]=e=>y.value.storage.upyun.domain=e),placeholder:"输入访问域名, 例如: https://domain.com"},null,8,["value"])])),_:1})],64)):f("",!0),"sftp"===y.value.storage.type?(x(),s(O,{key:7},[v(d,{required:"",label:"主机地址",placeholder:"输入主机地址"},{default:_((()=>[v(o,{value:y.value.storage.sftp.host,"onUpdate:value":l[61]||(l[61]=e=>y.value.storage.sftp.host=e)},null,8,["value"])])),_:1}),v(d,{required:"",label:"端口"},{default:_((()=>[v(o,{value:y.value.storage.sftp.port,"onUpdate:value":l[62]||(l[62]=e=>y.value.storage.sftp.port=e),placeholder:"输入端口，默认为 22"},null,8,["value"])])),_:1}),v(d,{required:"",label:"用户名"},{default:_((()=>[v(o,{value:y.value.storage.sftp.username,"onUpdate:value":l[63]||(l[63]=e=>y.value.storage.sftp.username=e),placeholder:"输入用户名"},null,8,["value"])])),_:1}),v(d,{required:"",label:"密码"},{default:_((()=>[v(P,{value:y.value.storage.sftp.password,"onUpdate:value":l[64]||(l[64]=e=>y.value.storage.sftp.password=e),placeholder:"输入密码"},null,8,["value"])])),_:1}),v(d,{required:"",label:"储存目录"},{default:_((()=>[v(o,{value:y.value.storage.sftp.directory,"onUpdate:value":l[65]||(l[65]=e=>y.value.storage.sftp.directory=e),placeholder:"输入储存目录"},null,8,["value"])])),_:1}),v(d,{required:"",label:"连接超时时间"},{default:_((()=>[v(o,{value:y.value.storage.sftp.connectTimeout,"onUpdate:value":l[66]||(l[66]=e=>y.value.storage.sftp.connectTimeout=e),placeholder:"输入连接超时时间，默认为 10 秒"},null,8,["value"])])),_:1}),v(d,{required:"",label:"连接最大尝试次数"},{default:_((()=>[v(o,{value:y.value.storage.sftp.retries,"onUpdate:value":l[67]||(l[67]=e=>y.value.storage.sftp.retries=e),placeholder:"输入连接最大尝试次数，默认为 4 次"},null,8,["value"])])),_:1}),v(d,{required:"",label:"访问域名"},{default:_((()=>[v(o,{value:y.value.storage.sftp.domain,"onUpdate:value":l[68]||(l[68]=e=>y.value.storage.sftp.domain=e),placeholder:"输入访问域名, 例如: https://domain.com"},null,8,["value"])])),_:1}),v(d,{label:"主机指纹"},{default:_((()=>[v(P,{value:y.value.storage.sftp.hostFingerprint,"onUpdate:value":l[69]||(l[69]=e=>y.value.storage.sftp.hostFingerprint=e),placeholder:"输入主机指纹"},null,8,["value"])])),_:1}),v(d,{label:"使用 SSH 代理"},{default:_((()=>[v(b,{checked:y.value.storage.sftp.useSSH,"onUpdate:checked":l[70]||(l[70]=e=>y.value.storage.sftp.useSSH=e)},null,8,["checked"])])),_:1}),y.value.storage.sftp.useSSH?(x(),s(O,{key:0},[v(d,{label:"私钥"},{default:_((()=>[v(R,{value:y.value.storage.sftp.privateKey,"onUpdate:value":l[71]||(l[71]=e=>y.value.storage.sftp.privateKey=e),placeholder:"使用私钥连接请输入私钥","auto-size":{minRows:2,maxRows:5}},null,8,["value"])])),_:1}),v(d,{label:"私钥口令"},{default:_((()=>[v(P,{value:y.value.storage.sftp.passphrase,"onUpdate:value":l[72]||(l[72]=e=>y.value.storage.sftp.passphrase=e),placeholder:"使用私钥连接请输入私钥口令"},null,8,["value"])])),_:1})],64)):f("",!0)],64)):f("",!0),"ftp"===y.value.storage.type?(x(),s(O,{key:8},[v(d,{required:"",label:"储存目录"},{default:_((()=>[v(o,{value:y.value.storage.ftp.directory,"onUpdate:value":l[73]||(l[73]=e=>y.value.storage.ftp.directory=e),placeholder:"输入储存目录"},null,8,["value"])])),_:1}),v(d,{required:"",label:"主机地址"},{default:_((()=>[v(o,{value:y.value.storage.ftp.host,"onUpdate:value":l[74]||(l[74]=e=>y.value.storage.ftp.host=e),placeholder:"输入主机地址"},null,8,["value"])])),_:1}),v(d,{required:"",label:"用户名"},{default:_((()=>[v(o,{value:y.value.storage.ftp.username,"onUpdate:value":l[75]||(l[75]=e=>y.value.storage.ftp.username=e),placeholder:"输入用户名"},null,8,["value"])])),_:1}),v(d,{required:"",label:"密码"},{default:_((()=>[v(P,{value:y.value.storage.ftp.password,"onUpdate:value":l[76]||(l[76]=e=>y.value.storage.ftp.password=e),placeholder:"输入密码"},null,8,["value"])])),_:1}),v(d,{required:"",label:"端口"},{default:_((()=>[v(o,{value:y.value.storage.ftp.port,"onUpdate:value":l[77]||(l[77]=e=>y.value.storage.ftp.port=e),placeholder:"输入端口，默认为 21"},null,8,["value"])])),_:1}),v(d,{required:"",label:"传输模式"},{default:_((()=>[v(C,{value:y.value.storage.ftp.transferMode,"onUpdate:value":l[78]||(l[78]=e=>y.value.storage.ftp.transferMode=e)},{default:_((()=>[v(S,{value:"binary"},{default:_((()=>l[167]||(l[167]=[K("FTP_BINARY")]))),_:1,__:[167]}),v(S,{value:"ascii"},{default:_((()=>l[168]||(l[168]=[K("FTP_ASCII")]))),_:1,__:[168]})])),_:1},8,["value"]),l[169]||(l[169]=c("p",null,"请选择传输模式，默认为 FTP_BINARY",-1))])),_:1,__:[169]}),v(d,{required:"",label:"连接超时时间"},{default:_((()=>[v(o,{value:y.value.storage.ftp.connectTimeout,"onUpdate:value":l[79]||(l[79]=e=>y.value.storage.ftp.connectTimeout=e),placeholder:"输入连接超时时间，默认为 90 秒"},null,8,["value"])])),_:1}),v(d,{required:"",label:"访问域名"},{default:_((()=>[v(o,{value:y.value.storage.ftp.domain,"onUpdate:value":l[80]||(l[80]=e=>y.value.storage.ftp.domain=e),placeholder:"输入访问域名, 例如: https://domain.com"},null,8,["value"])])),_:1}),v(d,{label:"是否使用被动模式"},{default:_((()=>[v(b,{checked:y.value.storage.ftp.passive,"onUpdate:checked":l[81]||(l[81]=e=>y.value.storage.ftp.passive=e)},null,8,["checked"])])),_:1}),v(d,{label:"是否使用 SSL 连接"},{default:_((()=>[v(b,{checked:y.value.storage.ftp.secure,"onUpdate:checked":l[82]||(l[82]=e=>y.value.storage.ftp.secure=e)},null,8,["checked"])])),_:1}),v(d,{label:"是否忽略被动模式下的远程 IP 地址"},{default:_((()=>[v(b,{checked:y.value.storage.ftp.ignorePassiveIP,"onUpdate:checked":l[83]||(l[83]=e=>y.value.storage.ftp.ignorePassiveIP=e)},null,8,["checked"])])),_:1}),v(d,{label:"是否启用 Unix 时间戳"},{default:_((()=>[v(b,{checked:y.value.storage.ftp.useUnixTimestamp,"onUpdate:checked":l[84]||(l[84]=e=>y.value.storage.ftp.useUnixTimestamp=e)},null,8,["checked"])])),_:1}),v(d,{label:"是否启用 UTF-8 编码"},{default:_((()=>[v(b,{checked:y.value.storage.ftp.useUTF8,"onUpdate:checked":l[85]||(l[85]=e=>y.value.storage.ftp.useUTF8=e)},null,8,["checked"])])),_:1}),v(d,{label:"是否手动递归"},{default:_((()=>[v(b,{checked:y.value.storage.ftp.recursive,"onUpdate:checked":l[86]||(l[86]=e=>y.value.storage.ftp.recursive=e)},null,8,["checked"])])),_:1})],64)):f("",!0),"webdav"===y.value.storage.type?(x(),s(O,{key:9},[v(d,{label:"储存目录"},{default:_((()=>[v(o,{value:y.value.storage.webdav.directory,"onUpdate:value":l[87]||(l[87]=e=>y.value.storage.webdav.directory=e)},null,8,["value"])])),_:1}),v(d,{required:"",label:"连接地址"},{default:_((()=>[v(o,{value:y.value.storage.webdav.url,"onUpdate:value":l[88]||(l[88]=e=>y.value.storage.webdav.url=e),placeholder:"输入连接地址"},null,8,["value"])])),_:1}),v(d,{required:"",label:"认证方式"},{default:_((()=>[v(C,{value:y.value.storage.webdav.authType,"onUpdate:value":l[89]||(l[89]=e=>y.value.storage.webdav.authType=e)},{default:_((()=>[v(S,{value:"auto"},{default:_((()=>l[170]||(l[170]=[K("Auto")]))),_:1,__:[170]}),v(S,{value:"basic"},{default:_((()=>l[171]||(l[171]=[K("Basic")]))),_:1,__:[171]}),v(S,{value:"digest"},{default:_((()=>l[172]||(l[172]=[K("Digest")]))),_:1,__:[172]}),v(S,{value:"ntlm"},{default:_((()=>l[173]||(l[173]=[K("Ntlm")]))),_:1,__:[173]})])),_:1},8,["value"]),l[174]||(l[174]=c("p",null,"请选择认证方式，默认 Auto",-1))])),_:1,__:[174]}),v(d,{required:"",label:"用户名"},{default:_((()=>[v(o,{value:y.value.storage.webdav.username,"onUpdate:value":l[90]||(l[90]=e=>y.value.storage.webdav.username=e),placeholder:"输入用户名"},null,8,["value"])])),_:1}),v(d,{required:"",label:"密码"},{default:_((()=>[v(P,{value:y.value.storage.webdav.password,"onUpdate:value":l[91]||(l[91]=e=>y.value.storage.webdav.password=e),placeholder:"输入密码"},null,8,["value"])])),_:1}),v(d,{required:"",label:"访问域名"},{default:_((()=>[v(o,{value:y.value.storage.webdav.domain,"onUpdate:value":l[92]||(l[92]=e=>y.value.storage.webdav.domain=e),placeholder:"输入访问域名, 例如: https://domain.com"},null,8,["value"])])),_:1})],64)):f("",!0),"telegram"===y.value.storage.type?(x(),s(O,{key:10},[v(d,{required:"",label:"BotToken"},{default:_((()=>[v(P,{value:y.value.storage.telegram.botToken,"onUpdate:value":l[93]||(l[93]=e=>y.value.storage.telegram.botToken=e),placeholder:"输入 BotToken"},null,8,["value"])])),_:1}),v(d,{required:"",label:"聊天ID"},{default:_((()=>[v(o,{value:y.value.storage.telegram.chatId,"onUpdate:value":l[94]||(l[94]=e=>y.value.storage.telegram.chatId=e),placeholder:"输入聊天ID"},null,8,["value"])])),_:1}),v(d,{label:"禁用轮询"},{default:_((()=>[v(b,{checked:y.value.storage.telegram.polling,"onUpdate:checked":l[95]||(l[95]=e=>y.value.storage.telegram.polling=e)},null,8,["checked"])])),_:1}),v(d,{label:"连接超时时间"},{default:_((()=>[v(o,{value:y.value.storage.telegram.timeout,"onUpdate:value":l[96]||(l[96]=e=>y.value.storage.telegram.timeout=e),placeholder:"输入连接超时时间，默认为 30 秒"},null,8,["value"])])),_:1}),v(d,{label:"代理地址"},{default:_((()=>[v(o,{value:y.value.storage.telegram.proxy,"onUpdate:value":l[97]||(l[97]=e=>y.value.storage.telegram.proxy=e),placeholder:"输入代理地址"},null,8,["value"])])),_:1})],64)):f("",!0),"github"===y.value.storage.type?(x(),s(O,{key:11},[v(d,{required:"",label:"GitHub 个人访问令牌"},{default:_((()=>[v(P,{value:y.value.storage.github.token,"onUpdate:value":l[98]||(l[98]=e=>y.value.storage.github.token=e),placeholder:"输入 GitHub 个人访问令牌"},null,8,["value"])])),_:1}),v(d,{required:"",label:"仓库所有者"},{default:_((()=>[v(o,{value:y.value.storage.github.owner,"onUpdate:value":l[99]||(l[99]=e=>y.value.storage.github.owner=e),placeholder:"输入仓库所有者"},null,8,["value"])])),_:1}),v(d,{required:"",label:"仓库名称"},{default:_((()=>[v(o,{value:y.value.storage.github.repo,"onUpdate:value":l[100]||(l[100]=e=>y.value.storage.github.repo=e),placeholder:"输入仓库名称"},null,8,["value"])])),_:1}),v(d,{required:"",label:"分支名称"},{default:_((()=>[v(o,{value:y.value.storage.github.branch,"onUpdate:value":l[101]||(l[101]=e=>y.value.storage.github.branch=e),placeholder:"输入分支名称"},null,8,["value"])])),_:1}),v(d,{required:"",label:"存储目录"},{default:_((()=>[v(o,{value:y.value.storage.github.directory,"onUpdate:value":l[102]||(l[102]=e=>y.value.storage.github.directory=e),placeholder:"输入存储目录"},null,8,["value"]),l[175]||(l[175]=c("p",null,'Github不允许文件路径以斜杠"/"开头',-1))])),_:1,__:[175]}),v(d,{required:"",label:"连接超时时间"},{default:_((()=>[v(o,{value:y.value.storage.github.timeout,"onUpdate:value":l[103]||(l[103]=e=>y.value.storage.github.timeout=e),placeholder:"输入连接超时时间，默认为 30 秒"},null,8,["value"])])),_:1}),v(d,{required:"",label:"重试次数"},{default:_((()=>[v(o,{value:y.value.storage.github.retries,"onUpdate:value":l[104]||(l[104]=e=>y.value.storage.github.retries=e),placeholder:"输入重试次数，默认为 3 次"},null,8,["value"])])),_:1}),v(d,{required:"",label:"重试间隔时间"},{default:_((()=>[v(o,{value:y.value.storage.github.retryAfter,"onUpdate:value":l[105]||(l[105]=e=>y.value.storage.github.retryAfter=e),placeholder:"输入重试次数，默认为 5 秒"},null,8,["value"])])),_:1}),v(d,{label:"开启自定义域名"},{default:_((()=>[v(b,{checked:y.value.storage.github.customDomain,"onUpdate:checked":l[106]||(l[106]=e=>y.value.storage.github.customDomain=e)},null,8,["checked"]),l[176]||(l[176]=c("p",null,"开启自定义域名后, 图片可访问状态以Github Pages build状态为准",-1))])),_:1,__:[176]}),y.value.storage.github.customDomain?(x(),g(d,{key:0,label:"是否Github Pages"},{default:_((()=>[v(b,{checked:y.value.storage.github.isGithubPages,"onUpdate:checked":l[107]||(l[107]=e=>y.value.storage.github.isGithubPages=e)},null,8,["checked"])])),_:1})):f("",!0),y.value.storage.github.customDomain&&!y.value.storage.github.isGithubPages?(x(),g(d,{key:1,required:"",label:"自定义域名"},{default:_((()=>[v(o,{value:y.value.storage.github.domain,"onUpdate:value":l[108]||(l[108]=e=>y.value.storage.github.domain=e),placeholder:"输入自定义域名, 例如: https://domain.com"},null,8,["value"])])),_:1})):f("",!0),y.value.storage.github.customDomain&&y.value.storage.github.isGithubPages?(x(),g(d,{key:2,required:"",label:"Github Pages"},{default:_((()=>[v(o,{value:y.value.storage.github.githubPages,"onUpdate:value":l[109]||(l[109]=e=>y.value.storage.github.githubPages=e),placeholder:"输入Github Pages, 例如: https://user.github.io"},null,8,["value"])])),_:1})):f("",!0)],64)):f("",!0)])),_:1}),v(q,{key:"5",header:"鉴黄设置"},{default:_((()=>[v(d,{label:"鉴黄开关"},{default:_((()=>[v(b,{checked:y.value.ai.enabled,"onUpdate:checked":l[110]||(l[110]=e=>y.value.ai.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"]),l[177]||(l[177]=c("p",null,"设置上传是否需要应用第三方审查，违规的图片会被标记为不健康的图片，或直接被删除。",-1))])),_:1,__:[177]}),v(d,{label:"自动拉黑"},{default:_((()=>[v(b,{checked:y.value.ai.autoBlack,"onUpdate:checked":l[111]||(l[111]=e=>y.value.ai.autoBlack=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"]),l[178]||(l[178]=c("p",null,"该功能需要同步弃用IP设置里的黑名单开关。设置之后用户如果上传违规图片，会被自动列入IP黑名单",-1))])),_:1,__:[178]}),y.value.ai.enabled?(x(),s(O,{key:0},[v(d,{label:"图片处理"},{default:_((()=>[v(M,{value:y.value.ai.action,"onUpdate:value":l[112]||(l[112]=e=>y.value.ai.action=e)},{default:_((()=>[v(A,{value:"reject"},{default:_((()=>l[179]||(l[179]=[K("标记为不健康")]))),_:1,__:[179]}),v(A,{value:"mark"},{default:_((()=>l[180]||(l[180]=[K("直接删除")]))),_:1,__:[180]})])),_:1},8,["value"])])),_:1}),v(d,{label:"图片审核"},{default:_((()=>[v(C,{value:y.value.ai.type,"onUpdate:value":l[113]||(l[113]=e=>y.value.ai.type=e)},{default:_((()=>[v(S,{value:"tencent"},{default:_((()=>l[181]||(l[181]=[K("腾讯云")]))),_:1,__:[181]}),v(S,{value:"aliyun"},{default:_((()=>l[182]||(l[182]=[K("阿里云")]))),_:1,__:[182]}),v(S,{value:"nsfwjs"},{default:_((()=>l[183]||(l[183]=[K("NsfwJs")]))),_:1,__:[183]})])),_:1},8,["value"])])),_:1}),"tencent"===y.value.ai.type?(x(),s(O,{key:0},[v(d,{required:"",label:"Endpoint"},{default:_((()=>[v(o,{value:y.value.ai.tencent.endpoint,"onUpdate:value":l[114]||(l[114]=e=>y.value.ai.tencent.endpoint=e),placeholder:"请输入 Endpoint"},null,8,["value"])])),_:1}),v(d,{required:"",label:"SecretId"},{default:_((()=>[v(o,{value:y.value.ai.tencent.secretId,"onUpdate:value":l[115]||(l[115]=e=>y.value.ai.tencent.secretId=e),placeholder:"请输入 SecretId"},null,8,["value"])])),_:1}),v(d,{required:"",label:"SecretKey"},{default:_((()=>[v(P,{value:y.value.ai.tencent.secretKey,"onUpdate:value":l[116]||(l[116]=e=>y.value.ai.tencent.secretKey=e),placeholder:"请输入 SecretKey"},null,8,["value"])])),_:1}),v(d,{required:"",label:"地域"},{default:_((()=>[v(o,{value:y.value.ai.tencent.region,"onUpdate:value":l[117]||(l[117]=e=>y.value.ai.tencent.region=e),placeholder:"请输入地域节点，例如：ap-beijing"},null,8,["value"])])),_:1}),v(d,{label:"场景名称(Biztype名称)"},{default:_((()=>[v(o,{value:y.value.ai.tencent.bizType,"onUpdate:value":l[118]||(l[118]=e=>y.value.ai.tencent.bizType=e),placeholder:"业务场景名称，可为空"},null,8,["value"])])),_:1})],64)):f("",!0),"aliyun"===y.value.ai.type?(x(),s(O,{key:1},[v(d,{required:"",label:"AccessKeyId"},{default:_((()=>[v(o,{value:y.value.ai.aliyun.accessKeyId,"onUpdate:value":l[119]||(l[119]=e=>y.value.ai.aliyun.accessKeyId=e),placeholder:"请输入 AccessKeyId"},null,8,["value"])])),_:1}),v(d,{required:"",label:"AccessKeySecret"},{default:_((()=>[v(P,{value:y.value.ai.aliyun.accessKeySecret,"onUpdate:value":l[120]||(l[120]=e=>y.value.ai.aliyun.accessKeySecret=e),placeholder:"请输入 AccessKeySecret"},null,8,["value"])])),_:1}),v(d,{required:"",label:"地域节点"},{default:_((()=>[v(o,{value:y.value.ai.aliyun.region,"onUpdate:value":l[121]||(l[121]=e=>y.value.ai.aliyun.region=e),placeholder:"请输入地域节点，例如：cn-shanghai"},null,8,["value"])])),_:1}),v(d,{required:"",label:"检测 Service"},{default:_((()=>[v(o,{value:y.value.ai.aliyun.service,"onUpdate:value":l[122]||(l[122]=e=>y.value.ai.aliyun.service=e),placeholder:"检测服务规则配置，示例：baselineCheck"},null,8,["value"])])),_:1}),v(d,{required:"",label:"阈值"},{default:_((()=>[v(D,{value:y.value.ai.aliyun.threshold,"onUpdate:value":l[123]||(l[123]=e=>y.value.ai.aliyun.threshold=e),min:1,max:100,placeholder:"取值 1-100"},null,8,["value"]),l[184]||(l[184]=c("p",null,"阈值是指图片违规程度上限，取值 1-100 之间，数值越低审核越严格",-1))])),_:1,__:[184]})],64)):f("",!0),"nsfwjs"===y.value.ai.type?(x(),s(O,{key:2},[v(d,{required:"",label:"接口地址"},{default:_((()=>[v(o,{value:y.value.ai.nsfwjs.apiUrl,"onUpdate:value":l[124]||(l[124]=e=>y.value.ai.nsfwjs.apiUrl=e),placeholder:"请输入接口地址，http(s)://domain.com/classify"},null,8,["value"])])),_:1}),v(d,{required:"",label:"阈值"},{default:_((()=>[v(D,{value:y.value.ai.nsfwjs.threshold,"onUpdate:value":l[125]||(l[125]=e=>y.value.ai.nsfwjs.threshold=e),min:1,max:100,placeholder:"取值 1-100"},null,8,["value"]),l[185]||(l[185]=c("p",null,"阈值是指图片违规程度上限，取值 1-100 之间，数值越低审核越严格",-1))])),_:1,__:[185]})],64)):f("",!0)],64)):f("",!0)])),_:1}),v(q,{key:"6",header:"上传设置"},{default:_((()=>[v(d,{label:"允许的图片格式"},{default:_((()=>[v(C,{value:y.value.upload.allowedFormats,"onUpdate:value":l[126]||(l[126]=e=>y.value.upload.allowedFormats=e),mode:"multiple",placeholder:"选择允许的图片格式"},{default:_((()=>[v(S,{value:"jpg"},{default:_((()=>l[186]||(l[186]=[K("JPG")]))),_:1,__:[186]}),v(S,{value:"jpeg"},{default:_((()=>l[187]||(l[187]=[K("JPEG")]))),_:1,__:[187]}),v(S,{value:"png"},{default:_((()=>l[188]||(l[188]=[K("PNG")]))),_:1,__:[188]}),v(S,{value:"gif"},{default:_((()=>l[189]||(l[189]=[K("GIF")]))),_:1,__:[189]}),v(S,{value:"webp"},{default:_((()=>l[190]||(l[190]=[K("WEBP")]))),_:1,__:[190]})])),_:1},8,["value"])])),_:1}),v(d,{label:"最大文件大小(MB)"},{default:_((()=>[v(D,{value:y.value.upload.maxSize,"onUpdate:value":l[127]||(l[127]=e=>y.value.upload.maxSize=e),min:1,max:100},null,8,["value"])])),_:1}),v(d,{label:"最多同时上传图片数量"},{default:_((()=>[v(D,{value:y.value.upload.concurrentUploads,"onUpdate:value":l[128]||(l[128]=e=>y.value.upload.concurrentUploads=e),min:1},null,8,["value"])])),_:1}),v(j,{gutter:16},{default:_((()=>[v(F,{span:12},{default:_((()=>[v(d,{label:"最小宽度(px)"},{default:_((()=>[v(D,{value:y.value.upload.minWidth,"onUpdate:value":l[129]||(l[129]=e=>y.value.upload.minWidth=e),min:0},null,8,["value"])])),_:1})])),_:1}),v(F,{span:12},{default:_((()=>[v(d,{label:"最小高度(px)"},{default:_((()=>[v(D,{value:y.value.upload.minHeight,"onUpdate:value":l[130]||(l[130]=e=>y.value.upload.minHeight=e),min:0},null,8,["value"])])),_:1})])),_:1})])),_:1}),v(j,{gutter:16},{default:_((()=>[v(F,{span:12},{default:_((()=>[v(d,{label:"最大宽度(px)"},{default:_((()=>[v(D,{value:y.value.upload.maxWidth,"onUpdate:value":l[131]||(l[131]=e=>y.value.upload.maxWidth=e),min:0},null,8,["value"])])),_:1})])),_:1}),v(F,{span:12},{default:_((()=>[v(d,{label:"最大高度(px)"},{default:_((()=>[v(D,{value:y.value.upload.maxHeight,"onUpdate:value":l[132]||(l[132]=e=>y.value.upload.maxHeight=e),min:0},null,8,["value"])])),_:1})])),_:1})])),_:1}),v(d,{label:"转换格式"},{default:_((()=>[v(C,{value:y.value.upload.convertFormat,"onUpdate:value":l[133]||(l[133]=e=>y.value.upload.convertFormat=e),allowClear:"",placeholder:"选择转换格式"},{default:_((()=>[v(S,{value:""},{default:_((()=>l[191]||(l[191]=[K("不转换")]))),_:1,__:[191]}),v(S,{value:"jpeg"},{default:_((()=>l[192]||(l[192]=[K("JPEG")]))),_:1,__:[192]}),v(S,{value:"png"},{default:_((()=>l[193]||(l[193]=[K("PNG")]))),_:1,__:[193]}),v(S,{value:"webp"},{default:_((()=>l[194]||(l[194]=[K("WEBP")]))),_:1,__:[194]})])),_:1},8,["value"])])),_:1}),v(d,{label:"图片压缩"},{default:_((()=>[v(b,{checked:y.value.upload.qualityOpen,"onUpdate:checked":l[134]||(l[134]=e=>y.value.upload.qualityOpen=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),y.value.upload.qualityOpen?(x(),g(d,{key:0,label:"图片质量"},{default:_((()=>[v(E,{value:y.value.upload.quality,"onUpdate:value":l[135]||(l[135]=e=>y.value.upload.quality=e),min:1,max:100,marks:{1:"1%",25:"25%",50:"50%",75:"75%",100:"100%"}},null,8,["value"])])),_:1})):f("",!0),v(d,{label:"每日上传限制"},{default:_((()=>[v(D,{value:y.value.upload.dailyLimit,"onUpdate:value":l[136]||(l[136]=e=>y.value.upload.dailyLimit=e),min:0,placeholder:"0表示不限制"},null,8,["value"]),l[195]||(l[195]=c("p",null,"该功能仅限制已登录用户, 游客模式下无效",-1))])),_:1,__:[195]}),v(d,{label:"文件命名规则"},{default:_((()=>[v(o,{value:y.value.upload.namingRule,"onUpdate:value":l[137]||(l[137]=e=>y.value.upload.namingRule=e),placeholder:"输入文件命名规则"},null,8,["value"]),v(V,{class:"namingRule-collapse"},{default:_((()=>[v(q,{header:"支持的文件命名规则"},{default:_((()=>[v(Z,{data:k},{default:_((()=>[(x(),s(O,null,H(h,((e,a)=>v(G,{prop:e.prop,label:e.label,key:a},null,8,["prop","label"]))),64))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),v(q,{key:"7",header:"IP设置"},{default:_((()=>[v(d,{label:"黑名单开关"},{default:_((()=>[v(b,{checked:y.value.ip.enabled,"onUpdate:checked":l[138]||(l[138]=e=>y.value.ip.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),v(d,{label:"IP黑名单"},{default:_((()=>[v(R,{value:n.value,"onUpdate:value":l[139]||(l[139]=e=>n.value=e),rows:4,placeholder:"每行一个IP地址",onChange:U},null,8,["value"])])),_:1})])),_:1}),v(q,{key:"8",header:"社会化登录"},{default:_((()=>[v(d,{label:"启用社会化登录"},{default:_((()=>[v(b,{checked:y.value.oauth.enabled,"onUpdate:checked":l[140]||(l[140]=e=>y.value.oauth.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),y.value.oauth.enabled?(x(),s(O,{key:0},[v(d,{label:"GitHub登录开关"},{default:_((()=>[v(b,{checked:y.value.oauth.github.enabled,"onUpdate:checked":l[141]||(l[141]=e=>y.value.oauth.github.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),y.value.oauth.github.enabled?(x(),s(O,{key:0},[v(d,{required:"",label:"Client ID"},{default:_((()=>[v(o,{value:y.value.oauth.github.clientId,"onUpdate:value":l[142]||(l[142]=e=>y.value.oauth.github.clientId=e),placeholder:"输入 GitHub Client ID"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Client Secret"},{default:_((()=>[v(P,{value:y.value.oauth.github.clientSecret,"onUpdate:value":l[143]||(l[143]=e=>y.value.oauth.github.clientSecret=e),placeholder:"输入 GitHub Client Secret"},null,8,["value"])])),_:1}),v(d,{label:"回调地址"},{default:_((()=>[v(o,{value:y.value.oauth.github.callbackUrl,"onUpdate:value":l[144]||(l[144]=e=>y.value.oauth.github.callbackUrl=e),placeholder:"输入回调地址"},null,8,["value"])])),_:1})],64)):f("",!0),v(d,{label:"Google登录开关"},{default:_((()=>[v(b,{checked:y.value.oauth.google.enabled,"onUpdate:checked":l[145]||(l[145]=e=>y.value.oauth.google.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),y.value.oauth.google.enabled?(x(),s(O,{key:1},[v(d,{required:"",label:"Client ID"},{default:_((()=>[v(o,{value:y.value.oauth.google.clientId,"onUpdate:value":l[146]||(l[146]=e=>y.value.oauth.google.clientId=e),placeholder:"输入 Google Client ID"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Client Secret"},{default:_((()=>[v(P,{value:y.value.oauth.google.clientSecret,"onUpdate:value":l[147]||(l[147]=e=>y.value.oauth.google.clientSecret=e),placeholder:"输入 Google Client Secret"},null,8,["value"])])),_:1}),v(d,{label:"回调地址"},{default:_((()=>[v(o,{value:y.value.oauth.google.callbackUrl,"onUpdate:value":l[148]||(l[148]=e=>y.value.oauth.google.callbackUrl=e),placeholder:"输入回调地址"},null,8,["value"])])),_:1})],64)):f("",!0),v(d,{label:"Linux DO登录开关"},{default:_((()=>[v(b,{checked:y.value.oauth.linuxdo.enabled,"onUpdate:checked":l[149]||(l[149]=e=>y.value.oauth.linuxdo.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),y.value.oauth.linuxdo.enabled?(x(),s(O,{key:2},[v(d,{required:"",label:"Client ID"},{default:_((()=>[v(o,{value:y.value.oauth.linuxdo.clientId,"onUpdate:value":l[150]||(l[150]=e=>y.value.oauth.linuxdo.clientId=e),placeholder:"输入 Linux DO Client ID"},null,8,["value"])])),_:1}),v(d,{required:"",label:"Client Secret"},{default:_((()=>[v(P,{value:y.value.oauth.linuxdo.clientSecret,"onUpdate:value":l[151]||(l[151]=e=>y.value.oauth.linuxdo.clientSecret=e),placeholder:"输入 Linux DO Client Secret"},null,8,["value"])])),_:1}),v(d,{label:"回调地址"},{default:_((()=>[v(o,{value:y.value.oauth.linuxdo.callbackUrl,"onUpdate:value":l[152]||(l[152]=e=>y.value.oauth.linuxdo.callbackUrl=e),placeholder:"输入回调地址"},null,8,["value"])])),_:1})],64)):f("",!0)],64)):f("",!0)])),_:1})])),_:1},8,["activeKey"]),v(d,null,{default:_((()=>[v(L,{type:"primary","html-type":"submit",loading:u.value},{default:_((()=>l[196]||(l[196]=[K("保存设置")]))),_:1,__:[196]},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1},8,["spinning"])])}}},[["__scopeId","data-v-cd24b386"]]),Bl={class:"logs-container"},Fl={class:"search-bar"},jl={class:"stats-card"},Gl=oa({__name:"Logs",setup(e){const a=l(!1),t=l([]),u=l([]),r=l(1),n=l(10),i=l(0),o=l(""),m=l(""),g=l(null),f=l(null),y=l(null),h=l(null),k=l(null),w=l(null),U=async()=>{var e,l;a.value=!0;try{const{data:a}=await ia.post("/api/admin/logs",re.stringify({page:r.value,limit:n.value,startDate:null==(e=u.value[0])?void 0:e.format("YYYY-MM-DD"),endDate:null==(l=u.value[1])?void 0:l.format("YYYY-MM-DD"),ip:m.value,username:o.value}));t.value=a.logs,i.value=a.total}catch(d){b.error("获取日志列表失败")}finally{a.value=!1}},I=async()=>{var e,a;try{const{data:l}=await ia.post("/api/admin/logs/stats",re.stringify({startDate:null==(e=u.value[0])?void 0:e.format("YYYY-MM-DD"),endDate:null==(a=u.value[1])?void 0:a.format("YYYY-MM-DD")}));q(l)}catch(l){b.error("获取统计信息失败")}},q=e=>{h.value&&h.value.dispose(),k.value&&k.value.dispose(),w.value&&w.value.dispose(),h.value=Ye(g.value),k.value=Ye(f.value),w.value=Ye(y.value),h.value.setOption({tooltip:{trigger:"item",formatter:e=>`${e.seriesName}: ${e.value}`},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:e.dailyStats.map((e=>`${e._id.year}-${e._id.month}-${e._id.day}`)),axisLabel:{rotate:45}},yAxis:{type:"value",name:"上传数量"},series:[{data:e.dailyStats.map((e=>e.count)),type:"line",smooth:!0,name:"上传数量",itemStyle:{color:"#1890ff"}}]}),k.value.setOption({tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},series:[{type:"pie",radius:"50%",data:e.ipStats.map((e=>({name:e._id||"未知IP",value:e.count}))),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),w.value.setOption({tooltip:{trigger:"item",formatter:function(e){return`上传数量: ${e.value}`}},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:e.userStats.map((e=>e.username||"未知用户")),axisLabel:{rotate:45}},yAxis:{type:"value",name:"上传数量"},series:[{data:e.userStats.map((e=>e.count)),type:"bar",name:"上传数量",itemStyle:{color:"#1890ff"},emphasis:{itemStyle:{color:"#40a9ff"}}}]})};d((()=>{U(),I()}));const S=()=>{r.value=1,U(),u.value.length&&I()},C=()=>{u.value.length&&S(),u.value=[],o.value="",m.value=""},P=async()=>{try{ke.confirm({title:"确认清空",content:"确定要清空所有日志吗？此操作不可恢复！",okText:"确定",okType:"danger",cancelText:"取消",onOk:async()=>{await ia.delete("/api/admin/logs"),b.success("所有日志已清空"),U()}})}catch(e){b.error("清空失败")}};return(e,l)=>{const d=Je,h=J,k=W,w=B,I=Y,q=He,A=Oe,M=Ae,D=Te,L=N;return x(),s(O,null,[c("div",Bl,[c("div",Fl,[v(I,{layout:"inline"},{default:_((()=>[v(h,{label:"日期范围",class:"range-picker"},{default:_((()=>[v(d,{value:u.value,"onUpdate:value":l[0]||(l[0]=e=>u.value=e),locale:p(We)},null,8,["value","locale"])])),_:1}),v(h,{label:"用户名"},{default:_((()=>[v(k,{value:o.value,"onUpdate:value":l[1]||(l[1]=e=>o.value=e),placeholder:"请输入用户名"},null,8,["value"])])),_:1}),v(h,{label:"IP地址"},{default:_((()=>[v(k,{value:m.value,"onUpdate:value":l[2]||(l[2]=e=>m.value=e),placeholder:"请输入IP地址"},null,8,["value"])])),_:1}),v(h,{class:"search-button"},{default:_((()=>[v(w,{type:"primary",disabled:!u.value.length&&!o.value&&!m.value,onClick:S},{default:_((()=>l[5]||(l[5]=[K(" 搜索 ")]))),_:1,__:[5]},8,["disabled"]),v(w,{style:{"margin-left":"8px"},disabled:!u.value.length,onClick:C},{default:_((()=>l[6]||(l[6]=[K("重置")]))),_:1,__:[6]},8,["disabled"]),v(w,{type:"primary",danger:"",style:{"margin-left":"8px"},onClick:P},{default:_((()=>l[7]||(l[7]=[K("清空日志")]))),_:1,__:[7]})])),_:1})])),_:1})]),v(M,{spinning:a.value},{default:_((()=>[v(A,{data:t.value,"scrollbar-always-on":!0,fit:""},{default:_((()=>[v(q,{label:"用户名",fixed:""},{default:_((({row:e})=>{var a;return[K(z((null==(a=null==e?void 0:e.user)?void 0:a.username)||"游客"),1)]})),_:1}),v(q,{prop:"ip",label:"IP地址"}),v(q,{prop:"createdAt",label:"上传时间"},{default:_((({row:e})=>[K(z(p(qa)(e.createdAt)),1)])),_:1}),v(q,{prop:"originalName",label:"文件名"}),v(q,{label:"文件大小"},{default:_((({row:e})=>[K(z(p(Sa)(e.size)),1)])),_:1}),v(q,{label:"图片尺寸"},{default:_((({row:e})=>[K(z(e.width)+"x"+z(e.height),1)])),_:1}),v(q,{prop:"format",label:"图片格式"}),v(q,{label:"操作",fixed:"right"},{default:_((({row:e})=>[v(w,{type:"link",danger:"",onClick:a=>(async e=>{try{await ia.delete(`/api/admin/logs/${e}`),b.success("删除成功"),U()}catch(a){b.error("删除失败")}})(e._id)},{default:_((()=>l[8]||(l[8]=[K("删除")]))),_:2,__:[8]},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["spinning"]),v(D,{current:r.value,"onUpdate:current":l[3]||(l[3]=e=>r.value=e),"page-size":n.value,"onUpdate:pageSize":l[4]||(l[4]=e=>n.value=e),total:i.value,"show-size-changer":"",onChange:U},null,8,["current","page-size","total"])]),c("div",jl,[v(L,{title:"每日上传统计"},{default:_((()=>[c("div",{ref_key:"dailyChartRef",ref:g,style:{height:"300px"}},null,512)])),_:1}),v(L,{title:"IP分布统计"},{default:_((()=>[c("div",{ref_key:"ipChartRef",ref:f,style:{height:"300px"}},null,512)])),_:1}),v(L,{title:"用户上传统计"},{default:_((()=>[c("div",{ref_key:"userChartRef",ref:y,style:{height:"300px"}},null,512)])),_:1})])],64)}}},[["__scopeId","data-v-72ed36ce"]]),Zl={class:"reset-password"},Vl={key:0},Nl={key:1},Yl={key:2},Jl=oa({__name:"ResetPassword",setup(e){const a=k(),t=ta(),u=l(0),r=l(!1),n=l(""),i=V({email:""}),o=V({code:""}),d=V({password:"",confirmPassword:""}),c=async(e,a)=>{if(a!==d.password)throw new Error("两次输入的密码不一致")},m=async()=>{var e,a,l;if(null==(a=null==(e=null==t?void 0:t.config)?void 0:e.smtp)?void 0:a.enabled)try{r.value=!0,await ia.post("/api/auth/send-code",re.stringify({email:i.email,type:"reset"})),b.success("验证码已发送到您的邮箱"),u.value=1}catch({response:n}){b.error((null==(l=null==n?void 0:n.data)?void 0:l.error)||"发送验证码失败")}finally{r.value=!1}else b.warning("SMTP功能未开启, 请联系管理员")},g=async()=>{var e,a,l;if(null==(a=null==(e=null==t?void 0:t.config)?void 0:e.smtp)?void 0:a.enabled)if(1===u.value)try{r.value=!0;const{data:e}=await ia.post("/api/auth/verify-code",re.stringify({email:i.email,code:o.code}));n.value=e.token,u.value=2}catch({response:d}){b.error((null==(l=null==d?void 0:d.data)?void 0:l.error)||"验证码验证失败")}finally{r.value=!1}else b.warning("请先完成邮箱验证");else b.warning("SMTP功能未开启, 请联系管理员")},y=async()=>{var e,l,i;if(null==(l=null==(e=null==t?void 0:t.config)?void 0:e.smtp)?void 0:l.enabled)if(2===u.value)try{r.value=!0,await ia.post("/api/auth/reset-password",re.stringify({token:n.value,password:d.password})),b.success("您的密码已经重置成功，请使用新密码登录"),a.push("/login")}catch({response:o}){b.error((null==(i=null==o?void 0:o.data)?void 0:i.error)||"重置密码失败")}finally{r.value=!1}else b.warning("请先完成验证码验证");else b.warning("SMTP功能未开启, 请联系管理员")};return(e,a)=>{const l=W,t=J,n=B,h=Y,b=X,k=N;return x(),s("div",Zl,[v(k,{class:"reset-card",title:"找回密码"},{default:_((()=>[0===u.value?(x(),s("div",Vl,[v(h,{model:i,onFinish:m},{default:_((()=>[v(t,{name:"email",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱地址"}]},{default:_((()=>[v(l,{value:i.email,"onUpdate:value":a[0]||(a[0]=e=>i.email=e),placeholder:"请输入注册邮箱"},{prefix:_((()=>[v(p(le))])),_:1},8,["value"])])),_:1}),v(t,null,{default:_((()=>[v(n,{type:"primary",disabled:!i.email,"html-type":"submit",loading:r.value},{default:_((()=>a[4]||(a[4]=[K(" 发送验证码 ")]))),_:1,__:[4]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):f("",!0),1===u.value?(x(),s("div",Nl,[v(h,{model:o,onFinish:g},{default:_((()=>[v(t,{name:"code",rules:[{required:!0,message:"请输入验证码"}]},{default:_((()=>[v(l,{value:o.code,"onUpdate:value":a[1]||(a[1]=e=>o.code=e),placeholder:"请输入验证码"},{prefix:_((()=>[v(p(ue))])),_:1},8,["value"])])),_:1}),v(t,null,{default:_((()=>[v(n,{type:"primary",disabled:!o.code,"html-type":"submit",loading:r.value},{default:_((()=>a[5]||(a[5]=[K("验证")]))),_:1,__:[5]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):f("",!0),2===u.value?(x(),s("div",Yl,[v(h,{model:d,onFinish:y},{default:_((()=>[v(t,{name:"password",rules:[{required:!0,message:"请输入新密码"},{min:6,message:"密码长度不能小于6位"}]},{default:_((()=>[v(b,{value:d.password,"onUpdate:value":a[2]||(a[2]=e=>d.password=e),placeholder:"请输入新密码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1}),v(t,{name:"confirmPassword",rules:[{required:!0,message:"请确认密码"},{validator:c}]},{default:_((()=>[v(b,{value:d.confirmPassword,"onUpdate:value":a[3]||(a[3]=e=>d.confirmPassword=e),placeholder:"请确认新密码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1},8,["rules"]),v(t,null,{default:_((()=>[v(n,{type:"primary","html-type":"submit",disabled:!d.password||!d.confirmPassword,loading:r.value},{default:_((()=>a[6]||(a[6]=[K(" 重置密码 ")]))),_:1,__:[6]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):f("",!0)])),_:1})])}}},[["__scopeId","data-v-12391a8b"]]),Wl={class:"settings"},Xl={class:"avatar-upload"},Ql={class:"social-accounts"},et={class:"accounts-grid"},at={key:0,class:"account-card"},lt={class:"account-info"},tt={key:0,class:"account-name"},ut={key:1,class:"account-name"},rt=["onClick"],nt=["onClick"],it=oa({__name:"Settings",setup(e){const a=ta(),t=l("basic"),u=l(!1),r=l(0),n=V({username:"",email:"",avatar:""}),i=V({oldPassword:"",newPassword:"",confirmPassword:""}),o=V({newEmail:"",code:""});d((()=>{var e,l,t;n.username=null==(e=a.user)?void 0:e.username,n.email=null==(l=a.user)?void 0:l.email,n.avatar=null==(t=a.user)?void 0:t.avatar}));const m=e=>e.toLowerCase().replace(/\s+/g,""),y=async(e,a)=>{if(a!==i.newPassword)throw new Error("两次输入的密码不一致")},h=e=>{if(!e.type.startsWith("image/"))return b.error("只能上传图片文件!"),!1;return!!(e.size/1024/1024<2)||(b.error("图片大小不能超过 2MB!"),!1)},k=async({file:e})=>{var l;if(!u.value)try{const l=new FormData;l.append("image",e);const{data:t}=await ia.post("/api/upload-avatar",l);n.avatar=t.avatar,a.user.avatar=t.avatar,b.success("头像更新成功")}catch({response:t}){b.error((null==(l=null==t?void 0:t.data)?void 0:l.error)||"上传失败")}finally{u.value=!1}},w=async()=>{var e;try{u.value=!0,await ia.post("/api/auth/change-password",re.stringify(i)),b.success("密码修改成功"),i.oldPassword="",i.newPassword="",i.confirmPassword=""}catch({response:a}){b.error((null==(e=null==a?void 0:a.data)?void 0:e.error)||"密码修改失败")}finally{u.value=!1}},U=async()=>{var e,l,t;if(null==(l=null==(e=null==a?void 0:a.config)?void 0:e.smtp)?void 0:l.enabled)try{await ia.post("/api/auth/user/send-code",re.stringify({email:o.newEmail,type:"email"})),b.success("验证码已发送"),r.value=60;const e=setInterval((()=>{r.value--,r.value<=0&&clearInterval(e)}),1e3)}catch({response:u}){b.error((null==(t=null==u?void 0:u.data)?void 0:t.error)||"发送验证码失败")}else b.warning("SMTP功能未开启, 请联系管理员")},I=async()=>{var e;try{u.value=!0,await ia.post("/api/auth/user/verify-code",re.stringify({email:o.newEmail,code:o.code})),b.success("邮箱修改成功"),n.email=o.newEmail,o.newEmail="",o.code=""}catch({response:a}){b.error((null==(e=null==a?void 0:a.data)?void 0:e.error)||"邮箱修改失败")}finally{u.value=!1}};return(e,l)=>{const d=S,q=B,P=Ge,A=J,M=W,D=Y,L=me,T=X,$=te,R=pe,E=N;return x(),s("div",Wl,[v(E,{title:"个人设置",bordered:!1},{default:_((()=>[v(R,{activeKey:t.value,"onUpdate:activeKey":l[7]||(l[7]=e=>t.value=e)},{default:_((()=>{var e,t;return[v(L,{key:"basic",tab:"基本信息"},{default:_((()=>[v(D,{model:n,layout:"vertical"},{default:_((()=>[v(A,{label:""},{default:_((()=>{var e;return[c("div",Xl,[v(d,{size:100,src:p(a).config.site.url+(null==(e=p(a).user)?void 0:e.avatar),icon:p(C)},null,8,["src","icon"]),v(P,{name:"avatar","show-upload-list":!1,"before-upload":h,customRequest:k},{default:_((()=>[v(q,{type:"link"},{default:_((()=>{var e;return[K(z((null==(e=p(a).user)?void 0:e.avatar)?"更换头像":"上传头像"),1)]})),_:1})])),_:1})])]})),_:1}),v(A,{label:"用户名"},{default:_((()=>[v(M,{value:n.username,"onUpdate:value":l[0]||(l[0]=e=>n.username=e),disabled:""},{prefix:_((()=>[v(p(C))])),_:1},8,["value"])])),_:1}),v(A,{label:"邮箱"},{default:_((()=>[v(M,{value:n.email,"onUpdate:value":l[1]||(l[1]=e=>n.email=e),disabled:""},{prefix:_((()=>[v(p(le))])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1}),v(L,{key:"password",tab:"修改密码"},{default:_((()=>[v(D,{model:i,onFinish:w,layout:"vertical"},{default:_((()=>[v(A,{name:"oldPassword",label:"当前密码",rules:[{required:!0,message:"请输入当前密码"}]},{default:_((()=>[v(T,{value:i.oldPassword,"onUpdate:value":l[2]||(l[2]=e=>i.oldPassword=e),placeholder:"请输入当前密码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1}),v(A,{name:"newPassword",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{min:6,message:"密码长度不能小于6位"}]},{default:_((()=>[v(T,{value:i.newPassword,"onUpdate:value":l[3]||(l[3]=e=>i.newPassword=e),placeholder:"请输入新密码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1}),v(A,{name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:"请确认密码"},{validator:y}]},{default:_((()=>[v(T,{value:i.confirmPassword,"onUpdate:value":l[4]||(l[4]=e=>i.confirmPassword=e),placeholder:"请确认新密码"},{prefix:_((()=>[v(p(Z))])),_:1},8,["value"])])),_:1},8,["rules"]),v(A,null,{default:_((()=>[v(q,{type:"primary","html-type":"submit",disabled:!i.oldPassword||!i.newPassword||!i.confirmPassword,loading:u.value},{default:_((()=>l[8]||(l[8]=[K(" 修改密码 ")]))),_:1,__:[8]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])),_:1}),v(L,{key:"email",tab:"修改邮箱"},{default:_((()=>[v(D,{model:o,onFinish:I,layout:"vertical"},{default:_((()=>[v(A,{name:"newEmail",label:"新邮箱",rules:[{required:!0,message:"请输入新邮箱"},{type:"email",message:"请输入有效的邮箱地址"}]},{default:_((()=>[v(M,{value:o.newEmail,"onUpdate:value":l[5]||(l[5]=e=>o.newEmail=e),placeholder:"请输入新邮箱"},{prefix:_((()=>[v(p(le))])),_:1},8,["value"])])),_:1}),v(A,{name:"code",label:"验证码",rules:[{required:!0,message:"请输入验证码"}]},{default:_((()=>[v($,{compact:""},{default:_((()=>[v(M,{value:o.code,"onUpdate:value":l[6]||(l[6]=e=>o.code=e),placeholder:"请输入验证码",style:{width:"calc(100% - 120px)"}},{prefix:_((()=>[v(p(ue))])),_:1},8,["value"]),v(q,{style:{width:"120px"},disabled:!!r.value||!o.newEmail,onClick:U},{default:_((()=>[K(z(r.value?`${r.value}s后重试`:"获取验证码"),1)])),_:1},8,["disabled"])])),_:1})])),_:1}),v(A,null,{default:_((()=>[v(q,{type:"primary","html-type":"submit",disabled:!o.newEmail||!o.code,loading:u.value},{default:_((()=>l[9]||(l[9]=[K(" 修改邮箱 ")]))),_:1,__:[9]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])),_:1}),(null==(t=null==(e=p(a).config)?void 0:e.oauth)?void 0:t.enabled)?(x(),g(L,{key:"bind",tab:"账号绑定"},{default:_((()=>[c("div",Ql,[l[11]||(l[11]=c("h3",{class:"section-title"},"社交账号绑定",-1)),c("div",et,[(x(),s(O,null,H(["GitHub","Google","Linux DO"],((e,t)=>{var u,r,n,i,o,d;return x(),s(O,{key:t},[(null==(n=null==(r=null==(u=p(a).config)?void 0:u.oauth)?void 0:r[m(e)])?void 0:n.enabled)?(x(),s("div",at,[l[10]||(l[10]=c("div",{class:"account-icon"},null,-1)),c("div",lt,[c("h4",null,z(e),1),(null==(d=null==(o=null==(i=p(a).user)?void 0:i.oauth)?void 0:o[m(e)])?void 0:d.id)?(x(),s(O,{key:0},["GitHub"===e?(x(),s("p",tt,z(p(a).user.oauth[m(e)].username),1)):(x(),s("p",ut,z(p(a).user.oauth[m(e)].email),1)),c("button",{class:"unbind-btn",onClick:l=>(async e=>{var l;try{await ia.post("/oauth/unbind",re.stringify({type:e,userId:a.user._id})),b.success("解绑成功"),location.reload()}catch({response:t}){b.error((null==(l=null==t?void 0:t.data)?void 0:l.error)||"解绑失败")}})(m(e))},"解绑账号",8,rt)],64)):(x(),s("button",{key:1,class:"bind-btn",onClick:l=>(async e=>{var l;const{oauth:t}=null==a?void 0:a.config;if(t.enabled)try{const{data:l}=await ia.post("/oauth/bind",re.stringify({type:e,userId:a.user._id,redirectUrl:location.href}));location.href=l.authUrl}catch({response:u}){b.error((null==(l=null==u?void 0:u.data)?void 0:l.error)||"解绑失败")}else b.error("社会化登录功能未启用")})(m(e))},"绑定账号",8,nt))])])):f("",!0)],64)})),64))])])])),_:1})):f("",!0)]})),_:1},8,["activeKey"])])),_:1})])}}},[["__scopeId","data-v-489e0b9c"]]),ot={class:"invite-codes"},dt={class:"header"},st=oa({__name:"InviteCodes",setup(e){const a=l([]),t=l(!1),u=l(1),r=l(10),n=l(0),i=l(!1),o=l(null),m=l({count:1}),g={count:[{required:!0,message:"请输入生成数量",trigger:"blur"},{type:"number",min:1,max:100,message:"数量应在1-100之间",trigger:"blur"}]},f=async()=>{t.value=!0;try{const{data:e}=await ia.post("/api/admin/invite-codes",re.stringify({page:u.value,limit:r.value}));n.value=e.total,a.value=e.codes}catch({response:e}){b.error("获取邀请码列表失败")}finally{t.value=!1}},y=()=>{m.value={count:1},i.value=!0},h=async()=>{var e,a;try{await o.value.validate(),await ia.post("/api/admin/invite-codes/generate",m.value),b.success("邀请码生成成功"),i.value=!1,f()}catch(l){(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)?b.error(l.response.data.error):b.error("生成邀请码失败")}},k=async()=>{try{const e=await ia.get("/api/admin/invite-codes/export",{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),l=document.createElement("a");l.href=a,l.setAttribute("download","invite-codes.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(e){b.error("导出邀请码失败")}};return d(f),(e,l)=>{const d=B,w=He,U=xe,I=Oe,q=Ae,S=Te,C=je,P=J,A=Y,M=ke;return x(),s("div",ot,[c("div",dt,[v(d,{type:"primary",onClick:y},{default:_((()=>l[5]||(l[5]=[K("生成邀请码")]))),_:1,__:[5]}),v(d,{onClick:k,disabled:!a.value.length},{default:_((()=>l[6]||(l[6]=[K("导出邀请码")]))),_:1,__:[6]},8,["disabled"])]),v(q,{spinning:t.value},{default:_((()=>[v(I,{data:a.value,"scrollbar-always-on":!0,fit:""},{default:_((()=>[v(w,{prop:"code",label:"邀请码"}),v(w,{prop:"status",label:"状态"},{default:_((({row:e})=>[v(U,{color:"unused"===e.status?"green":"blue"},{default:_((()=>[K(z("unused"===e.status?"未使用":"已使用"),1)])),_:2},1032,["color"])])),_:1}),v(w,{prop:"usedBy",label:"使用人"},{default:_((({row:e})=>[K(z(e.usedBy?e.usedBy.username:"-"),1)])),_:1}),v(w,{prop:"usedAt",label:"使用时间"},{default:_((({row:e})=>[K(z(e.usedAt?p(qa)(e.usedAt):"-"),1)])),_:1}),v(w,{prop:"createdAt",label:"生成时间"},{default:_((({row:e})=>[K(z(p(qa)(e.createdAt)),1)])),_:1}),v(w,{label:"操作",fixed:"right",width:"100"},{default:_((({row:e})=>[v(d,{type:"link",danger:"",onClick:a=>{return l=e,void ke.confirm({title:"确认删除",content:`确定要删除邀请码 "${l.code}" 吗？`,async onOk(){var e;try{await ia.delete(`/api/admin/invite-codes/${l._id}`),b.success("邀请码已删除"),f()}catch({response:a}){b.error((null==(e=null==a?void 0:a.data)?void 0:e.error)||"删除失败")}}});var l}},{default:_((()=>l[7]||(l[7]=[K("删除")]))),_:2,__:[7]},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["spinning"]),v(S,{class:"pagination",current:u.value,"onUpdate:current":l[0]||(l[0]=e=>u.value=e),"page-size":r.value,"onUpdate:pageSize":l[1]||(l[1]=e=>r.value=e),total:n.value,"show-size-changer":"",onChange:f},null,8,["current","page-size","total"]),v(M,{open:i.value,"onUpdate:open":l[3]||(l[3]=e=>i.value=e),title:"生成邀请码",onOk:h,onCancel:l[4]||(l[4]=e=>i.value=!1)},{default:_((()=>[v(A,{model:m.value,rules:g,ref_key:"generateFormRef",ref:o},{default:_((()=>[v(P,{label:"生成数量",name:"count"},{default:_((()=>[v(C,{value:m.value.count,"onUpdate:value":l[2]||(l[2]=e=>m.value.count=e),min:1,max:100,placeholder:"请输入生成数量"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"])])}}},[["__scopeId","data-v-740275da"]]),ct={class:"user-page"},vt={key:0,class:"user-profile"},pt={class:"user-details"},mt={key:1,class:"album-grid"},gt={key:1,class:"none-cover"},ft={key:0,class:"pagination"},_t=oa({__name:"UserPage",setup(e){const a=U(),t=k(),u=ta(),r=l(null),n=l(null),i=l([]),o=l(!1),m=l(!1),y=l(1),h=l(10),w=l(0),I=async e=>{var a;m.value=!0,i.value=[],w.value=0;try{const{data:a}=await ia.post(`/api/public/users/${e}/albums`,re.stringify({page:y.value,limit:h.value}));i.value=a.albums||[],w.value=a.total||0}catch({response:l}){b.error((null==(a=null==l?void 0:l.data)?void 0:a.error)||"获取公开相册列表失败")}finally{m.value=!1}},q=e=>{y.value=e,I(r.value)};return d((()=>{r.value=a.params.userId,(async e=>{var a;o.value=!0,n.value=null;try{const{data:a}=await ia.post(`/api/public/users/${e}`,{});n.value=a}catch({response:l}){b.error((null==(a=null==l?void 0:l.data)?void 0:a.error)||"获取用户信息失败")}finally{o.value=!1}})(r.value),y.value=1,I(r.value)})),(e,a)=>{const l=S,d=Me,b=Ae,k=N,U=fe,I=Ke,P=Te;return x(),s("div",ct,[v(k,{class:"user-info-card"},{default:_((()=>[v(b,{spinning:o.value},{default:_((()=>{var e,a,t;return[n.value?(x(),s("div",vt,[v(l,{src:(null==(t=null==(a=null==(e=p(u))?void 0:e.config)?void 0:a.site)?void 0:t.url)+n.value.avatar,size:80,icon:p(C)},null,8,["src","icon"]),c("div",pt,[c("h2",null,z(n.value.username),1),c("p",null,"注册时间: "+z(p(qa)(n.value.createdAt)),1)])])):(x(),g(d,{key:1,description:"用户不存在"}))]})),_:1},8,["spinning"])])),_:1}),n.value?(x(),g(k,{key:0,class:"public-albums-card"},{default:_((()=>{var e,l,o,S;return[c("h3",null,z((null==(e=n.value)?void 0:e.username)===(null==(o=null==(l=p(u))?void 0:l.user)?void 0:o.username)?"我":null==(S=n.value)?void 0:S.username)+"的公开相册",1),v(b,{spinning:m.value},{default:_((()=>[0!==i.value.length||m.value?(x(),s("div",mt,[(x(!0),s(O,null,H(i.value,(e=>(x(),s("div",{key:e._id,class:"album-item"},[v(k,{hoverable:"",onClick:a=>p(t).push(`/user/${r.value}/album/${e._id}`)},{cover:_((()=>{var a,l,t;return[e.coverImage?(x(),g(U,{key:0,src:(null==(t=null==(l=null==(a=p(u))?void 0:a.config)?void 0:l.site)?void 0:t.url)+e.coverImage.thumb,preview:!1},null,8,["src"])):(x(),s("div",gt,"无封面"))]})),default:_((()=>[v(I,{title:e.name},null,8,["title"])])),_:2},1032,["onClick"])])))),128))])):(x(),g(d,{key:0,description:"暂无公开相册"}))])),_:1},8,["spinning"]),w.value>h.value?(x(),s("div",ft,[v(P,{current:y.value,"onUpdate:current":a[0]||(a[0]=e=>y.value=e),total:w.value,"page-size":h.value,onChange:q},null,8,["current","total","page-size"])])):f("",!0)]})),_:1})):f("",!0)])}}},[["__scopeId","data-v-d3c9790c"]]),yt={class:"public-album-detail"},ht={class:"card-title"},bt={key:1,class:"image-grid"},kt={class:"image-tags"},wt={key:0,class:"pagination"},Ut=oa({__name:"UserPublicAlbumDetail",setup(e){const a=U(),t=k(),u=ta(),r=l(null),n=l(null),i=l(null),o=l(null),m=l([]),y=l(!1),h=l(!1),w=l(1),I=l(20),q=l(0),S=async e=>{var a;h.value=!0,m.value=[],q.value=0;try{const{data:a}=await ia.post(`/api/public/albums/${e}/images`,re.stringify({page:w.value,limit:I.value}));m.value=a.images,q.value=a.total,o.value=a.album}catch({response:l}){b.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}finally{h.value=!1}},C=e=>{w.value=e,S(n.value)};return d((()=>{r.value=a.params.userId,n.value=a.params.albumId,w.value=1,(async e=>{var a;try{const{data:a}=await ia.post(`/api/public/users/${e}`);i.value=a}catch({response:l}){b.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}})(r.value),S(n.value)})),(e,a)=>{const l=B,r=Me,n=fe,d=xe,b=Ke,k=N,U=Ae,S=Te;return x(),s("div",yt,[v(k,null,{title:_((()=>{var e,r,n,d,s;return[c("div",ht,[c("span",null,z((null==(e=i.value)?void 0:e.username)===(null==(n=null==(r=p(u))?void 0:r.user)?void 0:n.username)?"我":null==(d=i.value)?void 0:d.username)+"的相册："+z(null==(s=o.value)?void 0:s.name),1),v(l,{onClick:a[0]||(a[0]=e=>p(t).go(-1))},{default:_((()=>a[2]||(a[2]=[K("返回")]))),_:1,__:[2]})])]})),default:_((()=>[v(U,{spinning:y.value||h.value},{default:_((()=>[0!==m.value.length||h.value?(x(),s("div",bt,[(x(!0),s(O,null,H(m.value,(e=>(x(),s("div",{key:e._id,class:"image-item"},[v(k,{hoverable:""},{cover:_((()=>{var a,l,t,r,i,o;return[v(n,{src:(null==(t=null==(l=null==(a=p(u))?void 0:a.config)?void 0:l.site)?void 0:t.url)+e.thumb,preview:{src:(null==(o=null==(i=null==(r=p(u))?void 0:r.config)?void 0:i.site)?void 0:o.url)+e.url}},null,8,["src","preview"])]})),default:_((()=>[v(b,null,{title:_((()=>[K(z(e.filename),1)])),description:_((()=>[c("div",kt,[(x(!0),s(O,null,H(e.tags,(e=>(x(),g(d,{key:e},{default:_((()=>[K(z(e),1)])),_:2},1024)))),128))])])),_:2},1024)])),_:2},1024)])))),128))])):(x(),g(r,{key:0,description:"暂无图片"}))])),_:1},8,["spinning"]),q.value>I.value?(x(),s("div",wt,[v(S,{current:w.value,"onUpdate:current":a[1]||(a[1]=e=>w.value=e),total:q.value,"page-size":I.value,onChange:C},null,8,["current","total","page-size"])])):f("",!0)])),_:1})])}}},[["__scopeId","data-v-fe52b89f"]]),It={class:"admin-albums"},xt={class:"search-area"},qt=[{path:"/404",name:"404",component:pl},{path:"/:pathMatch(.*)*",component:pl},{path:"/login",name:"Login",component:Ua},{path:"/register",name:"Register",component:xa},{path:"/",name:"Home",component:Ja},{path:"/gallery",name:"Gallery",component:dl},{path:"/docs",name:"Docs",component:cl},{path:"/my",name:"My",component:Pl},{path:"/reset-password",name:"ResetPassword",component:Jl},{path:"/settings",name:"Settings",component:it},{path:"/admin",redirect:"/admin/dashboard",children:[{path:"dashboard",name:"Admin",component:Dl},{path:"users",name:"AdminUsers",component:zl},{path:"images",name:"AdminImages",component:$l},{path:"config",name:"AdminConfig",component:El},{path:"logs",name:"AdminLogs",component:Gl},{path:"invitecodes",name:"AdminInviteCodes",component:st},{path:"albums",name:"AdminAlbums",component:oa({__name:"Albums",setup(e){const a=l([]),t=l(!1),u=l(!1),r=l("create"),n=l(null),i=l(!1),o=l([]),m=l(""),y=l(""),h=l(""),k=l(1),w=l(0),U=l(10),I=l({userId:void 0,name:"",permission:"private"}),q={userId:[{required:!0,message:"请选择用户"}],name:[{required:!0,message:"请输入相册名称"}],permission:[{required:!0,message:"请选择权限"}]},S=async()=>{var e;t.value=!0;try{const{data:e}=await ia.post("/api/admin/albums",re.stringify({page:k.value,limit:U.value,name:y.value,username:m.value,permission:h.value}));a.value=e.albums,w.value=e.total}catch({response:l}){b.error(null==(e=null==l?void 0:l.data)?void 0:e.error)}finally{t.value=!1}},C=async e=>{var a;if(e){i.value=!0;try{const{data:a}=await ia.post("/api/admin/users/search",re.stringify({username:e}));o.value=a.users}catch({response:l}){b.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}finally{i.value=!1}}},P=()=>{r.value="create",I.value={userId:void 0,name:"",permission:"private"},u.value=!0},A=async()=>{var e;try{"create"===r.value?(await ia.post("/api/admin/albums/new",I.value),b.success("创建相册成功")):(await ia.put(`/api/admin/albums/${I.value._id}`,I.value),b.success("更新相册成功")),u.value=!1,S()}catch({response:a}){b.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}};return d(S),(e,l)=>{const d=$e,M=ze,D=we,L=B,T=He,O=Oe,H=Te,$=Ae,R=J,E=W,F=Y,j=ke;return x(),s("div",It,[c("div",xt,[v(d,{value:m.value,"onUpdate:value":l[0]||(l[0]=e=>m.value=e),allowClear:"",placeholder:"输入用户名搜索",onSearch:S},null,8,["value"]),v(d,{value:y.value,"onUpdate:value":l[2]||(l[2]=e=>y.value=e),allowClear:"",placeholder:"输入相册名称",onSearch:S},{addonBefore:_((()=>[v(D,{value:h.value,"onUpdate:value":l[1]||(l[1]=e=>h.value=e)},{default:_((()=>[v(M,{value:""},{default:_((()=>l[9]||(l[9]=[K("全部")]))),_:1,__:[9]}),v(M,{value:"public"},{default:_((()=>l[10]||(l[10]=[K("公开")]))),_:1,__:[10]}),v(M,{value:"private"},{default:_((()=>l[11]||(l[11]=[K("私有")]))),_:1,__:[11]})])),_:1},8,["value"])])),_:1},8,["value"]),v(L,{type:"primary",onClick:P},{default:_((()=>l[12]||(l[12]=[K("新建相册")]))),_:1,__:[12]})]),v($,{spinning:t.value},{default:_((()=>[v(O,{data:a.value,"scrollbar-always-on":!0,fit:""},{default:_((()=>[v(T,{prop:"name",label:"相册名称"}),v(T,{label:"所属用户"},{default:_((({row:e})=>[K(z(e.user.username),1)])),_:1}),v(T,{label:"权限"},{default:_((({row:e})=>[K(z("public"===e.permission?"公开":"私有"),1)])),_:1}),v(T,{prop:"imageCount",sortable:"",label:"图片数量"}),v(T,{label:"创建时间"},{default:_((({row:e})=>[K(z(p(qa)(e.createdAt)),1)])),_:1}),v(T,{label:"最后修改时间"},{default:_((({row:e})=>[K(z(p(qa)(e.updatedAt)),1)])),_:1}),v(T,{label:"操作",fixed:"right"},{default:_((({row:e})=>[v(L,{type:"link",onClick:a=>{return l=e,r.value="edit",I.value={...l,userId:l.user._id},void(u.value=!0);var l}},{default:_((()=>l[13]||(l[13]=[K("编辑")]))),_:2,__:[13]},1032,["onClick"]),v(L,{type:"link",danger:"",onClick:a=>(async e=>{ke.confirm({title:"确定要删除这个相册吗？",content:"删除相册不会删除相册内的图片的实际文件",async onOk(){var a;try{await ia.delete(`/api/admin/albums/${e._id}`),b.success("删除相册成功"),S()}catch({response:l}){b.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}}})})(e)},{default:_((()=>l[14]||(l[14]=[K("删除")]))),_:2,__:[14]},1032,["onClick"])])),_:1})])),_:1},8,["data"]),v(H,{class:"pagination",current:k.value,"onUpdate:current":l[3]||(l[3]=e=>k.value=e),pageSize:U.value,"onUpdate:pageSize":l[4]||(l[4]=e=>U.value=e),total:w.value,"show-size-changer":"",onChange:S},null,8,["current","pageSize","total"])])),_:1},8,["spinning"]),v(j,{open:u.value,"onUpdate:open":l[8]||(l[8]=e=>u.value=e),title:"create"===r.value?"新建相册":"编辑相册",onOk:A},{default:_((()=>[v(F,{model:I.value,rules:q,layout:"vertical",ref_key:"formRef",ref:n},{default:_((()=>["create"===r.value?(x(),g(R,{key:0,label:"用户",name:"userId"},{default:_((()=>[v(D,{value:I.value.userId,"onUpdate:value":l[5]||(l[5]=e=>I.value.userId=e),"show-search":"",placeholder:"请选择用户","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null,loading:i.value,options:o.value,onSearch:C},null,8,["value","loading","options"])])),_:1})):f("",!0),v(R,{label:"相册名称",name:"name"},{default:_((()=>[v(E,{value:I.value.name,"onUpdate:value":l[6]||(l[6]=e=>I.value.name=e),placeholder:"请输入相册名称"},null,8,["value"])])),_:1}),v(R,{label:"权限",name:"permission"},{default:_((()=>[v(D,{value:I.value.permission,"onUpdate:value":l[7]||(l[7]=e=>I.value.permission=e)},{default:_((()=>[v(M,{value:"public"},{default:_((()=>l[15]||(l[15]=[K("公开")]))),_:1,__:[15]}),v(M,{value:"private"},{default:_((()=>l[16]||(l[16]=[K("私有")]))),_:1,__:[16]})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"])])}}},[["__scopeId","data-v-fd56ccb0"]])}]},{path:"/user/:userId",name:"UserPage",component:_t},{path:"/user/:userId/album/:albumId",name:"UserPublicAlbumDetail",component:Ut}],St=Xe({history:Qe(),routes:qt});St.beforeEach(((e,a,l)=>{var t,u,r;const{config:n,token:i,user:o}=ta();return("Docs"!==e.name||(null==(t=null==n?void 0:n.site)?void 0:t.api))&&("Register"!==e.name||(null==(u=null==n?void 0:n.site)?void 0:u.register))&&("Gallery"!==e.name||(null==(r=null==n?void 0:n.site)?void 0:r.gallery))&&("Admin"!==e.name||i&&"admin"===(null==o?void 0:o.role))?"My"!==e.name||i?void l():l("/login"):l("/404")}));const Ct=ea(ga),Pt=aa();Pt.use(la),Ct.use(Pt),Ct.use(St),Ct.mount("#app");
