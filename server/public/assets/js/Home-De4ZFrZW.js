import{r as a,c as e,f as l,g as s,i as t,m as i,h as n,l as o,x as u,j as r,a7 as d,E as c,q as v,y as p,z as f,a8 as m,$ as g,J as y,a9 as k,aa as h,k as b,ab as w,ac as _,ad as x,ae as C,af as U,ag as j}from"./vendor-Ct0GE2cv.js";import{_ as z,u as L,i as $}from"./index-D-heiWuO.js";import{f as D}from"./formatDate-_UAqMSvc.js";const M={class:"ant-upload-hint"},R={class:"ant-upload-drag-icon"},F={class:"ant-upload-hint"},I={key:0,class:"file-list"},S={class:"file-list-header"},A={class:"file-list-actions"},B={class:"file-items"},K={class:"file-preview"},E=["src","alt"],H={class:"file-info"},O={class:"file-name"},P={class:"file-size"},W={class:"file-status"},q={key:1,class:"success-text"},J={key:2,class:"error-text"},T={class:"file-actions"},G={key:1,class:"result-panel"},N=["onClick"],Q=z({__name:"Home",setup(z){const Q=L(),V=a([]),X=a([]),Y=a({url:[],html:[],bbcode:[],markdown:[]}),Z=a(0),aa=a("url"),ea=[{key:"url",tab:"URL"},{key:"html",tab:"HTML"},{key:"bbcode",tab:"BBCode"},{key:"markdown",tab:"Markdown"}],la=a(!1),sa=()=>{const a=new k(".copyAll",{text:()=>Y.value[aa.value].join("\n")});a.on("success",(e=>{X.value=[],V.value=[],Y.value={url:[],html:[],bbcode:[],markdown:[]},Z.value=0,e.clearSelection(),y.success("链接已复制到剪贴板"),a.destroy()})),a.on("error",(()=>{y.error("复制失败, 请手动复制"),a.destroy()}))},ta=e((()=>{var a;const{allowedFormats:e}=null==(a=Q.config)?void 0:a.upload;return(null==e?void 0:e.length)?e.map((a=>`image/${a}`)).join(","):"image/*"})),ia=e((()=>{var a;const{allowedFormats:e}=null==(a=Q.config)?void 0:a.upload;return(null==e?void 0:e.length)?e.join(", ").toUpperCase():"all"})),na=a=>a.type.startsWith("image/")?(V.value.push({uid:Date.now()+Math.random().toString(36).slice(2),name:a.name,size:a.size,file:a,preview:URL.createObjectURL(a),status:"waiting",percent:0,error:""}),!1):(y.error("只能上传图片文件！"),!1),oa=async(a,e)=>{var l,s,t,i;try{const{ip:t,config:i,token:n}=Q,o=new FormData;o.append("image",a),o.append("ip",(null==t?void 0:t.ipv4)?null==t?void 0:t.ipv4:null==t?void 0:t.ipv6);const u=(null==(l=null==i?void 0:i.site)?void 0:l.anonymousUpload)&&!n?"/api/tourist/upload":"/api/upload",{data:r}=await $.post(u,o,{onUploadProgress:a=>{e&&e({percent:Math.round(a.loaded/a.total*100)})}}),{url:d,type:c,filename:v}=r;return X.value.unshift(r),((a,e)=>{const{url:l,html:s,bbcode:t,markdown:i}=Y.value;l.push(e),s.push(`<img src="${e}" alt="${a}" />`),t.push(`[img]${e}[/img]`),i.push(`![${a}](${e})`),Z.value=Y.value[aa.value].length-1})(v,"local"==c?(null==(s=null==i?void 0:i.site)?void 0:s.url)+d:d),r}catch(n){throw new Error((null==(i=null==(t=null==n?void 0:n.response)?void 0:t.data)?void 0:i.error)||n)}},ua=async a=>{const e=(a.clipboardData||window.Clipboard).items,l=[];for(let s=0;s<e.length;s++){const a=e[s];if("file"===a.kind&&a.type.startsWith("image/")){const e=a.getAsFile(),t=URL.createObjectURL(e);l.push({uid:Date.now()+s,name:e.name,size:e.size,file:e,preview:t})}}l.length>0&&V.value.push(...l)},ra=async()=>{const a=V.value.filter((a=>"waiting"===a.status));if(0!==a.length){la.value=!0;for(const e of a)await va(e);la.value=!1}},da=()=>{V.value=V.value.filter((a=>"success"===a.status||"error"===a.status))},ca=(a,e)=>{const l=new k(a,{text:()=>e});l.on("success",(a=>{a.clearSelection(),y.success("链接已复制到剪贴板"),l.destroy()})),l.on("error",(a=>{y.error("复制失败, 请手动复制"),l.destroy()}))},va=async a=>{var e,l,s,t;const i=V.value.findIndex((e=>e.uid===a.uid));if(-1!==i){V.value[i].status="uploading",V.value[i].percent=0;try{const n=await oa(a.file,(e=>{const l=V.value.findIndex((e=>e.uid===a.uid));l>-1&&(V.value[l].percent=e.percent)}));V.value[i].status="success",V.value[i].url="local"==n.type?(null==(l=null==(e=Q.config)?void 0:e.site)?void 0:l.url)+n.url:n.url,V.value[i].thumb=(null==(t=null==(s=Q.config)?void 0:s.site)?void 0:t.url)+n.thumb}catch(n){V.value[i].status="error",V.value[i].error=n.message||"上传失败"}}};return(a,e)=>{const y=d,k=c,z=w,L=_,$=U,X=m,Z=g;return s(),l("div",{class:"home-container",onPaste:ua},[t(Z,{class:"upload-card"},{default:i((()=>{var a,d,c,m,g,w;return[n("p",M," 您单次最多可以上传"+u(null==(d=null==(a=r(Q).config)?void 0:a.upload)?void 0:d.concurrentUploads)+"张图片, 最大文件大小："+u(null==(m=null==(c=r(Q).config)?void 0:c.upload)?void 0:m.maxSize)+"MB ",1),t(y,{beforeUpload:na,accept:ta.value,multiple:"",maxCount:null==(w=null==(g=r(Q).config)?void 0:g.upload)?void 0:w.concurrentUploads,showUploadList:!1},{default:i((()=>[n("p",R,[t(r(h))]),e[1]||(e[1]=n("p",{class:"ant-upload-text"},"点击、拖拽或粘贴图片上传",-1)),n("p",F,"支持格式："+u(ia.value),1)])),_:1,__:[1]},8,["accept","maxCount"]),V.value.length>0?(s(),l("div",I,[n("div",S,[n("span",null,"文件列表 ("+u(V.value.length)+")",1),n("div",A,[t(k,{type:"primary",onClick:ra,loading:la.value,disabled:!V.value.some((a=>"waiting"===a.status))},{default:i((()=>e[2]||(e[2]=[v(" 批量上传 ")]))),_:1,__:[2]},8,["loading","disabled"]),t(k,{onClick:da,disabled:!V.value.some((a=>"waiting"===a.status||"uploading"===a.status))},{default:i((()=>e[3]||(e[3]=[v(" 清空列表 ")]))),_:1,__:[3]},8,["disabled"])])]),n("div",B,[(s(!0),l(p,null,f(V.value,(a=>(s(),l("div",{key:a.uid,class:"file-item"},[n("div",K,[n("img",{src:a.preview,alt:a.name},null,8,E)]),n("div",H,[n("div",O,u(a.name),1),n("div",P,u(r(D)(a.size)),1),n("div",W,["uploading"===a.status?(s(),b(z,{key:0,percent:a.percent,size:"small"},null,8,["percent"])):"success"===a.status?(s(),l("span",q,"上传成功")):"error"===a.status?(s(),l("span",J,u(a.error),1)):o("",!0)])]),n("div",T,["waiting"===a.status?(s(),b(L,{key:0,title:"上传"},{default:i((()=>[t(k,{type:"text",onClick:e=>va(a)},{default:i((()=>[t(r(x))])),_:2},1032,["onClick"])])),_:2},1024)):o("",!0),t(L,{title:"删除"},{default:i((()=>[t(k,{type:"text",danger:"",onClick:e=>(a=>{const e=V.value.findIndex((e=>e.uid===a.uid));e>-1&&V.value.splice(e,1)})(a),disabled:"uploading"===a.status},{default:i((()=>[t(r(C))])),_:2},1032,["onClick","disabled"])])),_:2},1024)])])))),128))])])):o("",!0),Y.value[aa.value].length>0?(s(),l("div",G,[t(k,{class:"copyAll",type:"primary",onClick:sa},{default:i((()=>e[4]||(e[4]=[v("一键复制")]))),_:1,__:[4]}),t(X,{activeKey:aa.value,"onUpdate:activeKey":e[0]||(e[0]=a=>aa.value=a)},{default:i((()=>[(s(),l(p,null,f(ea,(a=>t($,{key:a.key,tab:a.tab,class:"link-items"},{default:i((()=>[(s(!0),l(p,null,f(Y.value[aa.value],((a,e)=>(s(),l("div",{key:e,class:"link-item"},[n("div",{class:"link-content",onClick:e=>ca(".link-content",a)},u(a),9,N),t(L,{title:"复制"},{default:i((()=>[t(k,{type:"link",class:"link",onClick:e=>ca(".link",a)},{icon:i((()=>[t(r(j))])),_:2},1032,["onClick"])])),_:2},1024)])))),128))])),_:2},1032,["tab"]))),64))])),_:1},8,["activeKey"])])):o("",!0)]})),_:1})],32)}}},[["__scopeId","data-v-9df9de0d"]]);export{Q as default};
